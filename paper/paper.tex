% \documentclass[sigplan, screen]{acmart}
% \documentclass[sigplan, screen, anonymous, review, authordraft]{acmart}
% \documentclass[sigplan,10pt,anonymous,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
\documentclass[sigplan,10pt]{acmart}

\bibliographystyle{ACM-Reference-Format}

\title{Kit Theory}

\author{Hannes Saffrich}
\orcid{0000-0002-1825-0097}                 %% \orcid is optional
\affiliation{
  % \department{Department1}                %% \department is recommended
  \institution{University of Freiburg}      %% \institution is required
  \country{Germany}                         %% \country is recommended
}
\email{saffrich@informatik.uni-freiburg.de} %% \email is recommended

\author{Peter Thiemann}
\orcid{0000-0002-9000-1239}                 %% \orcid is optional
\affiliation{
  % \department{Department2a}               %% \department is recommended
  \institution{University of Freiburg}      %% \institution is required
  \country{Germany}                         %% \country is recommended
}
\email{thiemann@informatik.uni-freiburg.de} %% \email is recommended

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{stmaryrd}

\usepackage[links]{agda}

% \usepackage{amsmath}
% \usepackage{amsfonts}
% \usepackage{amssymb}

\usepackage{bbold} % lower case mathbb letters

\usepackage{newunicodechar}
\newunicodechar{‚â°}{\ensuremath{\equiv}}
\newunicodechar{‚Ñï}{\ensuremath{\mathbb{N}}}
\newunicodechar{‚àò}{\ensuremath{\circ}}
\newunicodechar{‚àÖ}{\ensuremath{\varnothing}}
\newunicodechar{‚áí}{\ensuremath{\Rightarrow}}
\newunicodechar{‚àã}{\ensuremath{\ni}}
\newunicodechar{‚à∑}{\ensuremath{\mathop{::}}}
\newunicodechar{‚ä¢}{\ensuremath{\vdash}}
\newunicodechar{‚àÄ}{\ensuremath{\forall}}
\newunicodechar{À£}{\ensuremath{{}^{\textsf{x}}}}
\newunicodechar{·µÖ}{\ensuremath{{}^{\textsf{\alpha}}}}
\newunicodechar{·µó}{\ensuremath{{}^{\textsf{t}}}}
\newunicodechar{·µ£}{\ensuremath{{}_{\textsf{r}}}}
\newunicodechar{·µ•}{\ensuremath{{}_{\textsf{v}}}}
\newunicodechar{‚ÇÅ}{\ensuremath{{}_1}}
\newunicodechar{‚ÇÇ}{\ensuremath{{}_2}}
\newunicodechar{‚ÇÉ}{\ensuremath{{}_3}}
\newunicodechar{‚Çñ}{\ensuremath{{}_{\textsf{k}}}}
\newunicodechar{‚Çò}{\ensuremath{{}_{\textsf{m}}}}
\newunicodechar{‚Çõ}{\ensuremath{{}_{\textsf{s}}}}
\newunicodechar{‚Çú}{\ensuremath{{}_{\textsf{t}}}}
\newunicodechar{‚Üí}{\ensuremath{\to}}
\newunicodechar{‚óÜ}{\ensuremath{\diamond}}
\newunicodechar{‚ä§}{\ensuremath{\top}}
\newunicodechar{‚òÖ}{\ensuremath{\star}}
\newunicodechar{ùïñ}{\ensuremath{\mathbb{e}}}
\newunicodechar{ùï•}{\ensuremath{\mathbb{t}}}
\newunicodechar{ùïú}{\ensuremath{\mathbb{k}}}
\newunicodechar{‚àô}{\ensuremath{\bullet}}
\newunicodechar{‚Ü™}{\ensuremath{\hookrightarrow}}
\newunicodechar{‚à∂}{\ensuremath{:}}
\newunicodechar{‚ãØ}{\ensuremath{\cdot\cdot\cdot}}
\newunicodechar{‚¶Ö}{\ensuremath{\llparenthesis}}
\newunicodechar{‚¶Ü}{\ensuremath{\rrparenthesis}}
\newunicodechar{‚ü¶}{\ensuremath{\llbracket}}
\newunicodechar{‚üß}{\ensuremath{\rrbracket}}
\newunicodechar{‚¶É}{\ensuremath{\{\!\!\{}}
\newunicodechar{‚¶Ñ}{\ensuremath{\}\!\!\}}}
\newunicodechar{Œ±}{\ensuremath{\alpha}}
\newunicodechar{Œª}{\ensuremath{\lambda}}
\newunicodechar{Œõ}{\ensuremath{\Lambda}}
\newunicodechar{œï}{\ensuremath{\phi}}
\newunicodechar{Œì}{\ensuremath{\Gamma}}
\newunicodechar{‚àé}{\ensuremath{\blacksquare}}
% \newunicodechar{‚àé}{\ensuremath{\qed}}
\newunicodechar{‚Üë}{\ensuremath{\uparrow}}
\newunicodechar{‚àã}{\ensuremath{\ni}}
\newunicodechar{‚àà}{\ensuremath{\in}}
\newunicodechar{‚àÉ}{\ensuremath{\exists}}
\newunicodechar{‚Ñì}{\ensuremath{\ell}}
\newunicodechar{‚äî}{\ensuremath{\sqcup}}
\newunicodechar{œÅ}{\ensuremath{\rho}}
\newunicodechar{œÉ}{\ensuremath{\sigma}}
\newunicodechar{œÑ}{\ensuremath{\tau}}
\newunicodechar{Œæ}{\ensuremath{\xi}}
\newunicodechar{Œ≤}{\ensuremath{\beta}}

% \newunicodechar{Œì}{\ensuremath{\texttt{\Gamma}}}
% \newunicodechar{Œª}{\ensuremath{\texttt{\lambda}}}

% \usepackage{cite}
% \usepackage{DejaVuSansMono}
% \usepackage{alphabeta} % Make greek letter macros also work in text-mode.

\usepackage{microtype}
\DisableLigatures[-]{encoding=T1}

\begin{document}
  \begin{abstract}
    Variable binding and substitution are a long-standing nuisance for mechanized
    metatheory of programming languages. A common approach is to represent
    variables as DeBruijn Indices, where substitution is defined in terms of
    variable renaming. If a language has $n$ different kinds of variables, and
    $m$ different kinds of terms, we potentially need to define both
    renaming and substitution for all $m\cdot n$ combinations and prove the
    theory of those operations both in isolation and with respect to each other.

    % McBride introduced kits to define both substitution and renaming by a
    % single term traversal for intrinsically typed terms.\cite{mcbride2005kits}

    We propose a technique to derive the implementation and metatheory of
    renaming and substitution for all $m\cdot n$ combinations of variables and terms
    from a single term traversal and three simple lemmas for extrinsically typed
    but intrinsically scoped terms.
    We demonstrate this technique by formalizing type soundness of System F with
    very parallel substitutions, which replace both type and term variables at
    once, enabling a single substitution-preserves-typing lemma.
    We provide a well-documented implementation of the technique as an Agda
    library.

    As the technique is based on extrinsic typing, the metatheory of renaming
    and substitution is decoupled from type preservation.
    This has the downside, that type preservation of renaming and substitution
    are not for free, but also the upside, that the library can be directly
    instantiated for object languages with non-standard typing relations like
    dependent types, type state, or resource environments.
  \end{abstract}

  \maketitle

  % The following line will be replaced by make with an \input{} for each
  % .lagda.tex file:

  % SED MARKER

  \section{Introduction}
  \newpage

  \section{Syntax}
  \KVariables
  \KModeTy
  \KTerms
  \FMode
  \FSyntax
  \FTerms

  \section{Maps}
  \KKit
  \KMap
  \KAp
  \KExt
  \KLift
  \KId
  \KSingle
  \KWeaken
  \KEq
  \KFunExt
  \KIdLift
  \KKitNotation
  \KTraversal
  \KKitInstances
  \KKitOpen
  \FTraversalOp
  \FTraversalId
  \FTraversal

  \section{Map Composition}
  \KWkKit
  \KWkKitInstances
  \KComposeKit
  \KComposition
  \KComposeKitAp
  \KDistLiftCompose
  \KComposeKitNotation
  \KComposeTraversal
  \KCommLiftWeaken
  \KCommLiftWeakenTraverse
  \KComposeKitInstances
  \KComposeKitInstancesConcrete
  \KWeakenCancelsSingle
  \KWeakenCancelsSingleTraverse
  \KDistLiftSingle
  \KDistLiftSingleTraverse
  \FAssoc
  \FComposeTraversal

  \section{Types \& Contexts}
  \KTypeModes
  \KTypes
  \KContextHelper
  \KContexts
  \KContextLookup
  \FTypes

  \section{Typing}
  \KVariableTyping
  \KTyping
  \KTypingKit
  \KMapTyping
  \KLiftTyping
  \KSingleTyping
  \KTypingNotation
  \KTypingTraversal
  \KTypingInstances
  \KTypingTraversalNotation
  \FTyping
  \FTypingInst
  \FPreserve
  \FTypingTraversal

  \section{Semantics}
  \FValues
  \FReduction

  \section{Subject Reduction}
  \FSubjectReduction

  % \bibliographystyle{ACM-Reference-Format}
  \bibliography{paper}

  \clearpage
  \appendix
\end{document}