module Kitty.Examples.LambdaPi-Derive.SubjectReduction where

open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; sym; subst; module â‰¡-Reasoning)
open â‰¡-Reasoning
open import Kitty.Examples.LambdaPi-Derive.Definitions
open import Kitty.Typing.IKit compose-traversal kit-type record { _âŠ¢_âˆ¶_ = _âŠ¢_âˆ¶_ ; âŠ¢` = âŠ¢` }
open IKit â¦ƒ â€¦ â¦„
open import Function using () renaming (_âˆ‹_ to _by_)
open import Data.Sum using (_âŠ_; injâ‚; injâ‚‚)
open import Data.Product using (âˆƒ-syntax; _Ã—_ ; _,_)

â†ª*-trans : tâ‚ â†ª* tâ‚‚ â†’ tâ‚‚ â†ª* tâ‚ƒ â†’ tâ‚ â†ª* tâ‚ƒ
â†ª*-trans refl b = b
â†ª*-trans (step x a) b = step x (â†ª*-trans a b)

â†ª-â‹¯ :
  âˆ€ â¦ƒ ğ•‚ : Kit â¦„ â¦ƒ K : KitT ğ•‚ â¦„ â¦ƒ Câ‚‚ : ComposeKit ğ•‚ ğ•‚ ğ•‚ â¦„
    â¦ƒ Câ‚ƒ : ComposeKit kitâ‚› ğ•‚ kitâ‚› â¦„
    â¦ƒ Câ‚„ : ComposeKit ğ•‚ kitâ‚› kitâ‚› â¦„
    {Âµâ‚ Âµâ‚‚ m} {Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚} {t t' : Âµâ‚ âŠ¢ m} â†’
  t â†ª t' â†’
  t â‹¯ Ï• â†ª t' â‹¯ Ï•
â†ª-â‹¯ {Âµâ‚} {Âµâ‚‚} {.ğ•–} {Ï•} {.(Î»x _)}       {.(Î»x _)}       (Î¾-Î» tâ†ªt')  = Î¾-Î» (â†ª-â‹¯ tâ†ªt')
â†ª-â‹¯ {Âµâ‚} {Âµâ‚‚} {.ğ•–} {Ï•} {.(âˆ€[xâˆ¶ _ ] _)} {.(âˆ€[xâˆ¶ _ ] _)} (Î¾-âˆ€â‚ tâ†ªt') = Î¾-âˆ€â‚ (â†ª-â‹¯ tâ†ªt')
â†ª-â‹¯ {Âµâ‚} {Âµâ‚‚} {.ğ•–} {Ï•} {.(âˆ€[xâˆ¶ _ ] _)} {.(âˆ€[xâˆ¶ _ ] _)} (Î¾-âˆ€â‚‚ tâ†ªt') = Î¾-âˆ€â‚‚ (â†ª-â‹¯ tâ†ªt')
â†ª-â‹¯ {Âµâ‚} {Âµâ‚‚} {.ğ•–} {Ï•} {.(_ Â· _)}      {.(_ Â· _)}      (Î¾-Â·â‚ tâ†ªt') = Î¾-Â·â‚ (â†ª-â‹¯ tâ†ªt')
â†ª-â‹¯ {Âµâ‚} {Âµâ‚‚} {.ğ•–} {Ï•} {.(_ Â· _)}      {.(_ Â· _)}      (Î¾-Â·â‚‚ tâ†ªt') = Î¾-Â·â‚‚ (â†ª-â‹¯ tâ†ªt')
â†ª-â‹¯ {Âµâ‚} {Âµâ‚‚} {.ğ•–} {Ï•}
    {.((Î»x eâ‚) Â· eâ‚‚)}
    {.(eâ‚ â‹¯ â¦… eâ‚‚ â¦†â‚›)}
    (Î²-Î» {eâ‚ = eâ‚} {eâ‚‚ = eâ‚‚}) =
  subst (((Î»x eâ‚) Â· eâ‚‚) â‹¯ Ï• â†ª_)
        (sym (dist-â¦…â¦†â‚›-â‹¯ eâ‚ eâ‚‚ Ï•))
        (Î²-Î» {eâ‚ = eâ‚ â‹¯ (Ï• â†‘ ğ•–)} {eâ‚‚ = eâ‚‚ â‹¯ Ï•})

â†ª*-â‹¯ :
  âˆ€ â¦ƒ ğ•‚ : Kit â¦„ â¦ƒ K : KitT ğ•‚ â¦„ â¦ƒ Câ‚ : ComposeKit ğ•‚ kitáµ£ ğ•‚ â¦„ â¦ƒ Câ‚‚ : ComposeKit ğ•‚ ğ•‚ ğ•‚ â¦„
    â¦ƒ Câ‚ƒ : ComposeKit kitâ‚› ğ•‚ kitâ‚› â¦„
    â¦ƒ Câ‚„ : ComposeKit ğ•‚ kitâ‚› kitâ‚› â¦„
    {Âµâ‚ Âµâ‚‚ m} {Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚} {t t' : Âµâ‚ âŠ¢ m} â†’
  t â†ª* t' â†’
  t â‹¯ Ï• â†ª* t' â‹¯ Ï•
â†ª*-â‹¯ refl = refl
â†ª*-â‹¯ (step tâ†ªt' t'â†ª*t'') = step (â†ª-â‹¯ tâ†ªt') (â†ª*-â‹¯ t'â†ª*t'')

â†ª-â‹¯â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m} {Ï• : Âµâ‚ â†’â‚› Âµâ‚‚} {t t' : Âµâ‚ âŠ¢ m} â†’
  t â†ª t' â†’
  t â‹¯â‚› Ï• â†ª t' â‹¯â‚› Ï•
â†ª-â‹¯â‚› = â†ª-â‹¯ where instance _ = kitâ‚›; _ = kittâ‚›; _ = ckitâ‚›â‚›; _ = ckitáµ£

â†ª*-â‹¯â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m} {Ï• : Âµâ‚ â†’â‚› Âµâ‚‚} {t t' : Âµâ‚ âŠ¢ m} â†’
  t â†ª* t' â†’
  t â‹¯â‚› Ï• â†ª* t' â‹¯â‚› Ï•
â†ª*-â‹¯â‚› = â†ª*-â‹¯ where instance _ = kitâ‚›; _ = kittâ‚›; _ = ckitâ‚›â‚›; _ = ckitáµ£

â‰£-sym : eâ‚ â‰£ eâ‚‚ â†’ eâ‚‚ â‰£ eâ‚
â‰£-sym (mk-â‰£ e eâ‚â†ª*e eâ‚‚â†ª*e) = mk-â‰£ e eâ‚‚â†ª*e eâ‚â†ª*e

Î¾-Î»* :
  e â†ª* e' â†’
  Î»x e â†ª* Î»x e'
Î¾-Î»* = {!!}

Î¾-âˆ€â‚* :
  tâ‚ â†ª* tâ‚' â†’
  âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â†ª* âˆ€[xâˆ¶ tâ‚' ] tâ‚‚
Î¾-âˆ€â‚* = {!!}

Î¾-âˆ€â‚‚* :
  tâ‚‚ â†ª* tâ‚‚' â†’
  âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â†ª* âˆ€[xâˆ¶ tâ‚ ] tâ‚‚'
Î¾-âˆ€â‚‚* = {!!}

Î¾-Â·â‚* :
  eâ‚ â†ª* eâ‚' â†’
  eâ‚ Â· eâ‚‚ â†ª* eâ‚' Â· eâ‚‚
Î¾-Â·â‚* = {!!}

Î¾-Â·â‚‚* :
  eâ‚‚ â†ª* eâ‚‚' â†’
  eâ‚ Â· eâ‚‚ â†ª* eâ‚ Â· eâ‚‚'
Î¾-Â·â‚‚* = {!!}

â†ª-det : e â†ª eâ‚ â†’ e â†ª eâ‚‚ â†’ âˆƒ[ e' ] (eâ‚ â†ª* e' Ã— eâ‚‚ â†ª* e')
â†ª-det Î²-Î» Î²-Î» = _ , refl , refl
â†ª-det (Î²-Î» {eâ‚ = eâ‚} {eâ‚‚ = eâ‚‚}) (Î¾-Â·â‚ {eâ‚' = Î»x eâ‚'} (Î¾-Î» eâ‚â†ªeâ‚')) = eâ‚' â‹¯â‚› â¦… eâ‚‚ â¦†â‚› , step (â†ª-â‹¯â‚› eâ‚â†ªeâ‚') refl  , step Î²-Î» refl
â†ª-det (Î²-Î» {eâ‚ = eâ‚} {eâ‚‚ = eâ‚‚}) (Î¾-Â·â‚‚ {eâ‚‚' = eâ‚‚'} eâ‚‚â†ªeâ‚‚')          = eâ‚ â‹¯â‚› â¦… eâ‚‚' â¦†â‚› , {!!} , step Î²-Î» refl
â†ª-det (Î¾-Î» x) (Î¾-Î» y) with â†ª-det x y
... | e' , x' , y' = _ , Î¾-Î»* x' , Î¾-Î»* y'
â†ª-det (Î¾-âˆ€â‚ {tâ‚ = tâ‚} {tâ‚' = tâ‚'} {tâ‚‚ = tâ‚‚} tâ‚â†ªtâ‚') (Î¾-âˆ€â‚ {tâ‚' = tâ‚''} tâ‚â†ªtâ‚'') with â†ª-det tâ‚â†ªtâ‚' tâ‚â†ªtâ‚''
... | e' , x' , y' = _ , Î¾-âˆ€â‚* x' , Î¾-âˆ€â‚* y'
â†ª-det (Î¾-âˆ€â‚ {tâ‚ = tâ‚} {tâ‚' = tâ‚'} {tâ‚‚ = tâ‚‚} tâ‚â†ªtâ‚') (Î¾-âˆ€â‚‚ {tâ‚‚' = tâ‚‚'} tâ‚‚â†ªtâ‚‚') = âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' , step (Î¾-âˆ€â‚‚ tâ‚‚â†ªtâ‚‚') refl
                                                                                               , step (Î¾-âˆ€â‚ tâ‚â†ªtâ‚') refl
â†ª-det (Î¾-âˆ€â‚‚ {tâ‚‚ = tâ‚‚} {tâ‚‚' = tâ‚‚'} {tâ‚ = tâ‚} tâ‚‚â†ªtâ‚‚') (Î¾-âˆ€â‚ {tâ‚' = tâ‚'} tâ‚â†ªtâ‚') = âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' , step (Î¾-âˆ€â‚ tâ‚â†ªtâ‚') refl
                                                                                               , step (Î¾-âˆ€â‚‚ tâ‚‚â†ªtâ‚‚') refl
â†ª-det (Î¾-âˆ€â‚‚ {tâ‚‚ = tâ‚‚} {tâ‚‚' = tâ‚‚'} {tâ‚ = tâ‚} tâ‚‚â†ªtâ‚‚') (Î¾-âˆ€â‚‚ {tâ‚‚' = tâ‚‚''} tâ‚‚â†ªtâ‚‚'') with â†ª-det tâ‚‚â†ªtâ‚‚' tâ‚‚â†ªtâ‚‚''
... | e' , x' , y' = _ , Î¾-âˆ€â‚‚* x' , Î¾-âˆ€â‚‚* y'
â†ª-det (Î¾-Â·â‚ (Î¾-Î» x)) Î²-Î» = _ , step Î²-Î» refl , step (â†ª-â‹¯â‚› x) refl
â†ª-det (Î¾-Â·â‚ x) (Î¾-Â·â‚ y) with â†ª-det x y
... | e' , x' , y' = _ , Î¾-Â·â‚* x' , Î¾-Â·â‚* y'
â†ª-det (Î¾-Â·â‚ x) (Î¾-Â·â‚‚ y) = _ , step (Î¾-Â·â‚‚ y) refl , step (Î¾-Â·â‚ x) refl
â†ª-det (Î¾-Â·â‚‚ x) Î²-Î» = _ , step Î²-Î» refl , {!!}
â†ª-det (Î¾-Â·â‚‚ x) (Î¾-Â·â‚ y) = _ , step (Î¾-Â·â‚ y) refl , step (Î¾-Â·â‚‚ x) refl
â†ª-det (Î¾-Â·â‚‚ x) (Î¾-Â·â‚‚ y) with â†ª-det x y
... | e' , x' , y' = _ , Î¾-Â·â‚‚* x' , Î¾-Â·â‚‚* y'

-- data _â†ª*'_ : Âµ âŠ¢ M â†’ Âµ âŠ¢ M â†’ Set where
--   refl :
--     t â†ª*' t
--   step :
--     tâ‚ â†ª*'  tâ‚‚ â†’
--     tâ‚‚ â†ª tâ‚ƒ â†’
--     tâ‚ â†ª*' tâ‚ƒ

-- â†ª*'-trans :
--     tâ‚ â†ª*' tâ‚‚ â†’
--     tâ‚‚ â†ª*' tâ‚ƒ â†’
--     tâ‚ â†ª*' tâ‚ƒ
-- â†ª*'-trans = {!!}

-- â†ª*-to-â†ª*' :
--     tâ‚ â†ª* tâ‚‚ â†’
--     tâ‚ â†ª*' tâ‚‚
-- â†ª*-to-â†ª*' refl = refl
-- â†ª*-to-â†ª*' (step x y) = â†ª*'-trans (step refl x) (â†ª*-to-â†ª*' y)

-- â†ª*'-to-â†ª* :
--     tâ‚ â†ª*' tâ‚‚ â†’
--     tâ‚ â†ª* tâ‚‚
-- â†ª*'-to-â†ª* refl = refl
-- â†ª*'-to-â†ª* (step y x) = â†ª*-trans (â†ª*'-to-â†ª* y) (step x refl)

-- â†ª*-det' : e â†ª*' eâ‚ â†’ e â†ª*' eâ‚‚ â†’ âˆƒ[ e' ] (eâ‚ â†ª*' e' Ã— eâ‚‚ â†ª*' e')
-- â†ª*-det' refl                       eâ†ª*eâ‚‚ = _ , eâ†ª*eâ‚‚ , refl
-- â†ª*-det' eâ†ª*eâ‚@(step eâ†ª*eâ‚' eâ‚'â†ªeâ‚) refl = _ , refl , eâ†ª*eâ‚
-- â†ª*-det' xeâ†ª*eâ‚@(step eâ†ª*eâ‚' eâ‚'â†ªeâ‚)       (step eâ†ª*eâ‚‚' eâ‚‚'â†ªeâ‚‚)
-- --   with â†ª*-det' eâ†ª*eâ‚' eâ†ª*eâ‚‚'
-- -- ... | e' , eâ‚'â†ª*e' , eâ‚‚'â†ª*e'
--   with â†ª*-det' eâ†ª*eâ‚' (step eâ†ª*eâ‚‚' eâ‚‚'â†ªeâ‚‚)
-- ... | E' , eâ‚'â†ª*E' , eâ‚‚â†ª*E'
--   with â†ª*-det' xeâ†ª*eâ‚ eâ†ª*eâ‚‚'
-- ... | F' , eâ‚â†ª*F' , eâ‚‚'â†ª*F'
--   -- = {!!} , eâ‚â†ª*F' , â†ª*'-trans eâ‚‚â†ª*E' {!!}
--   = {!!} , eâ‚â†ª*F' , â†ª*'-trans {!!} eâ‚‚'â†ª*F'

â†ª*-det : e â†ª* eâ‚ â†’ e â†ª* eâ‚‚ â†’ âˆƒ[ e' ] (eâ‚ â†ª* e' Ã— eâ‚‚ â†ª* e')
â†ª*-det refl  eâ†ª*eâ‚‚ = _ , eâ†ª*eâ‚‚ , refl
â†ª*-det eâ†ª*eâ‚ refl  = _ , refl , eâ†ª*eâ‚
â†ª*-det (step eâ†ªeâ‚' eâ‚'â†ª*eâ‚) (step eâ†ªeâ‚‚' eâ‚‚'â†ª*eâ‚‚)
  with â†ª-det eâ†ªeâ‚' eâ†ªeâ‚‚'
... | e' , eâ‚'â†ª*e' , eâ‚‚'â†ª*e'
  with â†ª*-det eâ‚'â†ª*eâ‚ eâ‚'â†ª*e' -- | â†ª*-det eâ‚‚'â†ª*eâ‚‚ eâ‚‚'â†ª*e' 
... | Eâ‚' , eâ‚â†ª*Eâ‚' , e'â†ª*Eâ‚' -- | Eâ‚‚' , eâ‚‚â†ª*Eâ‚‚' , eâ‚‚'â†ª*Eâ‚‚' 
  = {!!} , eâ‚â†ª*Eâ‚' , â†ª*-trans {!!} e'â†ª*Eâ‚'

lem :
  eâ‚  â†ª  eâ‚‚  â†’ eâ‚‚  â†ª* eâ‚ƒ  â†’
  eâ‚  â†ª  eâ‚‚' â†’ eâ‚‚' â†ª* eâ‚ƒ' â†’
  eâ‚‚  â†ª* eâ‚ƒ' âŠ eâ‚‚' â†ª* eâ‚ƒ
-- lem eâ‚â†ªeâ‚‚ eâ‚‚â†ª*eâ‚ƒ eâ‚â†ªeâ‚‚' eâ‚‚'â†ª*eâ‚ƒ' = {!!}
lem eâ‚â†ªeâ‚‚ eâ‚‚â†ª*eâ‚ƒ eâ‚â†ªeâ‚‚' eâ‚‚'â†ª*eâ‚ƒ' = {!!}

â‰£-trans : eâ‚ â‰£ eâ‚‚ â†’ eâ‚‚ â‰£ eâ‚ƒ â†’ eâ‚ â‰£ eâ‚ƒ
â‰£-trans (mk-â‰£ e eâ‚â†ª*e eâ‚‚â†ª*e) (mk-â‰£ e' eâ‚‚â†ª*e' eâ‚ƒâ†ª*e') with â†ª*-det eâ‚‚â†ª*e eâ‚‚â†ª*e'
... | e'' , eâ†ª*e'' , e'â†ª*e'' = mk-â‰£ e'' (â†ª*-trans eâ‚â†ª*e eâ†ª*e'') (â†ª*-trans eâ‚ƒâ†ª*e' e'â†ª*e'')
-- â‰£-trans (mk-â‰£ e eâ‚â†ª*e refl)               (mk-â‰£ e' eâ†ª*e' eâ‚ƒâ†ª*e')            = mk-â‰£ e' (â†ª*-trans eâ‚â†ª*e eâ†ª*e') eâ‚ƒâ†ª*e'
-- â‰£-trans (mk-â‰£ e eâ‚â†ª*e e'â†ª*e)              (mk-â‰£ e' refl eâ‚ƒâ†ª*e')             = mk-â‰£ e eâ‚â†ª*e (â†ª*-trans eâ‚ƒâ†ª*e' e'â†ª*e)
-- â‰£-trans (mk-â‰£ e eâ‚â†ª*e (step eâ‚‚â†ªtâ‚‚ tâ‚‚â†ª*e)) (mk-â‰£ e' (step eâ‚‚â†ªtâ‚ƒ tâ‚ƒâ†ª*e') eâ‚ƒâ†ª*e')
--   with â†ª-det eâ‚‚â†ªtâ‚‚ eâ‚‚â†ªtâ‚ƒ
-- ... | eâ‚‚' , tâ‚‚â†ª*eâ‚‚'' , tâ‚ƒâ†ª*eâ‚‚'' =
--   -- Looking for: tâ‚‚â†ª*e'
--   {!â‰£-trans (mk-â‰£ e eâ‚â†ª*e tâ‚‚â†ª*e) (mk-â‰£ e' tâ‚ƒâ†ª*e' eâ‚ƒâ†ª*e')!}

-- â‰£-f :
--   âˆ€ {Âµ} {Âµ'} {M}
--     {f : Âµ âŠ¢ M â†’ Âµ' âŠ¢ M}
--     (F : âˆ€ {e e' : Âµ âŠ¢ M} â†’ e â†ª e' â†’ f e â†ª f e')
--     {e e' : Âµ âŠ¢ M}
--   â†’ e â‰£ e'
--   â†’ f e â‰£ f e'
-- â‰£-f F â‰£-refl = â‰£-refl
-- â‰£-f F {e' = e''} (â‰£-step-â†ª eâ†ªe' e'â‰£e'') = â‰£-step-â†ª (F eâ†ªe') (â‰£-f F e'â‰£e'')
-- â‰£-f F {e' = e''} (â‰£-step-â†© e'â†ªe e'â‰£e'') = â‰£-step-â†© (F e'â†ªe) (â‰£-f F e'â‰£e'')

-- â‰£-â†ª : e â†ª e' â†’ e â‰£ e'
-- â‰£-â†ª eâ†ªe' = â‰£-step-â†ª eâ†ªe' â‰£-refl

-- â‰£-â†© : e' â†ª e â†’ e â‰£ e'
-- â‰£-â†© e'â†ªe = â‰£-step-â†© e'â†ªe â‰£-refl

-- â‰£-Î» : e â‰£ e' â†’ Î»x e â‰£ Î»x e'
-- â‰£-Î» = â‰£-f Î¾-Î»

-- â‰£-Â·â‚ : eâ‚ â‰£ eâ‚' â†’ eâ‚ Â· eâ‚‚ â‰£ eâ‚' Â· eâ‚‚
-- â‰£-Â·â‚ = â‰£-f Î¾-Â·â‚

-- â‰£-Â·â‚‚ : eâ‚‚ â‰£ eâ‚‚' â†’ eâ‚ Â· eâ‚‚ â‰£ eâ‚ Â· eâ‚‚'
-- â‰£-Â·â‚‚ = â‰£-f Î¾-Â·â‚‚

-- â‰£-âˆ€â‚ : eâ‚ â‰£ eâ‚' â†’ âˆ€[xâˆ¶ eâ‚ ] eâ‚‚ â‰£ âˆ€[xâˆ¶ eâ‚' ] eâ‚‚
-- â‰£-âˆ€â‚ = â‰£-f Î¾-âˆ€â‚

-- â‰£-âˆ€â‚‚ : eâ‚‚ â‰£ eâ‚‚' â†’ âˆ€[xâˆ¶ eâ‚ ] eâ‚‚ â‰£ âˆ€[xâˆ¶ eâ‚ ] eâ‚‚'
-- â‰£-âˆ€â‚‚ = â‰£-f Î¾-âˆ€â‚‚


-- â‰£-â‹¯ : âˆ€ â¦ƒ ğ•‚ : Kit â¦„ â¦ƒ K : KitT ğ•‚ â¦„ â¦ƒ Câ‚ : ComposeKit ğ•‚ kitáµ£ ğ•‚ â¦„ â¦ƒ Câ‚‚ : ComposeKit ğ•‚ ğ•‚ ğ•‚ â¦„
--     â¦ƒ IK : IKit ğ•‚ K Câ‚ Câ‚‚ â¦„
--     â¦ƒ Câ‚ƒ : ComposeKit kitâ‚› ğ•‚ kitâ‚› â¦„
--     â¦ƒ Câ‚„ : ComposeKit ğ•‚ kitâ‚› kitâ‚› â¦„
--     {Âµâ‚ Âµâ‚‚ m} {Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚} {t t' : Âµâ‚ âŠ¢ m} â†’
--   t â‰£ t' â†’
--   t â‹¯ Ï• â‰£ t' â‹¯ Ï•
-- â‰£-â‹¯ = â‰£-f â†ª-â‹¯

-- _âŠ¢â‹¯_ :
--   âˆ€ â¦ƒ ğ•‚ : Kit â¦„ â¦ƒ K : KitT ğ•‚ â¦„ â¦ƒ Câ‚ : ComposeKit ğ•‚ kitáµ£ ğ•‚ â¦„ â¦ƒ Câ‚‚ : ComposeKit ğ•‚ ğ•‚ ğ•‚ â¦„
--     â¦ƒ IK : IKit ğ•‚ K Câ‚ Câ‚‚ â¦„
--     â¦ƒ Câ‚ƒ : ComposeKit kitâ‚› ğ•‚ kitâ‚› â¦„
--     â¦ƒ Câ‚„ : ComposeKit ğ•‚ kitâ‚› kitâ‚› â¦„
--     {e : Âµâ‚ âŠ¢ M} {t : Âµâ‚ âˆ¶âŠ¢ M} {Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚} â†’
--   Î“â‚ âŠ¢ e âˆ¶ t â†’
--   Î“â‚‚ âˆ‹*/âŠ¢*[ IK ] Ï• âˆ¶ Î“â‚ â†’
--   Î“â‚‚ âŠ¢ e â‹¯ Ï• âˆ¶ t â‹¯ Ï•
-- âŠ¢` âˆ‹x      âŠ¢â‹¯ âŠ¢Ï• = âŠ¢`/id (âŠ¢Ï• _ _ âˆ‹x)
-- âŠ¢Î» âŠ¢tâ‚ âŠ¢e  âŠ¢â‹¯ âŠ¢Ï• = âŠ¢Î» (âŠ¢tâ‚ âŠ¢â‹¯ âŠ¢Ï•) (âŠ¢e âŠ¢â‹¯ (âŠ¢Ï• âˆ‹â†‘/âŠ¢â†‘ _))
-- âŠ¢âˆ€ âŠ¢tâ‚ âŠ¢tâ‚‚ âŠ¢â‹¯ âŠ¢Ï• = âŠ¢âˆ€ (âŠ¢tâ‚ âŠ¢â‹¯ âŠ¢Ï•) (âŠ¢tâ‚‚ âŠ¢â‹¯ (âŠ¢Ï• âˆ‹â†‘/âŠ¢â†‘ _))
-- _âŠ¢â‹¯_ {Î“â‚‚ = Î“â‚‚} {e = eâ‚ Â· eâ‚‚} {Ï• = Ï•} (âŠ¢Â· {tâ‚ = tâ‚} {tâ‚‚ = tâ‚‚} âŠ¢eâ‚ âŠ¢eâ‚‚) âŠ¢Ï• =
--   Î“â‚‚ âŠ¢ eâ‚ Â· eâ‚‚ â‹¯ Ï• âˆ¶ tâ‚‚ â‹¯â‚› â¦… eâ‚‚ â¦†â‚› â‹¯ Ï•
--     by subst (Î“â‚‚ âŠ¢ (eâ‚ Â· eâ‚‚) â‹¯ Ï• âˆ¶_)
--              ((tâ‚‚ â‹¯ (Ï• â†‘ ğ•–)) â‹¯â‚› â¦… eâ‚‚ â‹¯ Ï• â¦†â‚› â‰¡âŸ¨ sym (dist-â¦…â¦†â‚›-â‹¯ tâ‚‚ eâ‚‚ Ï•) âŸ©
--               tâ‚‚ â‹¯â‚› â¦… eâ‚‚ â¦†â‚› â‹¯ Ï•             âˆ)
--              (âŠ¢Â· (âŠ¢eâ‚ âŠ¢â‹¯ âŠ¢Ï•) (âŠ¢eâ‚‚ âŠ¢â‹¯ âŠ¢Ï•))
-- âŠ¢â˜…         âŠ¢â‹¯ âŠ¢Ï• = âŠ¢â˜…
-- âŠ¢â‰£ tâ‰£t' âŠ¢e âŠ¢â‹¯ âŠ¢Ï• = âŠ¢â‰£ (â‰£-â‹¯ tâ‰£t') (âŠ¢e âŠ¢â‹¯ âŠ¢Ï•)

-- open ITraversal record { _âŠ¢â‹¯_ = _âŠ¢â‹¯_ } public hiding (_âŠ¢â‹¯_)

-- -- _â†ª**_ : âˆ€ {Âµ} (Î“â‚ Î“â‚‚ : Ctx Âµ) â†’ Set
-- -- Î“â‚ â†ª** Î“â‚‚ = âˆ€ {m} (x : _ âˆ‹ m) â†’ Î“â‚ x â†ª* Î“â‚‚ x

-- -- â†ª**-ext : âˆ€ {Âµ} {Î“â‚ Î“â‚‚ : Ctx Âµ} {M} {e : Âµ âŠ¢ M} {t : Âµ âŠ¢ M} â†’
-- --   Î“â‚ â†ª** Î“â‚‚ â†’
-- --   (Î“â‚ â–¶ t) â†ª** (Î“â‚‚ â–¶ t)
-- -- â†ª**-ext {M = ğ•–} â†ªÎ“ (here refl) = refl
-- -- â†ª**-ext {M = M} â†ªÎ“ (there x) = â†ªÎ“ x

-- -- â†ª**-pres : âˆ€ {Âµ} {Î“â‚ Î“â‚‚ : Ctx Âµ} {M} {e : Âµ âŠ¢ M} {t : Âµ âŠ¢ M} â†’
-- --   Î“â‚ â†ª** Î“â‚‚ â†’
-- --   Î“â‚ âŠ¢ e âˆ¶ t â†’
-- --   Î“â‚‚ âŠ¢ e âˆ¶ t
-- -- â†ª**-pres {M = ğ•–} Î“â†ª (âŠ¢` {x = x} refl)       = {!âŠ¢â†ª* {!Î“â†ª x!} (âŠ¢` refl)!}
-- -- â†ª**-pres Î“â†ª (âŠ¢Î» âŠ¢tâ‚ âŠ¢e)  = {!!}
-- -- â†ª**-pres Î“â†ª (âŠ¢âˆ€ âŠ¢tâ‚ âŠ¢tâ‚‚) = {!!}
-- -- â†ª**-pres Î“â†ª (âŠ¢Â· âŠ¢eâ‚ âŠ¢eâ‚‚) = {!!}
-- -- â†ª**-pres Î“â†ª âŠ¢â˜…           = âŠ¢â˜…
-- -- â†ª**-pres Î“â†ª (âŠ¢â‰£ tâ‰£t' âŠ¢e) = {!!}

-- _â‰£Ïƒ_ : âˆ€ {Âµâ‚ Âµâ‚‚} (Ïƒâ‚ Ïƒâ‚‚ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’ Set
-- Ïƒâ‚ â‰£Ïƒ Ïƒâ‚‚ = âˆ€ {m} (x : _ âˆ‹ m) â†’ Ïƒâ‚ _ x â‰£ Ïƒâ‚‚ _ x

-- -- Are Ctx's basically Substitutions which don't weaken automatically?
-- -- Can be represent them as such or even generalize our substitutions?
-- â‰£Ïƒ-refl : âˆ€ {Âµâ‚ Âµâ‚‚} {Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚} â†’
--   Ïƒ â‰£Ïƒ Ïƒ
-- â‰£Ïƒ-refl {m = ğ•–} x = â‰£-refl

-- _â‰£*_ : âˆ€ {Âµ} (Î“â‚ Î“â‚‚ : Ctx Âµ) â†’ Set
-- Î“â‚ â‰£* Î“â‚‚ = âˆ€ {m} (x : _ âˆ‹ m) â†’ Î“â‚ x â‰£ Î“â‚‚ x

-- â‰£*-refl : âˆ€ {Âµ} {Î“ : Ctx Âµ} â†’
--   Î“ â‰£* Î“
-- â‰£*-refl {m = ğ•–} x = â‰£-refl

-- â‰£*-ext : âˆ€ {Âµ} {Î“â‚ Î“â‚‚ : Ctx Âµ} {M} {tâ‚ tâ‚‚ : Âµ âŠ¢ M} â†’
--   Î“â‚ â‰£* Î“â‚‚ â†’
--   tâ‚ â‰£ tâ‚‚ â†’
--   (Î“â‚ â–¶ tâ‚) â‰£* (Î“â‚‚ â–¶ tâ‚‚)
-- â‰£*-ext {M = ğ•–} Î“â‚â‰£Î“â‚‚ tâ‚â‰£tâ‚‚ (here refl) = tâ‚â‰£tâ‚‚
-- â‰£*-ext {M = M} Î“â‚â‰£Î“â‚‚ tâ‚â‰£tâ‚‚ (there x)   = Î“â‚â‰£Î“â‚‚ x

-- â‰£*-â†‘ : âˆ€ {Âµ} {Î“â‚ Î“â‚‚ : Ctx Âµ} {M} {t : Âµ âŠ¢ M} â†’
--   Î“â‚ â‰£* Î“â‚‚ â†’
--   (Î“â‚ â–¶ t) â‰£* (Î“â‚‚ â–¶ t)
-- â‰£*-â†‘ {M = ğ•–} â‰£Î“ = â‰£*-ext â‰£Î“ â‰£-refl

-- â‰£*-pres : âˆ€ {Âµ} {Î“â‚ Î“â‚‚ : Ctx Âµ} {M} {e : Âµ âŠ¢ M} {t : Âµ âŠ¢ M} â†’
--   Î“â‚ â‰£* Î“â‚‚ â†’
--   Î“â‚ âŠ¢ e âˆ¶ t â†’
--   Î“â‚‚ âŠ¢ e âˆ¶ t
-- â‰£*-pres {M = ğ•–} Î“â‰£ (âŠ¢` {x = x} refl) = âŠ¢â‰£ {!Î“â‰£ x!} (âŠ¢` refl)
-- â‰£*-pres Î“â‰£ (âŠ¢Î» âŠ¢tâ‚ âŠ¢e)  = {!!}
-- â‰£*-pres Î“â‰£ (âŠ¢âˆ€ âŠ¢tâ‚ âŠ¢tâ‚‚) = {!!}
-- â‰£*-pres Î“â‰£ (âŠ¢Â· âŠ¢eâ‚ âŠ¢eâ‚‚) = {!!}
-- â‰£*-pres Î“â‰£ âŠ¢â˜…           = âŠ¢â˜…
-- â‰£*-pres Î“â‰£ (âŠ¢â‰£ tâ‰£t' âŠ¢e) = {!!}

-- open import Data.Product using (âˆƒ-syntax; Î£-syntax; _Ã—_; _,_)

-- invert-âŠ¢Î» : âˆ€ {Âµ} {Î“ : Ctx Âµ} {e : (Âµ â–· ğ•–) âŠ¢ ğ•–} {t : Âµ âŠ¢ ğ•–} â†’
--     Î“ âŠ¢ Î»x e âˆ¶ t â†’
--     âˆƒ[ tâ‚ ] âˆƒ[ tâ‚‚ ]
--       t â‰£ âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ Ã—
--       Î“ âŠ¢ tâ‚ âˆ¶ â˜… Ã—
--       Î“ â–¶ tâ‚ âŠ¢ e âˆ¶ tâ‚‚
-- invert-âŠ¢Î» (âŠ¢Î» âŠ¢tâ‚ âŠ¢e) = _ , _ , â‰£-refl , âŠ¢tâ‚ , âŠ¢e
-- invert-âŠ¢Î» (âŠ¢â‰£ tâ‰£t' âŠ¢e) with invert-âŠ¢Î» âŠ¢e
-- ... | tâ‚ , tâ‚‚ , t'â‰£âˆ€[tâ‚]tâ‚‚ , âŠ¢tâ‚ , âŠ¢e = tâ‚ , tâ‚‚ , â‰£-trans (â‰£-sym tâ‰£t') t'â‰£âˆ€[tâ‚]tâ‚‚ , âŠ¢tâ‚ , âŠ¢e

-- -- invert-â†ª-Î» :
-- --   âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â†ª* âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' â†’
-- --   tâ‚ â†ª* tâ‚' Ã— tâ‚‚ â†ª* tâ‚‚'
-- -- invert-â†ª-Î» refl = refl , refl
-- -- invert-â†ª-Î» (step (Î¾-âˆ€â‚ x) st) = {!!}
-- -- invert-â†ª-Î» (step (Î¾-âˆ€â‚‚ x) st) = {!!}

-- invert-â†ª-Î» :
--   âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â†ª âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' â†’
--   tâ‚ â†ª tâ‚' âŠ tâ‚‚ â†ª tâ‚‚'
-- invert-â†ª-Î» (Î¾-âˆ€â‚ tâ‚â†ªtâ‚') = injâ‚ tâ‚â†ªtâ‚'
-- invert-â†ª-Î» (Î¾-âˆ€â‚‚ tâ‚‚â†ªtâ‚‚') = injâ‚‚ tâ‚‚â†ªtâ‚‚'

-- -- invert-â‰£-Î»'' :
-- --   âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â‰£ âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' â†’
-- --   (Î»x eâ‚) Â· eâ‚‚ â†ª âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' â†’

-- invert-â‰£-Î»' :
--   t â‰£ t' â†’
--   t â‰¡ âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â†’
--   t' â‰¡ âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' â†’
--   tâ‚ â‰£ tâ‚' Ã— tâ‚‚ â‰£ tâ‚‚'
-- invert-â‰£-Î»' â‰£-refl refl refl         = â‰£-refl , â‰£-refl
-- invert-â‰£-Î»' (â‰£-step-â†ª (Î¾-âˆ€â‚ tâ‚â†ªtâ‚'') âˆ€â‰£âˆ€) refl refl with invert-â‰£-Î»' âˆ€â‰£âˆ€ refl refl
-- ... | tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚' = â‰£-trans (â‰£-â†ª tâ‚â†ªtâ‚'') tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚'
-- invert-â‰£-Î»' (â‰£-step-â†ª (Î¾-âˆ€â‚‚ tâ‚‚â†ªtâ‚‚'') âˆ€â‰£âˆ€) refl refl with invert-â‰£-Î»' âˆ€â‰£âˆ€ refl refl
-- ... | tâ‚â‰£tâ‚' , tâ‚‚''â‰£tâ‚‚' = tâ‚â‰£tâ‚' , â‰£-trans (â‰£-â†ª tâ‚‚â†ªtâ‚‚'') tâ‚‚''â‰£tâ‚‚'
-- invert-â‰£-Î»' (â‰£-step-â†© (Î¾-âˆ€â‚ tâ‚â†©tâ‚'') âˆ€â‰£âˆ€) refl refl with invert-â‰£-Î»' âˆ€â‰£âˆ€ refl refl
-- ... | tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚' = â‰£-trans (â‰£-â†© tâ‚â†©tâ‚'') tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚'
-- invert-â‰£-Î»' (â‰£-step-â†© (Î¾-âˆ€â‚‚ tâ‚‚â†©tâ‚‚'') âˆ€â‰£âˆ€) refl refl with invert-â‰£-Î»' âˆ€â‰£âˆ€ refl refl
-- ... | tâ‚â‰£tâ‚' , tâ‚‚''â‰£tâ‚‚' = tâ‚â‰£tâ‚' , â‰£-trans (â‰£-â†© tâ‚‚â†©tâ‚‚'') tâ‚‚''â‰£tâ‚‚'
-- invert-â‰£-Î»' (â‰£-step-â†© Î²-Î» eâ‚‚â‰£âˆ€) eq refl = {!!}
-- -- âˆ€[xâˆ¶ tâ‚ ] tâ‚‚  â†©  (Î»x eâ‚) Â· eâ‚‚  â‰£  âˆ€[xâˆ¶ tâ‚' ] tâ‚‚'

-- -- invert-â‰£-Î»' (â‰£-step-â†© (Î²-Î» {eâ‚ = ` x}) eâ‚‚â‰£âˆ€) eq refl = {!!}
-- -- invert-â‰£-Î»' (â‰£-step-â†© (Î²-Î» {eâ‚ = âˆ€[xâˆ¶ eâ‚ ] eâ‚‚}) eâ‚‚â‰£âˆ€) refl refl = {!!}

-- invert-â‰£-Î» :
--   âˆ€[xâˆ¶ tâ‚ ] tâ‚‚ â‰£ âˆ€[xâˆ¶ tâ‚' ] tâ‚‚' â†’
--   tâ‚ â‰£ tâ‚' Ã— tâ‚‚ â‰£ tâ‚‚'
-- invert-â‰£-Î» â‰£-refl          = â‰£-refl , â‰£-refl
-- invert-â‰£-Î» (â‰£-step-â†ª (Î¾-âˆ€â‚ tâ‚â†ªtâ‚'') âˆ€â‰£âˆ€) with invert-â‰£-Î» âˆ€â‰£âˆ€
-- ... | tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚' = â‰£-trans (â‰£-â†ª tâ‚â†ªtâ‚'') tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚'
-- invert-â‰£-Î» (â‰£-step-â†ª (Î¾-âˆ€â‚‚ tâ‚‚â†ªtâ‚‚'') âˆ€â‰£âˆ€) with invert-â‰£-Î» âˆ€â‰£âˆ€
-- ... | tâ‚â‰£tâ‚' , tâ‚‚''â‰£tâ‚‚' = tâ‚â‰£tâ‚' , â‰£-trans (â‰£-â†ª tâ‚‚â†ªtâ‚‚'') tâ‚‚''â‰£tâ‚‚'
-- invert-â‰£-Î» (â‰£-step-â†© âˆ€â†©eâ‚‚ eâ‚‚â‰£âˆ€) = {!eq!}
-- -- invert-â‰£-Î» (â‰£-step-â†© (Î¾-âˆ€â‚ tâ‚â†©tâ‚'') âˆ€â‰£âˆ€) with invert-â‰£-Î» âˆ€â‰£âˆ€
-- -- ... | tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚' = â‰£-trans (â‰£-â†© tâ‚â†©tâ‚'') tâ‚''â‰£tâ‚' , tâ‚‚â‰£tâ‚‚'
-- -- invert-â‰£-Î» (â‰£-step-â†© (Î¾-âˆ€â‚‚ tâ‚‚â†©tâ‚‚'') âˆ€â‰£âˆ€) with invert-â‰£-Î» âˆ€â‰£âˆ€
-- -- ... | tâ‚â‰£tâ‚' , tâ‚‚''â‰£tâ‚‚' = tâ‚â‰£tâ‚' , â‰£-trans (â‰£-â†© tâ‚‚â†©tâ‚‚'') tâ‚‚''â‰£tâ‚‚'

-- subject-reduction :
--   Î“ âŠ¢ e âˆ¶ t â†’
--   e â†ª e' â†’
--   Î“ âŠ¢ e' âˆ¶ t
-- subject-reduction (âŠ¢Î» âŠ¢t âŠ¢e)   (Î¾-Î» eâ†ªe')    = âŠ¢Î» âŠ¢t (subject-reduction âŠ¢e eâ†ªe')
-- subject-reduction {Î“ = Î“} (âŠ¢âˆ€ âŠ¢tâ‚ âŠ¢tâ‚‚) (Î¾-âˆ€â‚ tâ‚â†ªtâ‚') = âŠ¢âˆ€ (subject-reduction âŠ¢tâ‚ tâ‚â†ªtâ‚')
--                                                           (â‰£*-pres (â‰£*-ext (â‰£*-refl {Î“ = Î“}) (â‰£-â†ª tâ‚â†ªtâ‚')) âŠ¢tâ‚‚)
-- subject-reduction (âŠ¢âˆ€ âŠ¢tâ‚ âŠ¢tâ‚‚) (Î¾-âˆ€â‚‚ tâ‚‚â†ªtâ‚‚') = âŠ¢âˆ€ âŠ¢tâ‚ (subject-reduction âŠ¢tâ‚‚ tâ‚‚â†ªtâ‚‚')
-- -- subject-reduction (âŠ¢Â· (âŠ¢Î» âŠ¢t âŠ¢eâ‚) âŠ¢eâ‚‚) Î²-Î» = âŠ¢eâ‚ âŠ¢â‹¯â‚› âŠ¢â¦… âŠ¢eâ‚‚ â¦†
-- -- subject-reduction (âŠ¢Â· (âŠ¢â‰£ x âŠ¢eâ‚) âŠ¢eâ‚‚) Î²-Î» = {!!}
-- subject-reduction (âŠ¢Â· âŠ¢eâ‚ âŠ¢eâ‚‚) Î²-Î» with invert-âŠ¢Î» âŠ¢eâ‚
-- ... | tâ‚ , tâ‚‚ , âˆ€â‰£âˆ€ , âŠ¢tâ‚ , âŠ¢eâ‚ = {!âŠ¢â‰£ (â‰£-sym âˆ€â‰£âˆ€) (âŠ¢Î» âŠ¢tâ‚ âŠ¢eâ‚) !} -- âŠ¢â‰£ {!â‰£-sym eq!} {!âŠ¢eâ‚ âŠ¢â‹¯â‚› âŠ¢â¦… âŠ¢eâ‚‚ â¦†â‚›!}
-- subject-reduction (âŠ¢Â· âŠ¢eâ‚ âŠ¢eâ‚‚) (Î¾-Â·â‚ eâ‚â†ªeâ‚') = âŠ¢Â· (subject-reduction âŠ¢eâ‚ eâ‚â†ªeâ‚') âŠ¢eâ‚‚
-- subject-reduction (âŠ¢Â· âŠ¢eâ‚ âŠ¢eâ‚‚) (Î¾-Â·â‚‚ eâ‚‚â†ªeâ‚‚') = {!âŠ¢Â· âŠ¢eâ‚ (subject-reduction âŠ¢eâ‚‚ eâ‚‚â†ªeâ‚‚')!}
-- subject-reduction (âŠ¢â‰£ tâ‰£t' âŠ¢e) eâ†ªe'          = âŠ¢â‰£ tâ‰£t' (subject-reduction âŠ¢e eâ†ªe')
