module Kitty.Experimental.Examples.SystemF-Kits.Definitions-KitAlt where

open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; sym; trans; cong; congâ‚‚; subst; module â‰¡-Reasoning)
open â‰¡-Reasoning
open import Data.List using (List; []; _âˆ·_; drop)
open import Data.List.Membership.Propositional using (_âˆˆ_)
open import Kitty.Prelude using (_âˆ‹_; _â–·_; _â–·â–·_) public
open import Kitty.Modes using (Modes; Terms)

-- Fixities --------------------------------------------------------------------

infix   3  _âŠ¢_ --  _â†ª_  _âŠ¢_âˆ¶_  _âŠ¢*_âˆ¶_
infixr  5  âˆ€Î±_  Î»x_  Î›Î±_
infixr  6  _â‡’_
infixl  6  _Â·_  _âˆ™_
infix   7  `áµ…_  `Ë£_

-- Modes -----------------------------------------------------------------------

-- Variable Modes
data Modeáµ¥ : Set where
  ğ•– : Modeáµ¥  -- Expression-level variables
  ğ•¥ : Modeáµ¥  -- Type-level variables

-- Term Modes
data Modeâ‚œ : Set where
  ğ•– : Modeâ‚œ  -- Expressions
  ğ•¥ : Modeâ‚œ  -- Types
  ğ•œ : Modeâ‚œ  -- Kinds

-- Mapping variable modes to the term modes they represent.
mâ†’M : Modeáµ¥ â†’ Modeâ‚œ
mâ†’M ğ•– = ğ•–
mâ†’M ğ•¥ = ğ•¥

ğ•„ : Modes
ğ•„ = record { VarMode = Modeáµ¥ ; TermMode = Modeâ‚œ ; mâ†’M = mâ†’M }

variable
  m mâ‚ mâ‚‚ mâ‚ƒ m' mâ‚' mâ‚‚' mâ‚ƒ' : Modeáµ¥
  M Mâ‚ Mâ‚‚ Mâ‚ƒ M' Mâ‚' Mâ‚‚' Mâ‚ƒ' : Modeâ‚œ
  Âµ Âµâ‚ Âµâ‚‚ Âµâ‚ƒ Âµ' Âµâ‚' Âµâ‚‚' Âµâ‚ƒ' : List Modeáµ¥
  Âµâ‚â‚ Âµâ‚â‚‚ Âµâ‚‚â‚ Âµâ‚‚â‚‚           : List Modeáµ¥
  x y z                     : ğ•– âˆˆ Âµ
  Î± Î² Î³                     : ğ•¥ âˆˆ Âµ
  X Y Z                     : m âˆˆ Âµ

-- Syntax ----------------------------------------------------------------------

-- Expressions, Types, and Kinds
data _âŠ¢_ : List Modeáµ¥ â†’ Modeâ‚œ â†’ Set where
  `Ë£_   : Âµ âˆ‹ ğ•–  â†’  Âµ âŠ¢ ğ•–
  `áµ…_   : Âµ âˆ‹ ğ•¥  â†’  Âµ âŠ¢ ğ•¥
  Î»x_   : Âµ â–· ğ•– âŠ¢ ğ•–  â†’  Âµ âŠ¢ ğ•–
  Î›Î±_   : Âµ â–· ğ•¥ âŠ¢ ğ•–  â†’  Âµ âŠ¢ ğ•–
  âˆ€Î±_   : Âµ â–· ğ•¥ âŠ¢ ğ•¥  â†’  Âµ âŠ¢ ğ•¥
  _Â·_   : Âµ âŠ¢ ğ•–  â†’  Âµ âŠ¢ ğ•–  â†’  Âµ âŠ¢ ğ•–
  _âˆ™_   : Âµ âŠ¢ ğ•–  â†’  Âµ âŠ¢ ğ•¥  â†’  Âµ âŠ¢ ğ•–
  _â‡’_   : Âµ âŠ¢ ğ•¥  â†’  Âµ âŠ¢ ğ•¥  â†’  Âµ âŠ¢ ğ•¥
  â˜…     : Âµ âŠ¢ ğ•œ

-- Common constructor for both expression and type variables.
`_ : Âµ âˆ‹ m â†’ Âµ âŠ¢ mâ†’M m
`_ {m = ğ•–} = `Ë£_
`_ {m = ğ•¥} = `áµ…_

ğ•‹ : Terms ğ•„
ğ•‹ = record { _âŠ¢_ = _âŠ¢_ ; `_ = `_ }

variable
  e eâ‚ eâ‚‚ e' eâ‚' eâ‚‚' : Âµ âŠ¢ ğ•–
  t tâ‚ tâ‚‚ t' tâ‚' tâ‚‚' : Âµ âŠ¢ ğ•¥
  k kâ‚ kâ‚‚ k' kâ‚' kâ‚‚' : Âµ âŠ¢ ğ•œ
  E Eâ‚ Eâ‚‚ E' Eâ‚' Eâ‚‚' : Âµ âŠ¢ M

-- Application of Renamings and Substitutions ----------------------------------

open import Kitty.Kit ğ•‹
open import Kitty.Experimental.KitAlt ğ•‹
open Kit {{...}} public

kit-traversal-alt : KitTraversalAlt
kit-traversal-alt = record { _â‹¯_ = _â‹¯_ ; â‹¯-var = â‹¯-var; â‹¯-â†‘ = â‹¯-â†‘ } where
  -- Traverse a term with a renaming or substitution (depending on the kit).
  _â‹¯_ : âˆ€ {{ğ•‚ : Kit}} â†’ Âµâ‚ âŠ¢ M â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ âŠ¢ M
  (`Ë£ x)    â‹¯ f = `/id _ (f _ x)
  (`áµ… Î±)    â‹¯ f = `/id _ (f _ Î±)
  (Î»x t)    â‹¯ f = Î»x (t â‹¯ (f â†‘ ğ•–))
  (Î›Î± t)    â‹¯ f = Î›Î± (t â‹¯ (f â†‘ ğ•¥))
  (âˆ€Î± t)    â‹¯ f = âˆ€Î± (t â‹¯ (f â†‘ ğ•¥))
  (tâ‚ Â· tâ‚‚) â‹¯ f = (tâ‚ â‹¯ f) Â· (tâ‚‚ â‹¯ f)
  (tâ‚ âˆ™ tâ‚‚) â‹¯ f = (tâ‚ â‹¯ f) âˆ™ (tâ‚‚ â‹¯ f)
  (tâ‚ â‡’ tâ‚‚) â‹¯ f = (tâ‚ â‹¯ f) â‡’ (tâ‚‚ â‹¯ f)
  â˜…         â‹¯ f = â˜…
  -- Applying a renaming or substitution to a variable does the expected thing.
  â‹¯-var : âˆ€ {{ğ•‚ : Kit}} (x : Âµâ‚ âˆ‹ m) (f : Âµâ‚ â€“â†’ Âµâ‚‚) â†’ (` x) â‹¯ f â‰¡ `/id _ (f _ x)
  â‹¯-var {m = ğ•–} _ _ = refl
  â‹¯-var {m = ğ•¥} _ _ = refl

  infixl  5  _â‹¯_  _â‹¯*_
  _â‹¯*_ : âˆ€ {ğ•‚s : List Kit} â†’
          Âµâ‚ âŠ¢ M â†’ Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚ â†’ Âµâ‚‚ âŠ¢ M
  t â‹¯* fs = fold-star' (Î» ğ•‚ _ _ t f â†’ _â‹¯_ {{ğ•‚}} t f) t fs

  â‹¯â†’â‹¯*â‚' :
    âˆ€ {ğ•‚s : List Kit}
      {m} (C : âˆ€ Âµ â†’ (Âµ â–· m) âŠ¢ M â†’ Âµ âŠ¢ M)
      {Âµâ‚ Âµâ‚‚} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚)
      {Âµ} {t : (Âµâ‚ â–·â–· Âµ â–· m) âŠ¢ M} â†’
    (âˆ€ {{ğ•‚}} {Âµâ‚} {Âµâ‚‚} (f : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) t â†’ C Âµâ‚ t â‹¯ f â‰¡ C Âµâ‚‚ (t â‹¯ f â†‘ m)) â†’
    C (Âµâ‚ â–·â–· Âµ) t â‹¯* (fs â†‘** Âµ) â‰¡
    C (Âµâ‚‚ â–·â–· Âµ) (t â‹¯* (fs â†‘** (Âµ â–· m)))
  â‹¯â†’â‹¯*â‚' C [] ass = refl
  â‹¯â†’â‹¯*â‚' {ğ•‚s = ğ•‚ âˆ· ğ•‚s} {m = m} C {Âµâ‚ = Âµâ‚} {Âµâ‚‚ = Âµâ‚‚} (f âˆ· fs) {Âµ = Âµ} {t = t} ass =
    let instance _ = ğ•‚ in
    C (Âµâ‚ â–·â–· Âµ) t â‹¯* ((f âˆ· fs) â†‘** Âµ)                      â‰¡âŸ¨ refl âŸ©
    C (Âµâ‚ â–·â–· Âµ) t â‹¯* (fs â†‘** Âµ) â‹¯ (f â†‘* Âµ)                 â‰¡âŸ¨ cong (_â‹¯ _) (â‹¯â†’â‹¯*â‚' C fs ass) âŸ©
    C (_  â–·â–· Âµ) (t â‹¯* (fs â†‘** (Âµ â–· m))) â‹¯ (f â†‘* Âµ)         â‰¡âŸ¨ ass (f â†‘* Âµ) _ âŸ©
    C (Âµâ‚‚ â–·â–· Âµ) (t â‹¯* (fs â†‘** (Âµ â–· m)) â‹¯ (f â†‘* (Âµ â–· m))) â‰¡âŸ¨ refl âŸ©
    C (Âµâ‚‚ â–·â–· Âµ) (t â‹¯* ((f âˆ· fs) â†‘** (Âµ â–· m))) âˆ

  â‹¯-â†‘-Î»' : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ t} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (Î»x t) â‹¯* (fs â†‘** Âµ) â‰¡ Î»x (t â‹¯* (fs â†‘** (Âµ â–· ğ•–)))
  â‹¯-â†‘-Î»' Âµ [] = refl
  â‹¯-â†‘-Î»' {ğ•‚ âˆ· ğ•‚s} Âµ (f âˆ· fs) = congâ‚‚ (_â‹¯_ â¦ƒ ğ•‚ â¦„) (â‹¯-â†‘-Î»' Âµ fs) refl

  â‹¯-â†‘-Î» : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ t} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (Î»x t) â‹¯* (fs â†‘** Âµ) â‰¡ Î»x (t â‹¯* (fs â†‘** (Âµ â–· ğ•–)))
  â‹¯-â†‘-Î» Âµ fs = â‹¯â†’â‹¯*â‚' (Î» _ â†’ Î»x_) fs Î» _ _ â†’ refl

  â‹¯-â†‘-Î› : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ t} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (Î›Î± t) â‹¯* (fs â†‘** Âµ) â‰¡ Î›Î± (t â‹¯* (fs â†‘** (Âµ â–· ğ•¥)))
  â‹¯-â†‘-Î› Âµ fs = â‹¯â†’â‹¯*â‚' (Î» _ â†’ Î›Î±_) fs Î» _ _ â†’ refl

  â‹¯-â†‘-âˆ€ : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ t} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (âˆ€Î± t) â‹¯* (fs â†‘** Âµ) â‰¡ âˆ€Î± (t â‹¯* (fs â†‘** (Âµ â–· ğ•¥)))
  â‹¯-â†‘-âˆ€ Âµ fs = â‹¯â†’â‹¯*â‚' (Î» _ â†’ âˆ€Î±_) fs Î» _ _ â†’ refl

  â‹¯-â†‘-â˜… : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            â˜… â‹¯* (fs â†‘** Âµ) â‰¡ â˜…
  â‹¯-â†‘-â˜… Âµ [] = refl
  â‹¯-â†‘-â˜… Âµ (f âˆ· fs) rewrite â‹¯-â†‘-â˜… Âµ fs = refl

  â‹¯-â†‘-Â· : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ tâ‚ tâ‚‚} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (tâ‚ Â· tâ‚‚) â‹¯* (fs â†‘** Âµ) â‰¡ (tâ‚ â‹¯* (fs â†‘** Âµ)) Â· (tâ‚‚ â‹¯* (fs â†‘** Âµ))
  â‹¯-â†‘-Â· Âµ [] = refl
  â‹¯-â†‘-Â· {ğ•‚ âˆ· ğ•‚s} Âµ {tâ‚ = tâ‚} {tâ‚‚ = tâ‚‚} (f âˆ· fs) =
    let instance _ = ğ•‚ in
    tâ‚ Â· tâ‚‚ â‹¯* ((f âˆ· fs) â†‘** Âµ)                          â‰¡âŸ¨âŸ©
    tâ‚ Â· tâ‚‚ â‹¯* (fs â†‘** Âµ) â‹¯ (f â†‘* Âµ)                     â‰¡âŸ¨ cong (_â‹¯ (f â†‘* Âµ)) (â‹¯-â†‘-Â· Âµ fs) âŸ©
    ((tâ‚ â‹¯* (fs â†‘** Âµ)) Â· (tâ‚‚ â‹¯* (fs â†‘** Âµ))) â‹¯ (f â†‘* Âµ) â‰¡âŸ¨âŸ©
    (tâ‚ â‹¯* ((f âˆ· fs) â†‘** Âµ)) Â· (tâ‚‚ â‹¯* ((f âˆ· fs) â†‘** Âµ))  âˆ

  â‹¯-â†‘-âˆ™ : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ tâ‚ tâ‚‚} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (tâ‚ âˆ™ tâ‚‚) â‹¯* (fs â†‘** Âµ) â‰¡ (tâ‚ â‹¯* (fs â†‘** Âµ)) âˆ™ (tâ‚‚ â‹¯* (fs â†‘** Âµ))
  â‹¯-â†‘-âˆ™ Âµ [] = refl
  â‹¯-â†‘-âˆ™ {ğ•‚ âˆ· ğ•‚s} Âµ {tâ‚ = tâ‚} {tâ‚‚ = tâ‚‚} (f âˆ· fs) =
    let instance _ = ğ•‚ in
    tâ‚ âˆ™ tâ‚‚ â‹¯* ((f âˆ· fs) â†‘** Âµ)                          â‰¡âŸ¨âŸ©
    tâ‚ âˆ™ tâ‚‚ â‹¯* (fs â†‘** Âµ) â‹¯ (f â†‘* Âµ)                     â‰¡âŸ¨ cong (_â‹¯ (f â†‘* Âµ)) (â‹¯-â†‘-âˆ™ Âµ fs) âŸ©
    ((tâ‚ â‹¯* (fs â†‘** Âµ)) âˆ™ (tâ‚‚ â‹¯* (fs â†‘** Âµ))) â‹¯ (f â†‘* Âµ) â‰¡âŸ¨âŸ©
    (tâ‚ â‹¯* ((f âˆ· fs) â†‘** Âµ)) âˆ™ (tâ‚‚ â‹¯* ((f âˆ· fs) â†‘** Âµ))  âˆ

  â‹¯-â†‘-â‡’ : âˆ€ {ğ•‚s : List Kit} Âµ {Âµâ‚ Âµâ‚‚ tâ‚ tâ‚‚} (fs : Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚) â†’
            (tâ‚ â‡’ tâ‚‚) â‹¯* (fs â†‘** Âµ) â‰¡ (tâ‚ â‹¯* (fs â†‘** Âµ)) â‡’ (tâ‚‚ â‹¯* (fs â†‘** Âµ))
  â‹¯-â†‘-â‡’ Âµ [] = refl
  â‹¯-â†‘-â‡’ {ğ•‚ âˆ· ğ•‚s} Âµ {tâ‚ = tâ‚} {tâ‚‚ = tâ‚‚} (f âˆ· fs) =
    let instance _ = ğ•‚ in
    tâ‚ â‡’ tâ‚‚ â‹¯* ((f âˆ· fs) â†‘** Âµ)                          â‰¡âŸ¨âŸ©
    tâ‚ â‡’ tâ‚‚ â‹¯* (fs â†‘** Âµ) â‹¯ (f â†‘* Âµ)                     â‰¡âŸ¨ cong (_â‹¯ (f â†‘* Âµ)) (â‹¯-â†‘-â‡’ Âµ fs) âŸ©
    ((tâ‚ â‹¯* (fs â†‘** Âµ)) â‡’ (tâ‚‚ â‹¯* (fs â†‘** Âµ))) â‹¯ (f â†‘* Âµ) â‰¡âŸ¨âŸ©
    (tâ‚ â‹¯* ((f âˆ· fs) â†‘** Âµ)) â‡’ (tâ‚‚ â‹¯* ((f âˆ· fs) â†‘** Âµ))  âˆ

  â‹¯-â†‘ : âˆ€ {ğ•‚sâ‚ ğ•‚sâ‚‚ : List Kit} {Âµ} (f : Âµâ‚ â€“[ ğ•‚sâ‚ ]â†’* Âµâ‚‚) (g : Âµâ‚ â€“[ ğ•‚sâ‚‚ ]â†’* Âµâ‚‚) â†’
        (âˆ€ Âµ m (x : (Âµâ‚ â–·â–· Âµ) âˆ‹ m) â†’ ` x â‹¯* (f â†‘** Âµ) â‰¡ ` x â‹¯* (g â†‘** Âµ)) â†’
        (t : (Âµâ‚ â–·â–· Âµ) âŠ¢ M) â†’ t â‹¯* (f â†‘** Âµ) â‰¡ t â‹¯* (g â†‘** Âµ)
  â‹¯-â†‘ f g ass (`Ë£ x) = ass _ ğ•– x
  â‹¯-â†‘ f g ass (`áµ… x) = ass _ ğ•¥ x
  â‹¯-â†‘ {Âµ = Âµ} f g ass (Î»x t) =
    (Î»x t) â‹¯* (f â†‘** Âµ)       â‰¡âŸ¨ â‹¯-â†‘-Î» Âµ f âŸ©
    Î»x (t â‹¯* (f â†‘** (Âµ â–· ğ•–))) â‰¡âŸ¨ cong Î»x_ (â‹¯-â†‘ f g ass t) âŸ©
    Î»x (t â‹¯* (g â†‘** (Âµ â–· ğ•–))) â‰¡âŸ¨ sym (â‹¯-â†‘-Î» Âµ g) âŸ©
    (Î»x t) â‹¯* (g â†‘** Âµ)       âˆ
  â‹¯-â†‘ {Âµ = Âµ} f g ass (Î›Î± t) =
    (Î›Î± t) â‹¯* (f â†‘** Âµ)       â‰¡âŸ¨ â‹¯-â†‘-Î› Âµ f âŸ©
    Î›Î± (t â‹¯* (f â†‘** (Âµ â–· ğ•¥))) â‰¡âŸ¨ cong Î›Î±_ (â‹¯-â†‘ f g ass t) âŸ©
    Î›Î± (t â‹¯* (g â†‘** (Âµ â–· ğ•¥))) â‰¡âŸ¨ sym (â‹¯-â†‘-Î› Âµ g) âŸ©
    (Î›Î± t) â‹¯* (g â†‘** Âµ)       âˆ
  â‹¯-â†‘ {Âµ = Âµ} f g ass (âˆ€Î± t) =
    (âˆ€Î± t) â‹¯* (f â†‘** Âµ)       â‰¡âŸ¨ â‹¯-â†‘-âˆ€ Âµ f âŸ©
    âˆ€Î± (t â‹¯* (f â†‘** (Âµ â–· ğ•¥))) â‰¡âŸ¨ cong âˆ€Î±_ (â‹¯-â†‘ f g ass t) âŸ©
    âˆ€Î± (t â‹¯* (g â†‘** (Âµ â–· ğ•¥))) â‰¡âŸ¨ sym (â‹¯-â†‘-âˆ€ Âµ g) âŸ©
    (âˆ€Î± t) â‹¯* (g â†‘** Âµ)       âˆ
  â‹¯-â†‘ {Âµ = Âµ} f g ass (tâ‚ Â· tâ‚‚) =
    tâ‚ Â· tâ‚‚ â‹¯* (f â†‘** Âµ)                  â‰¡âŸ¨ â‹¯-â†‘-Â· Âµ f âŸ©
    (tâ‚ â‹¯* (f â†‘** Âµ)) Â· (tâ‚‚ â‹¯* (f â†‘** Âµ)) â‰¡âŸ¨ congâ‚‚ _Â·_ (â‹¯-â†‘ f g ass tâ‚) (â‹¯-â†‘ f g ass tâ‚‚) âŸ©
    (tâ‚ â‹¯* (g â†‘** Âµ)) Â· (tâ‚‚ â‹¯* (g â†‘** Âµ)) â‰¡âŸ¨ sym (â‹¯-â†‘-Â· Âµ g) âŸ©
    tâ‚ Â· tâ‚‚ â‹¯* (g â†‘** Âµ)                  âˆ
  â‹¯-â†‘ {Âµ = Âµ} f g ass (tâ‚ âˆ™ tâ‚‚) =
    tâ‚ âˆ™ tâ‚‚ â‹¯* (f â†‘** Âµ)                  â‰¡âŸ¨ â‹¯-â†‘-âˆ™ Âµ f âŸ©
    (tâ‚ â‹¯* (f â†‘** Âµ)) âˆ™ (tâ‚‚ â‹¯* (f â†‘** Âµ)) â‰¡âŸ¨ congâ‚‚ _âˆ™_ (â‹¯-â†‘ f g ass tâ‚) (â‹¯-â†‘ f g ass tâ‚‚) âŸ©
    (tâ‚ â‹¯* (g â†‘** Âµ)) âˆ™ (tâ‚‚ â‹¯* (g â†‘** Âµ)) â‰¡âŸ¨ sym (â‹¯-â†‘-âˆ™ Âµ g) âŸ©
    tâ‚ âˆ™ tâ‚‚ â‹¯* (g â†‘** Âµ)                  âˆ
  â‹¯-â†‘ {Âµ = Âµ} f g ass (tâ‚ â‡’ tâ‚‚) =
    tâ‚ â‡’ tâ‚‚ â‹¯* (f â†‘** Âµ)                  â‰¡âŸ¨ â‹¯-â†‘-â‡’ Âµ f âŸ©
    (tâ‚ â‹¯* (f â†‘** Âµ)) â‡’ (tâ‚‚ â‹¯* (f â†‘** Âµ)) â‰¡âŸ¨ congâ‚‚ _â‡’_ (â‹¯-â†‘ f g ass tâ‚) (â‹¯-â†‘ f g ass tâ‚‚) âŸ©
    (tâ‚ â‹¯* (g â†‘** Âµ)) â‡’ (tâ‚‚ â‹¯* (g â†‘** Âµ)) â‰¡âŸ¨ sym (â‹¯-â†‘-â‡’ Âµ g) âŸ©
    tâ‚ â‡’ tâ‚‚ â‹¯* (g â†‘** Âµ)                  âˆ
  â‹¯-â†‘ {Âµ = Âµ} f g ass â˜… =
    â˜… â‹¯* (f â†‘** Âµ) â‰¡âŸ¨ â‹¯-â†‘-â˜… Âµ f âŸ©
    â˜…              â‰¡âŸ¨ sym (â‹¯-â†‘-â˜… Âµ g) âŸ©
    â˜… â‹¯* (g â†‘** Âµ) âˆ

open KitTraversalAlt kit-traversal-alt public

-- instance ğ•‚áµ£ = kitáµ£
-- instance ğ•‚â‚› = kitâ‚›

-- -- Composition of Renamings and Substitutions ----------------------------------

-- open import Kitty.Compose ğ•‹ kit-traversal
-- open ComposeKit {{...}} public

-- kit-assoc : KitAssoc
-- kit-assoc = record { â‹¯-assoc = â‹¯-assoc } where
--   â‹¯-assoc : âˆ€ {{ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit}} {{ğ”¸ : ComposeKit {{ğ•‚â‚}} {{ğ•‚â‚‚}} {{ğ•‚}} }}
--               (v : Âµâ‚ âŠ¢ M) (f : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (g : Âµâ‚‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚ƒ) â†’
--     (v â‹¯ f) â‹¯ g â‰¡ v â‹¯ (g âˆ˜â‚– f)
--   â‹¯-assoc (`Ë£ x) f g =
--     `/id _ (f _ x) â‹¯ g    â‰¡âŸ¨ tm-â‹¯-âˆ˜ f g x âŸ©
--     `/id _ ((g âˆ˜â‚– f) _ x) âˆ
--   â‹¯-assoc (`áµ… Î±) f g =
--     `/id _ (f _ Î±) â‹¯ g    â‰¡âŸ¨ tm-â‹¯-âˆ˜ f g Î± âŸ©
--     `/id _ ((g âˆ˜â‚– f) _ Î±) âˆ
--   â‹¯-assoc (Î»x e) f g = cong Î»x_
--     (e â‹¯ f â†‘ _ â‹¯ g â†‘ _       â‰¡âŸ¨ â‹¯-assoc e (f â†‘ _) (g â†‘ _) âŸ©
--     e â‹¯ ((g â†‘ _) âˆ˜â‚– (f â†‘ _)) â‰¡âŸ¨ cong (e â‹¯_) (sym (dist-â†‘-âˆ˜ _ g f)) âŸ©
--     e â‹¯ (g âˆ˜â‚– f) â†‘ _         âˆ)
--   â‹¯-assoc (Î›Î± e) f g = cong Î›Î±_
--     (e â‹¯ f â†‘ _ â‹¯ g â†‘ _       â‰¡âŸ¨ â‹¯-assoc e (f â†‘ _) (g â†‘ _) âŸ©
--     e â‹¯ ((g â†‘ _) âˆ˜â‚– (f â†‘ _)) â‰¡âŸ¨ cong (e â‹¯_) (sym (dist-â†‘-âˆ˜ _ g f)) âŸ©
--     e â‹¯ (g âˆ˜â‚– f) â†‘ _         âˆ)
--   â‹¯-assoc (âˆ€Î± e) f g = cong âˆ€Î±_
--     (e â‹¯ f â†‘ _ â‹¯ g â†‘ _       â‰¡âŸ¨ â‹¯-assoc e (f â†‘ _) (g â†‘ _) âŸ©
--     e â‹¯ ((g â†‘ _) âˆ˜â‚– (f â†‘ _)) â‰¡âŸ¨ cong (e â‹¯_) (sym (dist-â†‘-âˆ˜ _ g f)) âŸ©
--     e â‹¯ (g âˆ˜â‚– f) â†‘ _         âˆ)
--   â‹¯-assoc (eâ‚ Â· eâ‚‚) f g = congâ‚‚ _Â·_ (â‹¯-assoc eâ‚ f g) (â‹¯-assoc eâ‚‚ f g)
--   â‹¯-assoc (eâ‚ âˆ™ eâ‚‚) f g = congâ‚‚ _âˆ™_ (â‹¯-assoc eâ‚ f g) (â‹¯-assoc eâ‚‚ f g)
--   â‹¯-assoc (eâ‚ â‡’ eâ‚‚) f g = congâ‚‚ _â‡’_ (â‹¯-assoc eâ‚ f g) (â‹¯-assoc eâ‚‚ f g)
--   â‹¯-assoc â˜…         f g = refl

-- open KitAssoc kit-assoc public

-- instance ğ•‚áµ£áµ£ = kitáµ£áµ£
-- instance ğ•‚áµ£â‚› = kitáµ£â‚›
-- instance ğ•‚â‚›áµ£ = kitâ‚›áµ£
-- instance ğ•‚â‚›â‚› = kitâ‚›â‚›

-- -- Applying the identity renaming/substitution does nothing.
-- kit-assoc-lemmas : KitAssocLemmas
-- kit-assoc-lemmas = record { â‹¯-id = â‹¯-id } where
--   â‹¯-id : âˆ€ {{ğ•‚ : Kit}} (v : Âµ âŠ¢ M) â†’ v â‹¯ idâ‚– {{ğ•‚}} â‰¡ v
--   â‹¯-id               (`Ë£ x)                             = id/`/id x
--   â‹¯-id               (`áµ… Î±)                             = id/`/id Î±
--   â‹¯-id {Âµ = Âµ} {{ğ•‚}} (Î»x t)    rewrite idâ†‘â‰¡id {{ğ•‚}} ğ•– Âµ = cong Î»x_ (â‹¯-id t)
--   â‹¯-id {Âµ = Âµ} {{ğ•‚}} (Î›Î± t)    rewrite idâ†‘â‰¡id {{ğ•‚}} ğ•¥ Âµ = cong Î›Î±_ (â‹¯-id t)
--   â‹¯-id {Âµ = Âµ} {{ğ•‚}} (âˆ€Î± t)    rewrite idâ†‘â‰¡id {{ğ•‚}} ğ•¥ Âµ = cong âˆ€Î±_ (â‹¯-id t)
--   â‹¯-id               (tâ‚ Â· tâ‚‚)                          = congâ‚‚ _Â·_ (â‹¯-id tâ‚) (â‹¯-id tâ‚‚)
--   â‹¯-id               (tâ‚ âˆ™ tâ‚‚)                          = congâ‚‚ _âˆ™_ (â‹¯-id tâ‚) (â‹¯-id tâ‚‚)
--   â‹¯-id               (tâ‚ â‡’ tâ‚‚)                          = congâ‚‚ _â‡’_ (â‹¯-id tâ‚) (â‹¯-id tâ‚‚)
--   â‹¯-id               â˜…                                  = refl

-- open KitAssocLemmas kit-assoc-lemmas public

-- -- Types and Contexts ----------------------------------------------------------

-- open import Kitty.Types ğ•‹ kit-traversal kit-assoc kit-assoc-lemmas

-- -- Each variable mode corresponds to a term mode that represents its type.
-- kit-type : KitType
-- kit-type = record { â†‘â‚œ = Î» { ğ•– â†’ ğ•¥ ; ğ•¥ â†’ ğ•œ ; ğ•œ â†’ ğ•œ } }

-- open KitType kit-type public

-- variable
--   Î“ Î“â‚ Î“â‚‚ Î“' Î“â‚' Î“â‚‚' : Ctx Âµ
--   T Tâ‚ Tâ‚‚ T' Tâ‚' Tâ‚‚' : Âµ âˆ¶âŠ¢ M

-- -- Type System -----------------------------------------------------------------

-- data _âŠ¢_âˆ¶_ : Ctx Âµ â†’ Âµ âŠ¢ M â†’ Âµ âˆ¶âŠ¢ M â†’ Set where
--   Ï„-` : âˆ€ {Î“ : Ctx Âµ} {t : Âµ âˆ¶âŠ¢ ğ•–} {x : ğ•– âˆˆ Âµ} â†’
--     wk-telescope Î“ x â‰¡ t â†’
--     Î“ âŠ¢ ` x âˆ¶ t
--   Ï„-Î» : âˆ€ {Î“ : Ctx Âµ} â†’
--     Î“ ,, tâ‚ âŠ¢ e âˆ¶ wk _ tâ‚‚ â†’
--     Î“ âŠ¢ Î»x e âˆ¶ tâ‚ â‡’ tâ‚‚
--   Ï„-Î› :
--     Î“ ,, â˜… âŠ¢ e âˆ¶ tâ‚‚ â†’
--     Î“ âŠ¢ Î›Î± e âˆ¶ âˆ€Î± tâ‚‚
--   Ï„-Â· :
--     Î“ âŠ¢ eâ‚ âˆ¶ tâ‚ â‡’ tâ‚‚ â†’
--     Î“ âŠ¢ eâ‚‚ âˆ¶ tâ‚ â†’
--     Î“ âŠ¢ eâ‚ Â· eâ‚‚ âˆ¶ tâ‚‚
--   Ï„-âˆ™ : âˆ€ {Î“ : Ctx Âµ} â†’
--     Î“ âŠ¢ e âˆ¶ âˆ€Î± tâ‚‚ â†’
--     Î“ âŠ¢ e âˆ™ t âˆ¶ tâ‚‚ â‹¯ â¦… t â¦†
--   Ï„-ğ•¥ :
--     Î“ âŠ¢ t âˆ¶ â˜…
--   Ï„-ğ•œ :
--     Î“ âŠ¢ â˜… âˆ¶ â˜…

-- _âŠ¢*_âˆ¶_ : Ctx Âµâ‚‚ â†’ Âµâ‚ â†’â‚› Âµâ‚‚ â†’ Ctx Âµâ‚ â†’ Set
-- _âŠ¢*_âˆ¶_ {Âµâ‚ = Âµâ‚} Î“â‚‚ Ïƒ Î“â‚ = âˆ€ {mâ‚} â†’ (x : Âµâ‚ âˆ‹ mâ‚) â†’ Î“â‚‚ âŠ¢ Ïƒ _ x âˆ¶ (wk-telescope Î“â‚ x â‹¯ Ïƒ)

-- -- Semantics -------------------------------------------------------------------

-- mutual
--   data Neutral : Âµ âŠ¢ ğ•– â†’ Set where
--     `x  : Neutral (` x)
--     _Â·_ : Neutral eâ‚ â†’ Value eâ‚‚ â†’ Neutral (eâ‚ Â· eâ‚‚)
--     _âˆ™t : Neutral e â†’ Neutral (e âˆ™ t)

--   data Value : Âµ âŠ¢ ğ•– â†’ Set where
--     Î»x_     : Value e â†’ Value (Î»x e)
--     Î›Î±_     : Value e â†’ Value (Î›Î± e)
--     neutral : Neutral e â†’ Value e

-- data _â†ª_ : Âµ âŠ¢ ğ•– â†’ Âµ âŠ¢ ğ•– â†’ Set where
--   Î²-Î» : âˆ€ {eâ‚‚ : Âµ âŠ¢ ğ•–} â†’
--     (Î»x eâ‚) Â· eâ‚‚ â†ª eâ‚ â‹¯ â¦… eâ‚‚ â¦†
--   Î²-Î› : âˆ€ {t : Âµ âŠ¢ ğ•¥} â†’
--     (Î›Î± e) âˆ™ t â†ª e â‹¯ â¦… t â¦†
--   Î¾-Î» :
--     e â†ª e' â†’
--     Î»x e â†ª Î»x e'
--   Î¾-Î› :
--     e â†ª e' â†’
--     Î›Î± e â†ª Î›Î± e'
--   Î¾-Â·â‚ :
--     eâ‚ â†ª eâ‚' â†’
--     eâ‚ Â· eâ‚‚ â†ª eâ‚' Â· eâ‚‚
--   Î¾-Â·â‚‚ :
--     eâ‚‚ â†ª eâ‚‚' â†’
--     eâ‚ Â· eâ‚‚ â†ª eâ‚ Â· eâ‚‚'
--   Î¾-âˆ™ :
--     e â†ª e' â†’
--     e âˆ™ t â†ª e' âˆ™ t
