open import Kitty.Term.Modes
open import Kitty.Term.Traversal using (Traversal; KitHomotopy)
import Kitty.Term.Sub

module Kitty.Term.Compose {ğ•„ : Modes} (ğ•‹ : Terms ğ•„) (T : Traversal ğ•‹) (H : KitHomotopy ğ•‹ T) (ğ•Š : Kitty.Term.Sub.SubWithLaws ğ•‹) where

open import Data.List using (List; []; _âˆ·_)
open import Data.List.Membership.Propositional using (_âˆˆ_)
open import Data.List.Relation.Unary.Any using (here; there)
open import Level using (Level; _âŠ”_) renaming (suc to lsuc; zero to lzero)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; sym; trans; cong; congâ‚‚; subst; module â‰¡-Reasoning)
open import Relation.Nullary using (Â¬_)
open â‰¡-Reasoning

open import Kitty.Term.Prelude
open import Kitty.Term.Kit ğ•‹
open import Kitty.Term.KitOrder ğ•‹
open import Kitty.Term.Sub ğ•‹
open import Kitty.Util.SubstProperties

open Modes ğ•„
open Terms ğ•‹
open Traversal T
open KitHomotopy H
open Kit â¦ƒ â€¦ â¦„
open Sub â¦ƒ â€¦ â¦„
open SubWithLaws â¦ƒ â€¦ â¦„
open ~-Reasoning
open _âŠ‘â‚–_ â¦ƒ â€¦ â¦„

private instance _ = ğ•Š

private
  variable
    m mâ‚ mâ‚‚ mâ‚ƒ m' mâ‚' mâ‚‚' mâ‚ƒ' : VarMode
    M Mâ‚ Mâ‚‚ Mâ‚ƒ M' Mâ‚' Mâ‚‚' Mâ‚ƒ' : TermMode
    Âµ Âµâ‚ Âµâ‚‚ Âµâ‚ƒ Âµ' Âµâ‚' Âµâ‚‚' Âµâ‚ƒ' : List VarMode

-- If the client provides a `ComposeTraversal` which works for all `ComposeKit`s,
-- they get `â‹¯-assoc` for `_áµ£âˆ˜áµ£_`, `_â‚›âˆ˜áµ£_`, `_áµ£âˆ˜â‚›_`, and `_â‚›âˆ˜â‚›_`.

private instance
  _ = kitáµ£
  _ = kitâ‚›

record ComposeKit (ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ : Kit ) : Setâ‚ where
  infixl  8  _ap/â‹¯_
  infixl  9  _Â·â‚–_
  infixr  9  _âˆ˜â‚–_

  private instance _ = ğ•‚â‚; _ = ğ•‚â‚‚; _ = ğ•‚â‚âŠ”ğ•‚â‚‚

  field
    â¦ƒ ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ : ğ•‚â‚ âŠ‘â‚– ğ•‚â‚âŠ”ğ•‚â‚‚
    â¦ƒ ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ : ğ•‚â‚‚ âŠ‘â‚– ğ•‚â‚âŠ”ğ•‚â‚‚

    _ap/â‹¯_ : âˆ€ {m/M}
             â†’ Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] m/M
             â†’ Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚
             â†’ Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚âŠ”ğ•‚â‚‚ ] (Î¹-Mode m/M)

    _Â·â‚–_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
          â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
          â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
          â†’ Âµâ‚ â€“[ ğ•‚â‚âŠ”ğ•‚â‚‚ ]â†’ Âµâ‚ƒ

    ap/â‹¯-Â·â‚– : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m}
                (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
                (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
                (x : Âµâ‚ âˆ‹ m)
              â†’ let sub = subst (Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚âŠ”ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
                apâ‚– (Ï•â‚ Â·â‚– Ï•â‚‚) _ x â‰¡ sub (apâ‚– Ï•â‚ _ x ap/â‹¯ Ï•â‚‚)

    -- ap/â‹¯-wk : âˆ€ {Âµâ‚} {Âµâ‚‚} {m} {mx}
    --             (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    --             (x : Âµâ‚ âˆ‹ mx)
    --           â†’ (apâ‚– Ï• _ x ap/â‹¯ wkâ‚– m id) â‰¡ Î¹-âˆ‹/âŠ¢ (wk _ (apâ‚– Ï• _ x))

-- -- --       let sub  = subst (Âµâ‚‚ âŠ¢_) (_âŠ‘â‚–_.Î¹-mâ†’M/id ğ•‚â‚‚âŠ‘ğ•‚ m/M) in
-- -- --       sub (Kit.`/id' ğ•‚â‚‚ _ x/t â‹¯ Ï•) â‰¡ Kit.`/id' ğ•‚ _ (x/t â‹¯á¶œ Ï•)

    -- tm-ap/â‹¯-Â· : âˆ€ (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    --               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    --               (x/t : Âµâ‚ âˆ‹/âŠ¢ m)
    --             â†’ `/id' _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚ â‰¡ `/id _ (apâ‚– (Ï•â‚ Â·â‚– Ï•â‚‚) _ x)

    -- ap/â‹¯-ap : âˆ€ {m/M} (x/t : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] m/M) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) 
    --           â†’ let sub = subst (Âµâ‚‚ âŠ¢_) (Î¹-mâ†’M/id m/M) in
    --             `/id' â¦ƒ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ _ (x/t ap/â‹¯ Ï•) â‰¡ sub (`/id' â¦ƒ ğ•‚â‚ â¦„ _ x/t â‹¯ Ï•)

    -- TODO: can be derived maybe
    tm-â‹¯-Â· : âˆ€ (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
               (x : Âµâ‚ âˆ‹ m)
             â†’ `/id _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚ â‰¡ `/id _ (apâ‚– (Ï•â‚ Â·â‚– Ï•â‚‚) _ x)

    dist-â†‘-Â· : âˆ€ m
                 (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
                 (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
               â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m))

    -- dist-wk-Â· : âˆ€ m
    --               (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    --               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    --             â†’ wkâ‚– m (Ï•â‚ Â·â‚– Ï•â‚‚) ~ (Ï•â‚ Â·â‚– wkâ‚– m Ï•â‚‚)

    -- dist-,â‚–-Â·Ë¡ : âˆ€ {m}
    --                (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    --                (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    --                (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] id/mâ†’M m)
    --              â†’ let sub = subst (Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
    --                ((Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚– sub (x/t ap/â‹¯ Ï•â‚‚)) ~ ((Ï•â‚ ,â‚– x/t) Â·â‚– Ï•â‚‚)

    -- dist-,â‚–-Â·Ê³ : âˆ€ {m}
    --                (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    --                (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    --                (x/t : Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m)
    --              â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚–' x/t) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ ,â‚– x/t))

    -- -- dist-,â‚–-Â·Ê³ : âˆ€ {m}
    -- --                (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    -- --                (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    -- --                (x/t : Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m)
    -- --              â†’ let sub = subst (Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
    -- --                (((Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚– sub (Î¹-âˆ‹/âŠ¢ x/t))) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ ,â‚– x/t))

    ~-cong-Â· : âˆ€ {Ï•â‚ Ï•â‚' : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚}
                 {Ï•â‚‚ Ï•â‚‚' : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ}
               â†’ Ï•â‚ ~ Ï•â‚'
               â†’ Ï•â‚‚ ~ Ï•â‚‚'
               â†’ (Ï•â‚ Â·â‚– Ï•â‚‚) ~ (Ï•â‚' Â·â‚– Ï•â‚‚')

    ~-cong-ap/â‹¯ :
      âˆ€ {x/tâ‚ x/tâ‚‚ : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] (id/mâ†’M m)}
        {Ï•â‚ Ï•â‚‚ : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚}
      â†’ x/tâ‚ â‰¡ x/tâ‚‚
      â†’ Ï•â‚ ~ Ï•â‚‚
      â†’ x/tâ‚ ap/â‹¯ Ï•â‚ â‰¡ x/tâ‚‚ ap/â‹¯ Ï•â‚‚

  _âˆ˜â‚–_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
        â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
        â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
        â†’ Âµâ‚ â€“[ ğ•‚â‚âŠ”ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
  Ï•â‚‚ âˆ˜â‚– Ï•â‚ = Ï•â‚ Â·â‚– Ï•â‚‚

  -- tm-â‹¯-Â· : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m}
  --               (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
  --               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
  --               (x : Âµâ‚ âˆ‹ m)
  --             â†’ `/id _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚ â‰¡ `/id _ (apâ‚– (Ï•â‚ Â·â‚– Ï•â‚‚) _ x)
  -- tm-â‹¯-Â· {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m} Ï•â‚ Ï•â‚‚ x =
  --   let sub = subst (Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚âŠ”ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
  --   `/id _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚          â‰¡âŸ¨ {!!} âŸ©
  --   `/id _ (sub (apâ‚– Ï•â‚ _ x ap/â‹¯ Ï•â‚‚)) â‰¡âŸ¨ cong (`/id _) (sym (ap/â‹¯-Â·â‚– Ï•â‚ Ï•â‚‚ x)) âŸ©
  --   `/id _ (apâ‚– (Ï•â‚ Â·â‚– Ï•â‚‚) _ x)       âˆ

  dist-â†‘*-Â· : âˆ€ Âµ (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ) â†’
    ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* Âµ) ~ ((Ï•â‚ â†‘* Âµ) Â·â‚– (Ï•â‚‚ â†‘* Âµ))
  dist-â†‘*-Â· []      Ï•â‚ Ï•â‚‚ =
    ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* [])         ~âŸ¨ â†‘*-[] (Ï•â‚ Â·â‚– Ï•â‚‚) âŸ©
    Ï•â‚ Â·â‚– Ï•â‚‚                   ~âŸ¨ ~-sym (~-cong-Â· (â†‘*-[] Ï•â‚) (â†‘*-[] Ï•â‚‚)) âŸ©
    ((Ï•â‚ â†‘* []) Â·â‚– (Ï•â‚‚ â†‘* [])) ~âˆ
  dist-â†‘*-Â· (Âµ â–· m) Ï•â‚ Ï•â‚‚ =
    (Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* (Âµ â–· m)               ~âŸ¨ â†‘*-â–· Âµ m (Ï•â‚ Â·â‚– Ï•â‚‚) âŸ©
    ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* Âµ) â†‘ m               ~âŸ¨ ~-cong-â†‘ (dist-â†‘*-Â· Âµ Ï•â‚ Ï•â‚‚) âŸ©
    ((Ï•â‚ â†‘* Âµ) Â·â‚– (Ï•â‚‚ â†‘* Âµ)) â†‘ m        ~âŸ¨ dist-â†‘-Â· m (Ï•â‚ â†‘* Âµ) (Ï•â‚‚ â†‘* Âµ) âŸ©
    ((Ï•â‚ â†‘* Âµ) â†‘ m) Â·â‚– ((Ï•â‚‚ â†‘* Âµ) â†‘ m)  ~âŸ¨ ~-sym (~-cong-Â· (â†‘*-â–· Âµ m Ï•â‚) (â†‘*-â–· Âµ m Ï•â‚‚)) âŸ©
    (Ï•â‚ â†‘* (Âµ â–· m)) Â·â‚– (Ï•â‚‚ â†‘* (Âµ â–· m))  ~âˆ

infixl  8  _ap/â‹¯[_]_
infixl  9  _Â·[_]_
infixr  9  _âˆ˜[_]_

_ap/â‹¯[_]_ : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ {m/M}
            â†’ Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] m/M
            â†’ (C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚)
            â†’ Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚
            â†’ Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚âŠ”ğ•‚â‚‚ ] (Î¹-Mode â¦ƒ ComposeKit.ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ C â¦„ m/M)
x/t ap/â‹¯[ C ] Ï• = x/t ap/â‹¯ Ï• where open ComposeKit C

_Â·[_]_ : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
         â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
         â†’ ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚
         â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
         â†’ Âµâ‚ â€“[ ğ•‚â‚âŠ”ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
Ï•â‚ Â·[ C ] Ï•â‚‚ = Ï•â‚ Â·â‚– Ï•â‚‚ where open ComposeKit C


_âˆ˜[_]_ : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
         â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
         â†’ ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚
         â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
         â†’ Âµâ‚ â€“[ ğ•‚â‚âŠ”ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
Ï•â‚‚ âˆ˜[ C ] Ï•â‚ = Ï•â‚‚ âˆ˜â‚– Ï•â‚ where open ComposeKit C

  -- dist-â†‘-Â· : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m
  --              (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
  --              (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
  --            â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m))
  -- dist-â†‘-Â· {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ mx x@(here refl) =
  --   let sub = subst ((Âµâ‚ƒ â–· m) âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
  --   let sub' = subst ((Âµâ‚ƒ â–· m) âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in -- different âŠ‘-instance
  --   apâ‚– ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m) _ x                  â‰¡âŸ¨ apâ‚–-â†‘-here (Ï•â‚ Â·â‚– Ï•â‚‚) âŸ©
  --   id/` _ (here refl)                        â‰¡âŸ¨ {!Î¹-`/id!} âŸ©
  --   sub' (Î¹-âˆ‹/âŠ¢ (id/` _ (here refl)))         â‰¡âŸ¨ cong (Î» â–  â†’ sub' (Î¹-âˆ‹/âŠ¢ â– )) (sym (apâ‚–-â†‘-here Ï•â‚‚)) âŸ©
  --   sub' (Î¹-âˆ‹/âŠ¢ (apâ‚– (Ï•â‚‚ â†‘ m) _ (here refl))) â‰¡âŸ¨ sym (Î¹-ap-â†’ (Ï•â‚‚ â†‘ m) (here refl)) âŸ© -- requires ğ•‚â‚‚âŠ‘âŠ”
  --   apâ‚– (Î¹-â†’ (Ï•â‚‚ â†‘ m)) _(here refl)           â‰¡âŸ¨ {!!} âŸ©
  --   sub (id/` _ (here refl) ap/â‹¯ (Ï•â‚‚ â†‘ m))    â‰¡âŸ¨ {!!} âŸ©
  --   sub (apâ‚– (Ï•â‚ â†‘ m) _ x ap/â‹¯ (Ï•â‚‚ â†‘ m))      â‰¡âŸ¨ {!!} âŸ©
  --   apâ‚– ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m)) _ x            âˆ
  -- dist-â†‘-Â· {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ mx x@(there y) = {!!}

  -- dist-â†‘-Â· : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m
  --              (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
  --              (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
  --            â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m))
  -- dist-â†‘-Â· {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ =
  --   ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m)                                                       ~âŸ¨ â†‘-,â‚– (Ï•â‚ Â·â‚– Ï•â‚‚) m âŸ©
  --   (wkâ‚– m (Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚– id/` _ (here refl))                               ~âŸ¨ ~-cong-,â‚– (dist-wk-Â· m Ï•â‚ Ï•â‚‚) refl âŸ©
  --   ((Ï•â‚ Â·â‚– wkâ‚– m Ï•â‚‚) ,â‚– id/` _ (here refl))                               ~âŸ¨ {!!} âŸ©
  --   ((wkâ‚– m Ï•â‚ ,â‚– id/` _ (here refl)) Â·â‚– (wkâ‚– m Ï•â‚‚ ,â‚– id/` _ (here refl))) ~âŸ¨ ~-sym (~-cong-Â· (â†‘-,â‚– Ï•â‚ m) (â†‘-,â‚– Ï•â‚‚ m)) âŸ©
  --   ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m))                                                 ~âˆ
    
  -- dist-â†‘-Â· {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ =
  --   let sub = subst ((Âµâ‚ƒ â–· m) âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
  --   ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m)                         ~âŸ¨ â†‘-,â‚– (Ï•â‚ Â·â‚– Ï•â‚‚) m âŸ©
  --   (wkâ‚– m (Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚– id/` _ (here refl)) ~âŸ¨ {!!} âŸ©
  --   ((Ï•â‚ Â·â‚– wkâ‚– m Ï•â‚‚) ,â‚– id/` _ (here refl)) ~âŸ¨ {!!} âŸ©
  --   ((Ï•â‚ Â·â‚– wkâ‚– m Ï•â‚‚) ,â‚– sub ({!id/` _ (here refl)!} ap/â‹¯ wkâ‚– m Ï•â‚‚)) ~âŸ¨ {!!} âŸ©
  --   ((wkâ‚– m Ï•â‚ ,â‚– id/` _ (here refl)) Â·â‚– (wkâ‚– m Ï•â‚‚ ,â‚– id/` _ (here refl))) ~âŸ¨ ~-sym (~-cong-Â· (â†‘-,â‚– Ï•â‚ m) (â†‘-,â‚– Ï•â‚‚ m)) âŸ©
  --   ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m)) ~âˆ

  -- dist-,â‚–-Â· : âˆ€ {m}
  --               (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
  --               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
  --               (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] id/mâ†’M m)
  --             â†’ let sub = subst (Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
  --               ((Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚– sub (x/t ap/â‹¯ Ï•â‚‚)) ~ (Ï•â‚ ,â‚– x/t Â·â‚– Ï•â‚‚)

-- ComposeKit for Renamings ----------------------------------------------------

infixl  9  _áµ£Â·_  _áµ£Â·áµ£_  _áµ£Â·â‚›_
infixr  9  _âˆ˜áµ£_  _áµ£âˆ˜áµ£_  _â‚›âˆ˜áµ£_

_áµ£Â·_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
Ï áµ£Â· Ï• = pre Ï• (apâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ Ï)

_âˆ˜áµ£_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
Ï•â‚‚ âˆ˜áµ£ Ï•â‚ = Ï•â‚ áµ£Â· Ï•â‚‚

_áµ£Â·áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ
_áµ£Â·â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
_áµ£âˆ˜áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ
_â‚›âˆ˜áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
_áµ£Â·áµ£_ = _áµ£Â·_
_áµ£Â·â‚›_ = _áµ£Â·_
_áµ£âˆ˜áµ£_ = _âˆ˜áµ£_
_â‚›âˆ˜áµ£_ = _âˆ˜áµ£_

ap-áµ£Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m}
          (Ï : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
          (Ï• : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
          (x : Âµâ‚ âˆ‹ m)
        â†’ apâ‚– (Ï áµ£Â· Ï•) _ x â‰¡ apâ‚– Ï• _ (apâ‚– Ï _ x)
ap-áµ£Â· â¦ƒ ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m} Ï Ï• x =
  apâ‚– (Ï áµ£Â· Ï•) _ x        â‰¡âŸ¨âŸ©
  apâ‚– (pre Ï• (apâ‚– Ï)) _ x â‰¡âŸ¨ apâ‚–-pre Ï• (apâ‚– Ï) x âŸ©
  apâ‚– Ï• _ (apâ‚– Ï _ x)     âˆ

~-cong-áµ£Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„
               {Ï•â‚ Ï•â‚' : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚}
               {Ï•â‚‚ Ï•â‚‚' : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ}
             â†’ Ï•â‚ ~ Ï•â‚'
             â†’ Ï•â‚‚ ~ Ï•â‚‚'
             â†’ (Ï•â‚ áµ£Â· Ï•â‚‚) ~ (Ï•â‚' áµ£Â· Ï•â‚‚')
~-cong-áµ£Â· â¦ƒ ğ•‚â‚‚ â¦„ {Ï•â‚} {Ï•â‚'} {Ï•â‚‚} {Ï•â‚‚'} Ï•â‚~Ï•â‚' Ï•â‚‚~Ï•â‚‚' m x =
  apâ‚– (Ï•â‚  áµ£Â· Ï•â‚‚ ) m x        â‰¡âŸ¨âŸ©
  apâ‚– (pre Ï•â‚‚  (apâ‚– Ï•â‚ )) m x â‰¡âŸ¨ apâ‚–-pre Ï•â‚‚ (apâ‚– Ï•â‚) x âŸ©
  apâ‚– Ï•â‚‚  _ (apâ‚– Ï•â‚  m x)     â‰¡âŸ¨ cong (apâ‚– Ï•â‚‚ _) (Ï•â‚~Ï•â‚' m x) âŸ©
  apâ‚– Ï•â‚‚  _ (apâ‚– Ï•â‚' m x)     â‰¡âŸ¨ Ï•â‚‚~Ï•â‚‚' _ (apâ‚– Ï•â‚' m x) âŸ©
  apâ‚– Ï•â‚‚' _ (apâ‚– Ï•â‚' m x)     â‰¡âŸ¨ sym (apâ‚–-pre Ï•â‚‚' (apâ‚– Ï•â‚') x) âŸ©
  apâ‚– (pre Ï•â‚‚' (apâ‚– Ï•â‚')) m x â‰¡âŸ¨âŸ©
  apâ‚– (Ï•â‚' áµ£Â· Ï•â‚‚') m x        âˆ

dist-â†‘-áµ£Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m
               (Ï•â‚ : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
             â†’ ((Ï•â‚ áµ£Â· Ï•â‚‚) â†‘ m) ~ ((Ï•â‚ â†‘ m) áµ£Â· (Ï•â‚‚ â†‘ m))
dist-â†‘-áµ£Â· â¦ƒ ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ mx x@(here refl) =
  apâ‚– ((Ï•â‚ áµ£Â· Ï•â‚‚) â†‘ m) _ x            â‰¡âŸ¨ apâ‚–-â†‘-here (Ï•â‚ áµ£Â· Ï•â‚‚) âŸ©
  id/` _ (here refl)                  â‰¡âŸ¨ sym (apâ‚–-â†‘-here Ï•â‚‚) âŸ©
  apâ‚– (Ï•â‚‚ â†‘ m) _ (here refl)          â‰¡âŸ¨âŸ©
  apâ‚– (Ï•â‚‚ â†‘ m) _ (id/` _ (here refl)) â‰¡âŸ¨ cong (apâ‚– (Ï•â‚‚ â†‘ m) _) (sym (apâ‚–-â†‘-here Ï•â‚)) âŸ©
  apâ‚– (Ï•â‚‚ â†‘ m) _ (apâ‚– (Ï•â‚ â†‘ m) _ x)   â‰¡âŸ¨ sym (apâ‚–-pre (Ï•â‚‚ â†‘ m) (apâ‚– (Ï•â‚ â†‘ m)) x) âŸ©
  apâ‚– ((Ï•â‚ â†‘ m) áµ£Â· (Ï•â‚‚ â†‘ m)) _ x      âˆ
dist-â†‘-áµ£Â· â¦ƒ ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ mx x@(there y) =
  apâ‚– ((Ï•â‚ áµ£Â· Ï•â‚‚) â†‘ m) _ x            â‰¡âŸ¨ apâ‚–-â†‘-there (Ï•â‚ áµ£Â· Ï•â‚‚) y âŸ©
  wk _ (apâ‚– (Ï•â‚ áµ£Â· Ï•â‚‚) _ y)           â‰¡âŸ¨ cong (wk _) (apâ‚–-pre Ï•â‚‚ (apâ‚– Ï•â‚) y) âŸ©
  wk _ (apâ‚– Ï•â‚‚ _ (apâ‚– Ï•â‚ _ y))        â‰¡âŸ¨ sym (apâ‚–-â†‘-there Ï•â‚‚ (apâ‚– Ï•â‚ _ y)) âŸ©
  apâ‚– (Ï•â‚‚ â†‘ m) _ (there (apâ‚– Ï•â‚ _ y)) â‰¡âŸ¨âŸ©
  apâ‚– (Ï•â‚‚ â†‘ m) _ (wk _ (apâ‚– Ï•â‚ _ y))  â‰¡âŸ¨ cong (apâ‚– (Ï•â‚‚ â†‘ m) _) (sym (apâ‚–-â†‘-there Ï•â‚ y)) âŸ©
  apâ‚– (Ï•â‚‚ â†‘ m) _ (apâ‚– (Ï•â‚ â†‘ m) _ x)   â‰¡âŸ¨ sym (apâ‚–-pre (Ï•â‚‚ â†‘ m) (apâ‚– (Ï•â‚ â†‘ m)) x) âŸ©
  apâ‚– ((Ï•â‚ â†‘ m) áµ£Â· (Ï•â‚‚ â†‘ m)) _ x      âˆ

tm-â‹¯-áµ£Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
             (Ï•â‚ : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
             (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
             (x : Âµâ‚ âˆ‹ m)
           â†’ `/id _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚ â‰¡ `/id _ (apâ‚– (Ï•â‚ áµ£Â· Ï•â‚‚) _ x)
tm-â‹¯-áµ£Â· â¦ƒ ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} Ï•â‚ Ï•â‚‚ x =
  `/id _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚       â‰¡âŸ¨âŸ©
  ` (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚            â‰¡âŸ¨ â‹¯-var (apâ‚– Ï•â‚ _ x) Ï•â‚‚ âŸ©
  `/id _ (apâ‚– Ï•â‚‚ _ (apâ‚– Ï•â‚ _ x)) â‰¡âŸ¨ cong (`/id _) (sym (apâ‚–-pre Ï•â‚‚ (apâ‚– Ï•â‚) x)) âŸ©
  `/id _ (apâ‚– (Ï•â‚ áµ£Â· Ï•â‚‚) _ x)    âˆ

ap/â‹¯-wkáµ£ : âˆ€ â¦ƒ ğ•‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx}
             (Ï• : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
             (x : Âµâ‚ âˆ‹ mx)
           â†’ (apâ‚– (wkâ‚– â¦ƒ ğ•‚ = ğ•‚ â¦„ m id) _ (apâ‚– Ï• _ x)) â‰¡ Î¹-âˆ‹/âŠ¢ â¦ƒ âŠ‘â‚–-âŠ¥ â¦ƒ ğ•‚ â¦„ â¦„ (wk _ (apâ‚– Ï• _ x))
ap/â‹¯-wkáµ£ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx} Ï• x =
  apâ‚– (wkâ‚– _ id) _ (apâ‚– Ï• _ x)            â‰¡âŸ¨ apâ‚–-wkâ‚–-wk id (apâ‚– Ï• _ x) âŸ©
  wk _ (apâ‚– id _ (apâ‚– Ï• _ x))             â‰¡âŸ¨ cong (wk _) (apâ‚–-id (apâ‚– Ï• _ x)) âŸ©
  wk _ (id/` _ (apâ‚– Ï• _ x))               â‰¡âŸ¨ sym (Î¹-wk â¦ƒ âŠ‘â‚–-âŠ¥ â¦ƒ ğ•‚ â¦„ â¦„ {m = m} (apâ‚– Ï• _ x)) âŸ©
  Î¹-âˆ‹/âŠ¢ â¦ƒ âŠ‘â‚–-âŠ¥ â¦ƒ ğ•‚ â¦„ â¦„ (wk _ (apâ‚– Ï• _ x)) âˆ

ckitáµ£ : âˆ€ â¦ƒ ğ•‚ â¦„ â†’ ComposeKit kitáµ£ ğ•‚ ğ•‚
ckitáµ£ â¦ƒ ğ•‚ â¦„ = record
  { ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚   = âŠ‘â‚–-âŠ¥ â¦ƒ ğ•‚ â¦„
  ; ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚   = âŠ‘â‚–-refl â¦ƒ ğ•‚ â¦„
  ; _ap/â‹¯_      = Î» x Ï• â†’ apâ‚– Ï• _ x
  ; _Â·â‚–_        = _áµ£Â·_
  ; ap/â‹¯-Â·â‚–     = ap-áµ£Â·
  -- ; ap/â‹¯-wk     = ap/â‹¯-wkáµ£
  ; tm-â‹¯-Â·      = tm-â‹¯-áµ£Â·
  ; dist-â†‘-Â·    = dist-â†‘-áµ£Â·
  ; ~-cong-Â·    = ~-cong-áµ£Â·
  ; ~-cong-ap/â‹¯ = Î» { refl Ï•â‚~Ï•â‚‚ â†’ Ï•â‚~Ï•â‚‚ _ _ }
  }

private instance _ = ckitáµ£

-- ComposeTraversal ------------------------------------------------------------

record ComposeTraversal : Setâ‚ where
  open ComposeKit â¦ƒ â€¦ â¦„

  field
    â‹¯-assoc : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ : Kit â¦„ â¦ƒ ğ”¸ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
                (t : Âµâ‚ âŠ¢ M) (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ) â†’
      (t â‹¯ Ï•â‚) â‹¯ Ï•â‚‚ â‰¡ t â‹¯ (Ï•â‚ Â·â‚– Ï•â‚‚)

  -- Example:
  --
  --   instance kit-assoc : ComposeTraversal {{traversal}}
  --   ComposeTraversal.â‹¯-assoc kit-assoc (` x) f g =
  --     tm' (f _ x) â‹¯ g    â‰¡âŸ¨ tm'-â‹¯-âˆ˜ f g x âŸ©
  --     tm' ((g âˆ˜â‚– f) _ x) âˆ
  --   ComposeTraversal.â‹¯-assoc kit-assoc (Î»â†’ e) f g = cong Î»â†’_
  --     (e â‹¯ f â†‘ _ â‹¯ g â†‘ _        â‰¡âŸ¨ â‹¯-assoc e (f â†‘ _) (g â†‘ _) âŸ©
  --      e â‹¯ ((g â†‘ _) âˆ˜â‚– (f â†‘ _)) â‰¡âŸ¨ cong (e â‹¯_) (sym (dist-â†‘-âˆ˜ _ g f)) âŸ©
  --      e â‹¯ (g âˆ˜â‚– f) â†‘ _         âˆ)
  --   ComposeTraversal.â‹¯-assoc kit-assoc (eâ‚ Â· eâ‚‚) f g = congâ‚‚ _Â·_ (â‹¯-assoc eâ‚ f g) (â‹¯-assoc eâ‚‚ f g)

  -- ComposeKit for Substitutions ------------------------------------------------

  infixl  9  _â‚›Â·_  _â‚›Â·áµ£_  _â‚›Â·â‚›_
  infixr  9  _âˆ˜â‚›_  _áµ£âˆ˜â‚›_  _â‚›âˆ˜â‚›_

  _â‚›Â·_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
        â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚
        â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
        â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  Ïƒ â‚›Â· Ï• = post â¦ƒ ğ•‚ = kitâ‚› â¦„ Ïƒ (Î» _ t â†’ t â‹¯ Ï•)

  _âˆ˜â‚›_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  Ï•â‚‚ âˆ˜â‚› Ï•â‚ = Ï•â‚ â‚›Â· Ï•â‚‚

  _â‚›Â·áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _â‚›Â·â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _áµ£âˆ˜â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _â‚›âˆ˜â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _â‚›Â·áµ£_ = _â‚›Â·_
  _â‚›Â·â‚›_ = _â‚›Â·_
  _áµ£âˆ˜â‚›_ = _âˆ˜â‚›_
  _â‚›âˆ˜â‚›_ = _âˆ˜â‚›_

  â‹¯-â‚›Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m}
           (Ïƒ : Âµâ‚ â€“[ kitâ‚›  ]â†’ Âµâ‚‚)
           (Ï• : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
           (x : Âµâ‚ âˆ‹ m)
         â†’ apâ‚– (Ïƒ â‚›Â· Ï•) _ x â‰¡ apâ‚– Ïƒ _ x â‹¯ Ï•
  â‹¯-â‚›Â· â¦ƒ ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m} Ïƒ Ï• x =
    apâ‚– (Ïƒ â‚›Â· Ï•) _ x â‰¡âŸ¨âŸ©
    apâ‚– (post Ïƒ (Î» _ t â†’ t â‹¯ Ï•)) _ x â‰¡âŸ¨ apâ‚–-post Ïƒ (Î» _ t â†’ t â‹¯ Ï•) x âŸ©
    apâ‚– Ïƒ _ x â‹¯ Ï•    âˆ

  ~-cong-â‚›Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„
                {Ï•â‚ Ï•â‚' : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚}
                {Ï•â‚‚ Ï•â‚‚' : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ}
              â†’ Ï•â‚ ~ Ï•â‚'
              â†’ Ï•â‚‚ ~ Ï•â‚‚'
              â†’ (Ï•â‚ â‚›Â· Ï•â‚‚) ~ (Ï•â‚' â‚›Â· Ï•â‚‚')
  ~-cong-â‚›Â· â¦ƒ ğ•‚â‚‚ â¦„ {Ï•â‚} {Ï•â‚'} {Ï•â‚‚} {Ï•â‚‚'} Ï•â‚~Ï•â‚' Ï•â‚‚~Ï•â‚‚' m x =
    apâ‚– (Ï•â‚  â‚›Â· Ï•â‚‚ ) m x                 â‰¡âŸ¨âŸ©
    apâ‚– (post Ï•â‚ (Î» _ t â†’ t â‹¯ Ï•â‚‚)) m x   â‰¡âŸ¨ apâ‚–-post Ï•â‚ (Î» _ t â†’ t â‹¯ Ï•â‚‚) x âŸ©
    apâ‚– Ï•â‚  m x â‹¯ Ï•â‚‚                     â‰¡âŸ¨ ~-cong-â‹¯ (apâ‚– Ï•â‚  m x) Ï•â‚‚~Ï•â‚‚' âŸ©
    apâ‚– Ï•â‚  m x â‹¯ Ï•â‚‚'                    â‰¡âŸ¨ cong (_â‹¯ Ï•â‚‚') (Ï•â‚~Ï•â‚' m x) âŸ©
    apâ‚– Ï•â‚' m x â‹¯ Ï•â‚‚'                    â‰¡âŸ¨ sym (apâ‚–-post Ï•â‚' (Î» _ t â†’ t â‹¯ Ï•â‚‚') x) âŸ©
    apâ‚– (post Ï•â‚' (Î» _ t â†’ t â‹¯ Ï•â‚‚')) m x â‰¡âŸ¨âŸ©
    apâ‚– (Ï•â‚' â‚›Â· Ï•â‚‚') m x                 âˆ

  tm-â‹¯-â‚›Â· : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
              (Ï•â‚ : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚)
              (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
              (x : Âµâ‚ âˆ‹ m)
            â†’ `/id â¦ƒ kitâ‚› â¦„ _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚ â‰¡ `/id â¦ƒ kitâ‚› â¦„ _ (apâ‚– (Ï•â‚ â‚›Â· Ï•â‚‚) _ x)
  tm-â‹¯-â‚›Â· â¦ƒ ğ•‚â‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} Ï•â‚ Ï•â‚‚ x =
    `/id â¦ƒ kitâ‚› â¦„ _ (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚    â‰¡âŸ¨âŸ©
    (apâ‚– Ï•â‚ _ x) â‹¯ Ï•â‚‚                          â‰¡âŸ¨ sym (apâ‚–-post Ï•â‚ (Î» _ t â†’ t â‹¯ Ï•â‚‚) x) âŸ©
    apâ‚– (Ï•â‚ â‚›Â· Ï•â‚‚) _ x                         â‰¡âŸ¨âŸ©
    `/id â¦ƒ kitâ‚› â¦„ _ (apâ‚– (Ï•â‚ â‚›Â· Ï•â‚‚) _ x) âˆ

  -- ap/â‹¯-wkâ‚› : âˆ€ â¦ƒ ğ•‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx}
  --             (Ï• : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚)
  --             (x : Âµâ‚ âˆ‹ mx)
  --           â†’ ((apâ‚– Ï• _ x) â‹¯ (wkâ‚– â¦ƒ ğ•‚ = ğ•‚ â¦„ m id)) â‰¡ Î¹-âˆ‹/âŠ¢ â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•Š â¦„ â¦ƒ kitâ‚› â¦„ â¦„ (wk _ (apâ‚– Ï• _ x))
  -- ap/â‹¯-wkâ‚› â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx} Ï• x =
  --   apâ‚– Ï• _ x â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚ â¦„ _ id                  â‰¡âŸ¨ {!refl!} âŸ©
  --   apâ‚– Ï• _ x â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id               â‰¡âŸ¨âŸ©
  --   wk _ (apâ‚– Ï• _ x)                                â‰¡âŸ¨ sym (Î¹-wk â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•Š â¦„ â¦ƒ kitâ‚› â¦„ â¦„ {m = m} (apâ‚– Ï• _ x)) âŸ©
  --   Î¹-âˆ‹/âŠ¢ â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•Š â¦„ â¦ƒ kitâ‚› â¦„ â¦„ (wk _ (apâ‚– Ï• _ x)) âˆ

  open ComposeKit â¦ƒ â€¦ â¦„

  record WkDistKit {ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit} (Câ‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚) (Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ ğ•‚) : Setâ‚ where
    private instance _ = ğ•‚â‚; _ = ğ•‚â‚‚; _ = ğ•‚
    field
      â†‘-wk : âˆ€ {Âµâ‚} {Âµâ‚‚} m
              (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
            â†’ (Ï• Â·[ Câ‚ ] wkâ‚– _ id) ~ (wkâ‚– _ id Â·[ Câ‚‚ ] (Ï• â†‘ m))

  open WkDistKit â¦ƒ â€¦ â¦„

  apâ‚–-wk-â†‘ : âˆ€ â¦ƒ ğ•‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {mx}
          (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) m
          (x : Âµâ‚ âˆ‹ mx)
        â†’ apâ‚– (wkâ‚– _ id áµ£Â· (Ï• â†‘ m)) _ x â‰¡ wk _ (apâ‚– Ï• _ x)
  apâ‚–-wk-â†‘ {Âµâ‚} {Âµâ‚‚} Ï• m x =
    apâ‚– (wkâ‚– _ id áµ£Â· (Ï• â†‘ m)) _ x      â‰¡âŸ¨ apâ‚–-pre (Ï• â†‘ m) (apâ‚– (wkâ‚– _ id)) x âŸ©
    apâ‚– (Ï• â†‘ m) _ (apâ‚– (wkâ‚– _ id) _ x) â‰¡âŸ¨ cong (apâ‚– (Ï• â†‘ m) _) (apâ‚–-wkâ‚–-wk id x) âŸ©
    apâ‚– (Ï• â†‘ m) _ (there (apâ‚– id _ x)) â‰¡âŸ¨ cong (Î» â–  â†’ apâ‚– (Ï• â†‘ m) _ (there â– )) (apâ‚–-id x) âŸ©
    apâ‚– (Ï• â†‘ m) _ (there x)            â‰¡âŸ¨ apâ‚–-â†‘-there Ï• x âŸ©
    wk _ (apâ‚– Ï• _ x)                   âˆ

  apâ‚–-wk-â†‘' : âˆ€ â¦ƒ ğ•‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {mx}
          (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) m
          (x : Âµâ‚ âˆ‹ mx)
        â†’ apâ‚– (wkâ‚– _ id â‚›Â· (Ï• â†‘ m)) _ x â‰¡ `/id _ (wk _ (apâ‚– Ï• _ x))
  apâ‚–-wk-â†‘' {Âµâ‚} {Âµâ‚‚} Ï• m x =
    apâ‚– (wkâ‚– _ id â‚›Â· (Ï• â†‘ m)) _ x                â‰¡âŸ¨ apâ‚–-post (wkâ‚– _ id) (Î» _ t â†’ t â‹¯ (Ï• â†‘ m)) x âŸ©
    (apâ‚– (wkâ‚– _ id) _ x) â‹¯ (Ï• â†‘ m)               â‰¡âŸ¨ cong (_â‹¯ (Ï• â†‘ m)) (apâ‚–-wkâ‚–-wk id x) âŸ©
    wk _ (apâ‚– id _ x) â‹¯ (Ï• â†‘ m)                  â‰¡âŸ¨ cong (Î» â–  â†’ wk â¦ƒ kitâ‚› â¦„ _ â–  â‹¯ (Ï• â†‘ m)) (apâ‚–-id x) âŸ©
    wk _ (` x) â‹¯ (Ï• â†‘ m)                         â‰¡âŸ¨ cong (_â‹¯ Ï• â†‘ m) (sym (Î¹-wk â¦ƒ âŠ‘-áµ£â‚› â¦„ {m = m} x)) âŸ©
    ` there x â‹¯ (Ï• â†‘ m)                          â‰¡âŸ¨ â‹¯-var (there x) (Ï• â†‘ m) âŸ©
    `/id _ (apâ‚– (Ï• â†‘ m) _ (there x))             â‰¡âŸ¨ cong (`/id _) (apâ‚–-â†‘-there Ï• x) âŸ©
    `/id _ (wk _ (apâ‚– Ï• _ x))                    âˆ

  â†‘-wkáµ£ : âˆ€ {Âµâ‚} {Âµâ‚‚} m
            (Ï• : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
          â†’ (Ï• áµ£Â· wkâ‚– _ id) ~ (wkâ‚– _ id áµ£Â· (Ï• â†‘ m))
  â†‘-wkáµ£ {Âµâ‚} {Âµâ‚‚} m Ï• mx x =
    apâ‚– (Ï• áµ£Â· wkâ‚– _ id) _ x            â‰¡âŸ¨ apâ‚–-pre (wkâ‚– _ id) (apâ‚– Ï•) x âŸ©
    apâ‚– (wkâ‚– _ id) _ (apâ‚– Ï• _ x)       â‰¡âŸ¨ apâ‚–-wkâ‚–-wk id (apâ‚– Ï• _ x) âŸ©
    wk _ (apâ‚– id _ (apâ‚– Ï• _ x))        â‰¡âŸ¨ cong (wk _) (apâ‚–-id (apâ‚– Ï• _ x)) âŸ©
    wk _ (apâ‚– Ï• _ x)                   â‰¡âŸ¨ sym (apâ‚–-wk-â†‘ Ï• m x) âŸ©
    apâ‚– (wkâ‚– _ id áµ£Â· (Ï• â†‘ m)) _ x      âˆ

  wkkitáµ£ : WkDistKit ckitáµ£ ckitáµ£
  wkkitáµ£ = record { â†‘-wk = â†‘-wkáµ£ }

  private instance _ = wkkitáµ£

  â†‘-wkâ‚› : âˆ€ {Âµâ‚} {Âµâ‚‚} m
            (Ï• : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚)
          â†’ (Ï• â‚›Â·áµ£ wkâ‚– _ id) ~ (wkâ‚– _ id áµ£Â· (Ï• â†‘ m))
  â†‘-wkâ‚› {Âµâ‚} {Âµâ‚‚} m Ï• mx x =
    apâ‚– (Ï• â‚›Â· wkâ‚– _ id) _ x            â‰¡âŸ¨ apâ‚–-post Ï• (Î» _ t â†’ t â‹¯ wkâ‚– _ id) x âŸ©
    apâ‚– Ï• _ x â‹¯áµ£ wkâ‚– _ id              â‰¡âŸ¨âŸ©
    wk _ (apâ‚– Ï• _ x)                   â‰¡âŸ¨ sym (apâ‚–-wk-â†‘ Ï• m x) âŸ©
    apâ‚– (wkâ‚– _ id áµ£Â· (Ï• â†‘ m)) _ x      âˆ

  dist-â†‘-Â·' : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ â¦ƒ C : ComposeKit ğ•‚â‚‚ kitáµ£ ğ•‚â‚‚ â¦„ â¦ƒ W : WkDistKit C ckitáµ£ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m
                (Ï•â‚ : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚)
                (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
              â†’ ((Ï•â‚ â‚›Â· Ï•â‚‚) â†‘ m) ~ ((Ï•â‚ â†‘ m) â‚›Â· (Ï•â‚‚ â†‘ m))
  dist-â†‘-Â·' â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ C â¦„ â¦ƒ W â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ mx x@(here refl) =
    apâ‚– ((Ï•â‚ â‚›Â· Ï•â‚‚) â†‘ m) _ x                             â‰¡âŸ¨ apâ‚–-â†‘-here (Ï•â‚ â‚›Â· Ï•â‚‚) âŸ©
    ` here refl                                          â‰¡âŸ¨ sym (id/`/id _) âŸ©
    `/id â¦ƒ ğ•‚â‚‚ â¦„ _ (id/` _ (here refl))                   â‰¡âŸ¨ cong (`/id _) (sym (apâ‚–-â†‘-here Ï•â‚‚)) âŸ©
    `/id _ (apâ‚– (Ï•â‚‚ â†‘ m) _ (here refl))  â‰¡âŸ¨ sym (â‹¯-var (here refl) (Ï•â‚‚ â†‘ m)) âŸ©
    (` here refl) â‹¯ (Ï•â‚‚ â†‘ m)                             â‰¡âŸ¨ cong (_â‹¯ Ï•â‚‚ â†‘ m) (sym (apâ‚–-â†‘-here Ï•â‚)) âŸ©
    _â‹¯_ â¦ƒ ğ•‚â‚‚ â¦„ (apâ‚– (Ï•â‚ â†‘ m) _ x) (Ï•â‚‚ â†‘ m) â‰¡âŸ¨ sym (apâ‚–-post (Ï•â‚ â†‘ m) (Î» _ t â†’ t â‹¯ (Ï•â‚‚ â†‘ m)) x) âŸ©
    apâ‚– ((Ï•â‚ â†‘ m) â‚›Â· (Ï•â‚‚ â†‘ m)) _ x                       âˆ
  dist-â†‘-Â·' â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ C â¦„ â¦ƒ W â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ mx x@(there y) =
    apâ‚– ((Ï•â‚ â‚›Â· Ï•â‚‚) â†‘ m) _ x                             â‰¡âŸ¨ apâ‚–-â†‘-there (Ï•â‚ â‚›Â· Ï•â‚‚) y âŸ©
    wk _ (apâ‚– (Ï•â‚ â‚›Â· Ï•â‚‚) _ y)                            â‰¡âŸ¨ cong (wk _) (apâ‚–-post Ï•â‚ (Î» _ t â†’ t â‹¯ Ï•â‚‚) y) âŸ©
    wk _ (apâ‚– Ï•â‚ _ y â‹¯ Ï•â‚‚)                               â‰¡âŸ¨âŸ©
    apâ‚– Ï•â‚ _ y â‹¯ Ï•â‚‚ â‹¯áµ£ wkâ‚– _ id                          â‰¡âŸ¨ â‹¯-assoc â¦ƒ ğ”¸ = C â¦„ (apâ‚– Ï•â‚ _ y) Ï•â‚‚ (wkâ‚– _ id) âŸ©
    apâ‚– Ï•â‚ _ y â‹¯ (ComposeKit._Â·â‚–_ C Ï•â‚‚ (wkâ‚– _ id))       â‰¡âŸ¨ ~-cong-â‹¯ (apâ‚– Ï•â‚ _ y) (WkDistKit.â†‘-wk W m Ï•â‚‚) âŸ©
    apâ‚– Ï•â‚ _ y â‹¯ (_áµ£Â·_ â¦ƒ ğ•‚â‚‚ â¦„ (wkâ‚– _ id) (Ï•â‚‚ â†‘ m))       â‰¡âŸ¨ sym (â‹¯-assoc (apâ‚– Ï•â‚ _ y) (wkâ‚– _ id) (Ï•â‚‚ â†‘ m)) âŸ©
    apâ‚– Ï•â‚ _ y â‹¯áµ£ wkâ‚– _ id â‹¯ (Ï•â‚‚ â†‘ m)                    â‰¡âŸ¨âŸ©
    wk _ (apâ‚– Ï•â‚ _ y) â‹¯ (Ï•â‚‚ â†‘ m)                         â‰¡âŸ¨ cong (_â‹¯ Ï•â‚‚ â†‘ m) (sym (apâ‚–-â†‘-there Ï•â‚ y)) âŸ©
    _â‹¯_ â¦ƒ ğ•‚â‚‚ â¦„ (apâ‚– (Ï•â‚ â†‘ m) _ x) (Ï•â‚‚ â†‘ m) â‰¡âŸ¨ sym (apâ‚–-post (Ï•â‚ â†‘ m) (Î» _ t â†’ t â‹¯ (Ï•â‚‚ â†‘ m)) x) âŸ©
    apâ‚– ((Ï•â‚ â†‘ m) â‚›Â· (Ï•â‚‚ â†‘ m)) _ x                       âˆ

  ckitâ‚›áµ£ : ComposeKit kitâ‚› kitáµ£ kitâ‚›
  ckitâ‚›áµ£ = record
    { ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚   = âŠ‘â‚–-refl â¦ƒ kitâ‚› â¦„ 
    ; ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚   = âŠ‘â‚–-âŠ¤ â¦ƒ ğ•Š â¦„ â¦ƒ kitáµ£ â¦„
    ; _ap/â‹¯_      = Î» t Ï• â†’ t â‹¯ Ï•
    ; _Â·â‚–_        = _â‚›Â·_
    ; ap/â‹¯-Â·â‚–     = â‹¯-â‚›Â·
    -- ; ap/â‹¯-wk     = ap/â‹¯-wkâ‚›
    ; tm-â‹¯-Â·      = tm-â‹¯-â‚›Â·
    ; dist-â†‘-Â·    = dist-â†‘-Â·' â¦ƒ W = wkkitáµ£ â¦„
    ; ~-cong-Â·    = ~-cong-â‚›Â·
    ; ~-cong-ap/â‹¯ = Î» { refl Ï•â‚~Ï•â‚‚ â†’ ~-cong-â‹¯ _ Ï•â‚~Ï•â‚‚ }
    }

  private instance _ = ckitâ‚›áµ£

  wkkitâ‚› : WkDistKit ckitâ‚›áµ£ ckitáµ£
  wkkitâ‚› = record { â†‘-wk = â†‘-wkâ‚› }

  private instance _ = wkkitâ‚›

  ckitâ‚›â‚› : ComposeKit kitâ‚› kitâ‚› kitâ‚›
  ckitâ‚›â‚› = record
    { ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚   = âŠ‘â‚–-refl â¦ƒ kitâ‚› â¦„ 
    ; ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚   = âŠ‘â‚–-âŠ¤ â¦ƒ ğ•Š â¦„ â¦ƒ kitâ‚› â¦„
    ; _ap/â‹¯_      = Î» t Ï• â†’ t â‹¯ Ï•
    ; _Â·â‚–_        = _â‚›Â·_
    ; ap/â‹¯-Â·â‚–     = â‹¯-â‚›Â·
    ; tm-â‹¯-Â·      = tm-â‹¯-â‚›Â·
    ; dist-â†‘-Â·    = dist-â†‘-Â·' â¦ƒ W = wkkitâ‚› â¦„
    ; ~-cong-Â·    = ~-cong-â‚›Â·
    ; ~-cong-ap/â‹¯ = Î» { refl Ï•â‚~Ï•â‚‚ â†’ ~-cong-â‹¯ _ Ï•â‚~Ï•â‚‚ }
    }

  private instance _ = ckitâ‚›â‚›

  --------------------------------------------------------------------------------

  â†‘-wkáµ£â‚› : âˆ€ {Âµâ‚} {Âµâ‚‚} m
            (Ï• : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
          â†’ (Ï• áµ£Â·â‚› wkâ‚– _ id) ~ (wkâ‚– _ id â‚›Â·áµ£ (Ï• â†‘ m))
  â†‘-wkáµ£â‚› {Âµâ‚} {Âµâ‚‚} m Ï• mx x =
    apâ‚– (Ï• áµ£Â· wkâ‚– _ id) _ x            â‰¡âŸ¨ apâ‚–-pre (wkâ‚– _ id) (apâ‚– Ï•) x âŸ©
    apâ‚– (wkâ‚– _ id) _ (apâ‚– Ï• _ x)       â‰¡âŸ¨ apâ‚–-wkâ‚–-wk id (apâ‚– Ï• _ x) âŸ©
    wk _ (apâ‚– id _ (apâ‚– Ï• _ x))        â‰¡âŸ¨ cong (wk _) (apâ‚–-id (apâ‚– Ï• _ x)) âŸ©
    wk _ (` apâ‚– Ï• _ x)                 â‰¡âŸ¨ sym (Î¹-wk â¦ƒ âŠ‘-áµ£â‚› â¦„ {m = m} (apâ‚– Ï• _ x)) âŸ©
    ` there (apâ‚– Ï• _ x)                â‰¡âŸ¨âŸ©
    `/id _ (wk _ (apâ‚– Ï• _ x))          â‰¡âŸ¨ sym (apâ‚–-wk-â†‘' Ï• _ x)  âŸ©
    apâ‚– (wkâ‚– _ id â‚›Â·áµ£ (Ï• â†‘ m)) _ x      âˆ

  wkkitáµ£â‚› : WkDistKit ckitáµ£ ckitâ‚›áµ£ 
  wkkitáµ£â‚› = record { â†‘-wk = â†‘-wkáµ£â‚› }

  private instance _ = wkkitáµ£â‚›

  --------------------------------------------------------------------------------

  â†‘-wkâ‚›â‚› : âˆ€ {Âµâ‚} {Âµâ‚‚} m
            (Ï• : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚)
          â†’ (Ï• â‚›Â·â‚› wkâ‚– _ id) ~ (wkâ‚– _ id â‚›Â·â‚› (Ï• â†‘ m))
  â†‘-wkâ‚›â‚› {Âµâ‚} {Âµâ‚‚} m Ï• mx x =
    apâ‚– (Ï• â‚›Â· wkâ‚– _ id) _ x            â‰¡âŸ¨ apâ‚–-post Ï• (Î» _ t â†’ t â‹¯ wkâ‚– _ id) x âŸ©
    apâ‚– Ï• _ x â‹¯â‚› wkâ‚– _ id              â‰¡âŸ¨ â‹¯-x/t-wk' â¦ƒ kitâ‚› â¦„ (apâ‚– Ï• _ x) âŸ©
    apâ‚– Ï• _ x â‹¯áµ£ wkâ‚– _ id              â‰¡âŸ¨âŸ©
    wk _ (apâ‚– Ï• _ x)                   â‰¡âŸ¨âŸ©
    `/id _ (wk _ (apâ‚– Ï• _ x))          â‰¡âŸ¨ sym (apâ‚–-wk-â†‘' â¦ƒ kitâ‚› â¦„ Ï• _ x)  âŸ©
    apâ‚– (wkâ‚– _ id â‚›Â·â‚› (Ï• â†‘ m)) _ x     âˆ

  wkkitâ‚›â‚› : WkDistKit ckitâ‚›â‚› ckitâ‚›â‚› 
  wkkitâ‚›â‚› = record { â†‘-wk = â†‘-wkâ‚›â‚› }

  private instance _ = wkkitáµ£â‚›

  --------------------------------------------------------------------------------

  âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ : âˆ€ {{ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚' ğ•‚â‚‚' ğ•‚ : Kit}}
              {{ğ”¸  : ComposeKit ğ•‚â‚  ğ•‚â‚‚  ğ•‚}}
              {{ğ”¸' : ComposeKit ğ•‚â‚' ğ•‚â‚‚' ğ•‚}}
              {Ï•â‚  : Âµâ‚ â€“[ ğ•‚â‚  ]â†’ Âµâ‚‚ } {Ï•â‚‚  : Âµâ‚‚  â€“[ ğ•‚â‚‚  ]â†’ Âµâ‚ƒ}
              {Ï•â‚' : Âµâ‚ â€“[ ğ•‚â‚' ]â†’ Âµâ‚‚'} {Ï•â‚‚' : Âµâ‚‚' â€“[ ğ•‚â‚‚' ]â†’ Âµâ‚ƒ} â†’
    (Ï•â‚ Â·[ ğ”¸ ] Ï•â‚‚) ~ (Ï•â‚' Â·[ ğ”¸' ] Ï•â‚‚') â†’
    âˆ€ {M} (t : Âµâ‚ âŠ¢ M) â†’
    t â‹¯ Ï•â‚ â‹¯ Ï•â‚‚ â‰¡ t â‹¯ Ï•â‚' â‹¯ Ï•â‚‚'
  âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ â¦ƒ ğ”¸ = ğ”¸ â¦„ â¦ƒ ğ”¸' â¦„ {Ï•â‚ = Ï•â‚} {Ï•â‚‚ = Ï•â‚‚} {Ï•â‚' = Ï•â‚'} {Ï•â‚‚' = Ï•â‚‚'} eq t =
    t â‹¯ Ï•â‚ â‹¯ Ï•â‚‚         â‰¡âŸ¨ â‹¯-assoc t Ï•â‚ Ï•â‚‚ âŸ©
    t â‹¯ Ï•â‚  Â·[ ğ”¸  ] Ï•â‚‚  â‰¡âŸ¨ ~-cong-â‹¯ t eq âŸ©
    t â‹¯ Ï•â‚' Â·[ ğ”¸' ] Ï•â‚‚' â‰¡âŸ¨ sym (â‹¯-assoc t Ï•â‚' Ï•â‚‚') âŸ©
    t â‹¯ Ï•â‚' â‹¯ Ï•â‚‚'  âˆ

-- -- record ComposeTraversal : Setâ‚ where

-- --   record WkDistKit
-- --       {{ğ•‚ : Kit}}
-- --       {{ğ”¸â‚ : ComposeKit {{ğ•‚}} {{kitáµ£}} {{ğ•‚}} }}
-- --       {{ğ”¸â‚‚ : ComposeKit {{kitáµ£}} {{ğ•‚}} {{ğ•‚}} }}
-- --       : Setâ‚ where
-- --     field
-- --       comm-â†‘-wk : âˆ€ (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) â†’
-- --         (Ï• â†‘ m) âˆ˜â‚– wkáµ£ ~ wkáµ£ âˆ˜â‚– Ï•
-- --       wk-cancels-,â‚–-âˆ˜ : âˆ€ (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) (v : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m) â†’
-- --         (Ï• ,â‚– v) âˆ˜â‚– wkáµ£ ~ Ï•

-- --     -- TODO: generalize kitáµ£ to arbitrary kits and include â¦…â¦† lemmas.

-- --     -- This isn't limited to renamings i.e. wkáµ£ ...
-- --     dist-â†‘-f : âˆ€ (v : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) â†’
-- --       v â‹¯áµ£ wkáµ£ â‹¯ (Ï• â†‘ m) â‰¡ v â‹¯ Ï• â‹¯áµ£ wkáµ£
-- --     dist-â†‘-f v Ï• =
-- --       v â‹¯ wkáµ£ â‹¯ (Ï• â†‘ _)  â‰¡âŸ¨ â‹¯-assoc v wk (Ï• â†‘ _)  âŸ©
-- --       v â‹¯ (Ï• â†‘ _) âˆ˜â‚– wkáµ£ â‰¡âŸ¨ ~-cong-â‹¯ v (comm-â†‘-wk Ï•) âŸ©
-- --       v â‹¯ wkáµ£ âˆ˜â‚– Ï•       â‰¡âŸ¨ sym (â‹¯-assoc v Ï• wk) âŸ©
-- --       v â‹¯ Ï• â‹¯ wkáµ£        âˆ

-- --     wk-cancels-,â‚– : âˆ€ (v : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) (v' : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m) â†’
-- --       v â‹¯áµ£ wkáµ£ â‹¯ (Ï• ,â‚– v') â‰¡ v â‹¯ Ï•
-- --     wk-cancels-,â‚– v Ï• v' =
-- --       v â‹¯áµ£ wkáµ£ â‹¯ (Ï• ,â‚– v')   â‰¡âŸ¨ â‹¯-assoc v wkáµ£ (Ï• ,â‚– v') âŸ©
-- --       v â‹¯ ((Ï• ,â‚– v') âˆ˜â‚– wkáµ£) â‰¡âŸ¨ ~-cong-â‹¯ _ (wk-cancels-,â‚–-âˆ˜ Ï• v') âŸ©
-- --       v â‹¯ Ï•                  âˆ

-- --   wk-kitáµ£ : WkDistKit {{kitáµ£}} {{kitáµ£áµ£}} {{kitáµ£áµ£}}
-- --   wk-kitáµ£ = record
-- --     { comm-â†‘-wk = Î» Ï• â†’ ~-refl
-- --     ; wk-cancels-,â‚–-âˆ˜ = Î» Ï• v â†’ ~-refl
-- --     }

-- --   wk-kitâ‚› : WkDistKit {{kitâ‚›}} {{kitâ‚›áµ£}} {{kitáµ£â‚›}}
-- --   wk-kitâ‚› = record
-- --     { comm-â†‘-wk = Î» Ï• â†’ ~-refl
-- --     ; wk-cancels-,â‚–-âˆ˜ = Î» Ï• v â†’ ~-refl
-- --     }

-- --   private instance _ = wk-kitáµ£
-- --   private instance _ = wk-kitâ‚›

-- --   open WkDistKit {{...}}

-- --   open WkDistKit wk-kitáµ£ public renaming (dist-â†‘-f to dist-â†‘-ren; wk-cancels-,â‚– to wk-cancels-,áµ£) using ()
-- --   open WkDistKit wk-kitâ‚› public renaming (dist-â†‘-f to dist-â†‘-sub; wk-cancels-,â‚– to wk-cancels-,â‚›) using ()

-- --   record ComposeTraversalLemmas : Setâ‚ where
-- --     open ComposeKit {{...}}

-- --     field
-- --       â‹¯-id : âˆ€ {{ğ•‚ : Kit}} {Âµ M} (v : Âµ âŠ¢ M) â†’ v â‹¯ idâ‚– {{ğ•‚}} â‰¡ v

-- --     â‹¯-idâ‚› : âˆ€ {Âµ M} (v : Âµ âŠ¢ M) â†’ v â‹¯ idâ‚– {{kitâ‚›}} â‰¡ v
-- --     â‹¯-idâ‚› = â‹¯-id

-- --     â‹¯-idáµ£ : âˆ€ {Âµ M} (v : Âµ âŠ¢ M) â†’ v â‹¯ idâ‚– {{kitáµ£}} â‰¡ v
-- --     â‹¯-idáµ£ = â‹¯-id

-- --     record ComposeTraversalLemmas'' : Setâ‚ where
-- --       field
-- --         â‹¯á¶œ-id : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit â¦„
-- --                   â¦ƒ C : ComposeKit â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                   {Âµ M} (v : Âµ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] M)
-- --                 â†’ v â‹¯[ C ] idâ‚– â‰¡ v

-- --     renâ†’sub : âˆ€ (e : Âµâ‚ âŠ¢ M) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
-- --               e â‹¯áµ£ Ï â‰¡ e â‹¯â‚› (idâ‚› â‚›âˆ˜áµ£ Ï)
-- --     renâ†’sub e Ï =
-- --       e â‹¯áµ£ Ï           â‰¡âŸ¨ sym (â‹¯-idâ‚› (e â‹¯áµ£ Ï)) âŸ©
-- --       e â‹¯áµ£ Ï â‹¯â‚› idâ‚›    â‰¡âŸ¨ â‹¯-assoc e Ï id/` âŸ©
-- --       e â‹¯â‚› (idâ‚› â‚›âˆ˜áµ£ Ï) âˆ

-- --     renâ†’sub' : âˆ€ â¦ƒ ğ•‚â‚‚ ğ•‚ : Kit â¦„
-- --                  â¦ƒ Cáµ£ : ComposeKit â¦ƒ kitáµ£ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                  â¦ƒ Câ‚› : ComposeKit â¦ƒ kitâ‚› â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                  (e : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
-- --                e â‹¯[ Cáµ£ ] Ï â‰¡ e â‹¯[ Câ‚› ] (idâ‚› â‚›âˆ˜áµ£ Ï)
-- --     renâ†’sub' e Ï = {!!}
-- --       -- e â‹¯áµ£ Ï           â‰¡âŸ¨ sym (â‹¯-idâ‚› (e â‹¯áµ£ Ï)) âŸ©
-- --       -- e â‹¯áµ£ Ï â‹¯â‚› idâ‚›    â‰¡âŸ¨ â‹¯-assoc e Ï id/` âŸ©
-- --       -- e â‹¯â‚› (idâ‚› â‚›âˆ˜áµ£ Ï) âˆ

-- --     wk-cancels-â¦…â¦† :
-- --       âˆ€ {{ğ•‚ : Kit}}
-- --         {{ğ”¸â‚ : ComposeKit {{ğ•‚}} {{kitáµ£}} {{ğ•‚}} }}
-- --         {{ğ”¸â‚‚ : ComposeKit {{kitáµ£}} {{ğ•‚}} {{ğ•‚}} }}
-- --         {{_ : WkDistKit {{ğ•‚}} {{ğ”¸â‚}} {{ğ”¸â‚‚}} }} {Âµ M m}
-- --         (v : Âµ âŠ¢ M) (v' : Âµ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m) â†’
-- --       v â‹¯ wkáµ£ â‹¯ â¦… v' â¦† â‰¡ v
-- --     wk-cancels-â¦…â¦† v v' =
-- --       v â‹¯ wkáµ£ â‹¯ â¦… v' â¦† â‰¡âŸ¨ wk-cancels-,â‚– v idâ‚– v' âŸ©
-- --       v â‹¯ idâ‚–          â‰¡âŸ¨ â‹¯-id v âŸ©
-- --       v                âˆ

-- --     wk-cancels-â¦…â¦†áµ£ : âˆ€ {Âµ M m} (v : Âµ âŠ¢ M) (v' : Âµ âˆ‹ m) â†’
-- --       v â‹¯ wkáµ£ â‹¯ â¦… v' â¦†áµ£ â‰¡ v
-- --     wk-cancels-â¦…â¦†áµ£ = wk-cancels-â¦…â¦†

-- --     wk-cancels-â¦…â¦†â‚› : âˆ€ {Âµ M m} (v : Âµ âŠ¢ M) (v' : Âµ âŠ¢ mâ†’M m) â†’
-- --       v â‹¯ wkáµ£ â‹¯ â¦… v' â¦†â‚› â‰¡ v
-- --     wk-cancels-â¦…â¦†â‚› = wk-cancels-â¦…â¦†

-- --     -- TODO: prove for other combinations between Ï and Ïƒ.
-- --     â†‘âˆ˜â¦…â¦†-is-,â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t : Âµâ‚‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
-- --       â¦… t â¦†â‚› â‚›âˆ˜â‚› (Ïƒ â†‘ m) ~ Ïƒ ,â‚› t
-- --     â†‘âˆ˜â¦…â¦†-is-,â‚› t Ïƒ _ (here refl) = â‹¯-var (here refl) â¦… t â¦†
-- --     â†‘âˆ˜â¦…â¦†-is-,â‚› t Ïƒ _ (there x)   = wk-cancels-â¦…â¦†â‚› (Ïƒ _ x) t

-- --     -- TODO: prove for other combinations between Ï and Ïƒ.
-- --     â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t' : (Âµâ‚ â–· m) âŠ¢ M) (t : Âµâ‚‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
-- --       t' â‹¯ (Ïƒ â†‘ m) â‹¯ â¦… t â¦†â‚› â‰¡ t' â‹¯ (Ïƒ ,â‚› t)
-- --     â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚› {m = m} t' t Ïƒ =
-- --       t' â‹¯â‚› (Ïƒ â†‘ m) â‹¯â‚› â¦… t â¦†â‚›    â‰¡âŸ¨ â‹¯-assoc t' (Ïƒ â†‘ m) â¦… t â¦†â‚› âŸ©
-- --       t' â‹¯â‚› (â¦… t â¦†â‚› â‚›âˆ˜â‚› (Ïƒ â†‘ m)) â‰¡âŸ¨ ~-cong-â‹¯ t' (â†‘âˆ˜â¦…â¦†-is-,â‚› t Ïƒ) âŸ©
-- --       t' â‹¯â‚› (Ïƒ ,â‚› t)             âˆ

-- --     dist-áµ£âˆ˜áµ£-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (x : Âµâ‚ âˆ‹ m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
-- --       Ï áµ£âˆ˜áµ£ â¦… x â¦† ~ â¦… Ï _ x â¦† áµ£âˆ˜áµ£ (Ï â†‘ m)
-- --     dist-áµ£âˆ˜áµ£-â¦…â¦† x Ïƒ _ (here refl) = refl
-- --     dist-áµ£âˆ˜áµ£-â¦…â¦† x Ïƒ _ (there _)   = refl

-- --     dist-áµ£âˆ˜â‚›-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t : Âµâ‚ âŠ¢ mâ†’M m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
-- --       Ï áµ£âˆ˜â‚› â¦… t â¦† ~ â¦… t â‹¯ Ï â¦† â‚›âˆ˜áµ£ (Ï â†‘ m)
-- --     dist-áµ£âˆ˜â‚›-â¦…â¦† t Ïƒ _ (here refl) = refl
-- --     dist-áµ£âˆ˜â‚›-â¦…â¦† t Ïƒ _ (there x)   = â‹¯-var x Ïƒ

-- --     dist-â‚›âˆ˜áµ£-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (x : Âµâ‚ âˆ‹ m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
-- --       Ïƒ â‚›âˆ˜áµ£ â¦… x â¦† ~ â¦… Ïƒ _ x â¦† â‚›âˆ˜â‚› (Ïƒ â†‘ m)
-- --     dist-â‚›âˆ˜áµ£-â¦…â¦† x Ïƒ _ (here refl) = sym (â‹¯-var (here refl) â¦… Ïƒ _ x â¦†)
-- --     dist-â‚›âˆ˜áµ£-â¦…â¦† x Ïƒ _ (there y) =
-- --         Ïƒ _ y                             â‰¡âŸ¨ sym (â‹¯-id (Ïƒ _ y)) âŸ©
-- --         Ïƒ _ y â‹¯ ((idâ‚– ,â‚– (Ïƒ _ x)) â‚›âˆ˜áµ£ wk) â‰¡âŸ¨ sym (â‹¯-assoc (Ïƒ _ y) wk â¦… Ïƒ _ x â¦†) âŸ©
-- --         (Ïƒ _ y â‹¯ wk) â‹¯ (idâ‚– ,â‚– (Ïƒ _ x))   âˆ

-- --     dist-â‚›âˆ˜â‚›-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t : Âµâ‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
-- --       Ïƒ â‚›âˆ˜â‚› â¦… t â¦† ~ â¦… t â‹¯ Ïƒ â¦† â‚›âˆ˜â‚› (Ïƒ â†‘ m)
-- --     dist-â‚›âˆ˜â‚›-â¦…â¦† t Ïƒ _ (here refl) =
-- --         t â‹¯ Ïƒ                     â‰¡âŸ¨âŸ©
-- --         â¦… t â‹¯ Ïƒ â¦† _ (here refl)   â‰¡âŸ¨ sym (â‹¯-var (here refl) â¦… t â‹¯ Ïƒ â¦†) âŸ©
-- --         (` here refl) â‹¯ â¦… t â‹¯ Ïƒ â¦† âˆ
-- --     dist-â‚›âˆ˜â‚›-â¦…â¦† t Ïƒ _ (there x) =
-- --         (` x) â‹¯ Ïƒ                         â‰¡âŸ¨ â‹¯-var x Ïƒ âŸ©
-- --         Ïƒ _ x                             â‰¡âŸ¨ sym (â‹¯-id (Ïƒ _ x)) âŸ©
-- --         Ïƒ _ x â‹¯ ((idâ‚– ,â‚– (t â‹¯ Ïƒ)) â‚›âˆ˜áµ£ wk) â‰¡âŸ¨ sym (â‹¯-assoc (Ïƒ _ x) wk â¦… t â‹¯ Ïƒ â¦†) âŸ©
-- --         (Ïƒ _ x â‹¯ wk) â‹¯ (idâ‚– ,â‚– (t â‹¯ Ïƒ))   âˆ

-- --     dist-â¦…â¦†áµ£-â‹¯áµ£ : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (x : Âµâ‚ âˆ‹ m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
-- --       t â‹¯ â¦… x â¦† â‹¯ Ï â‰¡ t â‹¯ (Ï â†‘ m) â‹¯ â¦… Ï _ x â¦†
-- --     dist-â¦…â¦†áµ£-â‹¯áµ£ t x Ï = âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ (dist-áµ£âˆ˜áµ£-â¦…â¦† x Ï) t

-- --     dist-â¦…â¦†â‚›-â‹¯áµ£ : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (t' : Âµâ‚ âŠ¢ mâ†’M m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
-- --       t â‹¯ â¦… t' â¦† â‹¯ Ï â‰¡ t â‹¯ (Ï â†‘ m) â‹¯ â¦… t' â‹¯ Ï â¦†
-- --     dist-â¦…â¦†â‚›-â‹¯áµ£ t t' Ï = âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ (dist-áµ£âˆ˜â‚›-â¦…â¦† t' Ï) t

-- --     dist-â¦…â¦†áµ£-â‹¯â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (x : Âµâ‚ âˆ‹ m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
-- --       t â‹¯ â¦… x â¦† â‹¯ Ïƒ â‰¡ t â‹¯ (Ïƒ â†‘ m) â‹¯ â¦… Ïƒ _ x â¦†
-- --     dist-â¦…â¦†áµ£-â‹¯â‚› tâ‚‚ t Ïƒ = âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ (dist-â‚›âˆ˜áµ£-â¦…â¦† t Ïƒ) tâ‚‚

-- --     dist-â¦…â¦†â‚›-â‹¯â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (t' : Âµâ‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
-- --       t â‹¯ â¦… t' â¦† â‹¯ Ïƒ â‰¡ t â‹¯ (Ïƒ â†‘ m) â‹¯ â¦… t' â‹¯ Ïƒ â¦†
-- --     dist-â¦…â¦†â‚›-â‹¯â‚› tâ‚‚ t Ïƒ = âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ (dist-â‚›âˆ˜â‚›-â¦…â¦† t Ïƒ) tâ‚‚

-- --     postulate TODO : âˆ€ {â„“} {A : Set â„“} â†’ A

-- --     open import Kitty.Util.Star
-- --     open import Data.List using (_++_)

-- --     _â€“[_]â†’*_ : List VarMode â†’ (_ : List Kit) â†’ List VarMode â†’ Set _
-- --     Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚ = Star (Î» ğ•‚ x y â†’ y â€“[ ğ•‚ ]â†’ x) ğ•‚s Âµâ‚‚ Âµâ‚

-- --     infixl  6  _â†‘**_
-- --     _â†‘**_ : {ğ•‚s : List Kit} â†’ Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚ â†’ âˆ€ Âµ' â†’ (Âµ' ++ Âµâ‚) â€“[ ğ•‚s ]â†’* (Âµ' ++ Âµâ‚‚)
-- --     [] â†‘** Âµ' = []
-- --     (_âˆ·_ {b = ğ•‚} f fs) â†‘** Âµ' = (Kit._â†‘*_ ğ•‚ f Âµ') âˆ· (fs â†‘** Âµ')

-- --     infixl  5 _â‹¯*_
-- --     _â‹¯*_ : âˆ€ {ğ•‚s : List Kit} {Âµâ‚ Âµâ‚‚ M} â†’
-- --           Âµâ‚ âŠ¢ M â†’ Âµâ‚ â€“[ ğ•‚s ]â†’* Âµâ‚‚ â†’ Âµâ‚‚ âŠ¢ M
-- --     t â‹¯* fs = fold-star' (Î» ğ•‚ _ _ t f â†’ _â‹¯_ {{ğ•‚}} t f) t fs

-- --     _â‰ˆâ‚“_ : âˆ€ {ğ•‚sâ‚ ğ•‚sâ‚‚ : List Kit} {Âµâ‚ Âµâ‚‚} â†’ (f : Âµâ‚ â€“[ ğ•‚sâ‚ ]â†’* Âµâ‚‚) â†’ (g : Âµâ‚ â€“[ ğ•‚sâ‚‚ ]â†’* Âµâ‚‚) â†’ Set
-- --     _â‰ˆâ‚“_ {Âµâ‚ = Âµâ‚} f g = âˆ€ {Âµâ‚'} {m} (x : (Âµâ‚ â–·â–· Âµâ‚') âˆ‹ m) â†’ (` x) â‹¯* (f â†‘** Âµâ‚') â‰¡ (` x) â‹¯* (g â†‘** Âµâ‚')

-- --     _â‰ˆâ‚œ_ : âˆ€ {ğ•‚sâ‚ ğ•‚sâ‚‚ : List Kit} {Âµâ‚ Âµâ‚‚} â†’ (f : Âµâ‚ â€“[ ğ•‚sâ‚ ]â†’* Âµâ‚‚) â†’ (g : Âµâ‚ â€“[ ğ•‚sâ‚‚ ]â†’* Âµâ‚‚) â†’ Set
-- --     _â‰ˆâ‚œ_ {Âµâ‚ = Âµâ‚} f g = âˆ€ {Âµâ‚'} {M} (t : (Âµâ‚ â–·â–· Âµâ‚') âŠ¢ M) â†’ t â‹¯* (f â†‘** Âµâ‚') â‰¡ t â‹¯* (g â†‘** Âµâ‚')

-- --     â‹¯-â†‘ : âˆ€ {ğ•‚sâ‚ ğ•‚sâ‚‚ : List Kit} {Âµâ‚} {Âµâ‚‚} (f : Âµâ‚ â€“[ ğ•‚sâ‚ ]â†’* Âµâ‚‚) (g : Âµâ‚ â€“[ ğ•‚sâ‚‚ ]â†’* Âµâ‚‚) â†’
-- --           f â‰ˆâ‚“ g â†’ f â‰ˆâ‚œ g
-- --     â‹¯-â†‘ = TODO

-- --     dist-â¦…â¦†-âˆ˜ : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit â¦„
-- --                   â¦ƒ Câ‚‚â‚ : ComposeKit â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                   â¦ƒ C : ComposeKit â¦ƒ ğ•‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                   {Âµâ‚ Âµâ‚‚ m}
-- --                   (t' :  Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] Kit.id/mâ†’M ğ•‚â‚ m) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) â†’
-- --       ComposeKit._âˆ˜â‚–_ Câ‚‚â‚ Ï• â¦… t' â¦† ~ ComposeKit._âˆ˜â‚–_ C â¦… ComposeKit._â‹¯á¶œ_ Câ‚‚â‚ t' Ï• â¦† (Ï• â†‘ m) 
-- --     dist-â¦…â¦†-âˆ˜ â¦ƒ Câ‚‚â‚ = Câ‚‚â‚ â¦„ â¦ƒ C = C â¦„ t' Ï• _ (here refl) =
-- --       (Ï• âˆ˜[ Câ‚‚â‚ ] â¦… t' â¦†) _ (here refl)                    â‰¡âŸ¨ sym (ComposeKit.tm-â‹¯á¶œ-âˆ˜ Câ‚‚â‚ â¦… t' â¦† Ï• (here refl) ) âŸ©
-- --       â¦… t' â¦† _ (here refl) â‹¯[ Câ‚‚â‚ ] Ï•                      â‰¡âŸ¨âŸ©
-- --       t' â‹¯[ Câ‚‚â‚ ] Ï•                                        â‰¡âŸ¨ sym (ComposeKit.ğ•‚â‚â†’ğ•‚â‚ C refl (t' â‹¯[ Câ‚‚â‚ ] Ï•) ) âŸ©
-- --       ComposeKit.ğ•‚â‚â†’ğ•‚ C (t' â‹¯[ Câ‚‚â‚ ] Ï•)                    â‰¡âŸ¨âŸ©
-- --       ComposeKit.ğ•‚â‚â†’ğ•‚ C (â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦† _ (here refl))  â‰¡âŸ¨ sym (ComposeKit.â‹¯á¶œ-var C (here refl) â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦†) âŸ©
-- --       id/` _ (here refl) â‹¯[ C ] â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦†          â‰¡âŸ¨âŸ©
-- --       (Ï• â†‘ _) _ (here refl) â‹¯[ C ] â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦†       â‰¡âŸ¨ ComposeKit.tm-â‹¯á¶œ-âˆ˜ C (Ï• â†‘ _) â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦† (here refl) âŸ©
-- --       (â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦† âˆ˜[ C ] (Ï• â†‘ _)) _ (here refl)     âˆ
-- --     dist-â¦…â¦†-âˆ˜ â¦ƒ Câ‚‚â‚ = Câ‚‚â‚ â¦„ â¦ƒ C = C â¦„ t' Ï• _ (there x) =
-- --       (Ï• âˆ˜[ Câ‚‚â‚ ] â¦… t' â¦†) _ (there x)                    â‰¡âŸ¨ sym (ComposeKit.tm-â‹¯á¶œ-âˆ˜ Câ‚‚â‚ â¦… t' â¦† Ï• (there x) ) âŸ©
-- --       â¦… t' â¦† _ (there x)  â‹¯[ Câ‚‚â‚ ] Ï•                      â‰¡âŸ¨âŸ©
-- --       id/` _ x            â‹¯[ Câ‚‚â‚ ] Ï•                      â‰¡âŸ¨ {!!} âŸ©
-- --       ComposeKit.ğ•‚â‚â†’ğ•‚ Câ‚‚â‚ (Ï• _ x)                             â‰¡âŸ¨ {!!} âŸ©
-- --       wk _ (Ï• _ x)        â‹¯[ C ] â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦†       â‰¡âŸ¨âŸ©
-- --       (Ï• â†‘ _) _ (there x) â‹¯[ C ] â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦†       â‰¡âŸ¨ ComposeKit.tm-â‹¯á¶œ-âˆ˜ C (Ï• â†‘ _) â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦† (there x) âŸ©
-- --       (â¦… t' â‹¯[ Câ‚‚â‚ ] Ï• â¦† âˆ˜[ C ] (Ï• â†‘ _)) _ (there x)     âˆ

-- --     -- â‹¯á¶œ-var : âˆ€ (x : Âµâ‚ âˆ‹ m) (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) â†’
-- --     --   id/` _ x â‹¯á¶œ Ï• â‰¡ ğ•‚â‚â†’ğ•‚ (Ï• _ x)

-- --     -- tm-â‹¯á¶œ-âˆ˜ : (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚ƒ) (x : Âµâ‚ âˆ‹ m) â†’
-- --     --   (Ï•â‚ _ x) â‹¯á¶œ Ï•â‚‚ â‰¡ (Ï•â‚‚ âˆ˜â‚– Ï•â‚) _ x

-- --     -- dist-â‚›âˆ˜â‚›-â¦…â¦† t Ïƒ _ (here refl) =
-- --     --     t â‹¯ Ïƒ                     â‰¡âŸ¨âŸ©
-- --     --     â¦… t â‹¯ Ïƒ â¦† _ (here refl)   â‰¡âŸ¨ sym (â‹¯-var (here refl) â¦… t â‹¯ Ïƒ â¦†) âŸ©
-- --     --     (` here refl) â‹¯ â¦… t â‹¯ Ïƒ â¦† âˆ
-- --     -- dist-â‚›âˆ˜â‚›-â¦…â¦† t Ïƒ _ (there x) =
-- --     --     (` x) â‹¯ Ïƒ                         â‰¡âŸ¨ â‹¯-var x Ïƒ âŸ©
-- --     --     Ïƒ _ x                             â‰¡âŸ¨ sym (â‹¯-id (Ïƒ _ x)) âŸ©
-- --     --     Ïƒ _ x â‹¯ ((idâ‚– ,â‚– (t â‹¯ Ïƒ)) â‚›âˆ˜áµ£ wk) â‰¡âŸ¨ sym (â‹¯-assoc (Ïƒ _ x) wk â¦… t â‹¯ Ïƒ â¦†) âŸ©
-- --     --     (Ïƒ _ x â‹¯ wk) â‹¯ (idâ‚– ,â‚– (t â‹¯ Ïƒ))   âˆ

-- --     dist-â¦…â¦†-â‹¯ : âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit â¦„
-- --                   â¦ƒ Câ‚‚â‚ : ComposeKit â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                   â¦ƒ C : ComposeKit â¦ƒ ğ•‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦„
-- --                   {Âµâ‚ Âµâ‚‚ m M}
-- --                   (t : (m âˆ· Âµâ‚) âŠ¢ M) (t' : Kit._âˆ‹/âŠ¢_ ğ•‚â‚ Âµâ‚ (id/mâ†’M m)) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) â†’
-- --       t â‹¯ â¦… t' â¦† â‹¯ Ï• â‰¡ t â‹¯ (Ï• â†‘ m) â‹¯ â¦… ComposeKit._â‹¯á¶œ_ Câ‚‚â‚ t' Ï• â¦†
-- --     dist-â¦…â¦†-â‹¯ â¦ƒ Câ‚‚â‚ = Câ‚‚â‚ â¦„ â¦ƒ C = C â¦„ t t' Ï• =
-- --       t â‹¯ â¦… t' â¦† â‹¯ Ï•                                               â‰¡âŸ¨ â‹¯-assoc t â¦… t' â¦† Ï• âŸ©
-- --       t â‹¯ (ComposeKit._âˆ˜â‚–_ Câ‚‚â‚ Ï• â¦… t' â¦†)                           â‰¡âŸ¨ ~-cong-â‹¯ t (dist-â¦…â¦†-âˆ˜ t' Ï•) âŸ©
-- --       t â‹¯ (ComposeKit._âˆ˜â‚–_ C â¦… ComposeKit._â‹¯á¶œ_ Câ‚‚â‚ t' Ï• â¦† (Ï• â†‘ _)) â‰¡âŸ¨ sym (â‹¯-assoc t (Ï• â†‘ _) â¦… ComposeKit._â‹¯á¶œ_ Câ‚‚â‚ t' Ï• â¦†) âŸ©
-- --       t â‹¯ (Ï• â†‘ _) â‹¯ â¦… ComposeKit._â‹¯á¶œ_ Câ‚‚â‚ t' Ï• â¦†                   âˆ

-- --     dist-â¦…â¦†-â‹¯â‚› : âˆ€ â¦ƒ ğ•‚ : Kit â¦„
-- --                   (t : (m âˆ· Âµâ‚) âŠ¢ M) (t' : Âµâ‚ âŠ¢ mâ†’M m) (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) â†’
-- --       t â‹¯ â¦… t' â¦† â‹¯ Ï• â‰¡ t â‹¯ (Ï• â†‘ m) â‹¯ â¦… t' â‹¯ Ï• â¦†
-- --     dist-â¦…â¦†-â‹¯â‚› t t' Ï• =
-- --       t â‹¯ â¦… t' â¦† â‹¯ Ï•              â‰¡âŸ¨ {!!} âŸ©
-- --       -- t â‹¯ (Ï• âˆ˜â‚– â¦… t' â¦†)           â‰¡âŸ¨ {!!} âŸ©
-- --       -- t â‹¯ (â¦… t' â‹¯ Ï• â¦† âˆ˜â‚– (Ï• â†‘ _)) â‰¡âŸ¨ {!!} âŸ©
-- --       t â‹¯ Ï• â†‘ _ â‹¯ â¦… t' â‹¯ Ï• â¦†      âˆ

-- --   -- record KitTraversalLemmas : Setâ‚ where
-- --   --   open AssocAssumptions {{...}}
-- --   --   field
-- --   --     {{kit-traversal}} : KitTraversal
-- --   --     â‹¯-id : âˆ€ {{ğ•‚ : Kit}} (v : Âµ âŠ¢ K) â†’ v â‹¯ idâ‚– {{ğ•‚}} â‰¡ v

-- --   --   dist-âˆ˜-â¦…â¦† :
-- --   --     âˆ€ {{ğ•‚â‚ : Kit }}
-- --   --       {{ğ•‚â‚‚ : Kit }}
-- --   --       {{ğ•‚  : Kit }}
-- --   --       {{ğ”¸â‚ : AssocAssumptions {{kit-traversal}} {{ğ•‚â‚}} {{ğ•‚â‚‚}} {{ğ•‚}} }}
-- --   --       {{ğ”¸â‚‚ : AssocAssumptions {{kit-traversal}} {{ğ•‚â‚‚}} {{ğ•‚â‚}} {{ğ•‚}} }}
-- --   --       {{_ : KitCompose {{ğ•‚â‚}} {{ğ•‚â‚‚}} {{ğ•‚}} {{kit-traversal}} {{ğ”¸â‚}} }}
-- --   --       {{_ : KitCompose {{ğ•‚â‚‚}} {{ğ•‚â‚}} {{ğ•‚}} {{kit-traversal}} {{ğ”¸â‚‚}} }}
-- --   --       (t : Âµ â—† kâ†’SK k) (Ïƒ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) â†’
-- --   --     Ïƒ âˆ˜â‚– â¦… t â¦† â‰¡ â¦… `/id _ t â‹¯ Ïƒ â¦† âˆ˜â‚– (Ïƒ â†‘ k)
-- --   --   -- â¦…_â¦† : Âµ â—† kâ†’SK k â†’ (k âˆ· Âµ) â€“â†’ Âµ
-- --   --   dist-âˆ˜-â¦…â¦† t Ïƒ = {!!}
-- --   --   -- dist-âˆ˜-â¦…â¦† t Ïƒ = fun-extâ‚‚ Î» where
-- --   --   --   _ (here refl) â†’
-- --   --   --     t â‹¯ Ïƒ                     â‰¡âŸ¨âŸ©
-- --   --   --     â¦… t â‹¯ Ïƒ â¦† _ (here refl)   â‰¡âŸ¨ sym (â‹¯-var (here refl) â¦… t â‹¯ Ïƒ â¦†) âŸ©
-- --   --   --     (` here refl) â‹¯ â¦… t â‹¯ Ïƒ â¦† âˆ
-- --   --   --   _ (there x) â†’
-- --   --   --     (` x) â‹¯ Ïƒ                         â‰¡âŸ¨ â‹¯-var x Ïƒ âŸ©
-- --   --   --     Ïƒ _ x                             â‰¡âŸ¨ sym (â‹¯-id (Ïƒ _ x)) âŸ©
-- --   --   --     Ïƒ _ x â‹¯ ((idâ‚– ,â‚– (t â‹¯ Ïƒ)) â‚›âˆ˜áµ£ wk) â‰¡âŸ¨ sym (â‹¯-assoc (Ïƒ _ x) wk â¦… t â‹¯ Ïƒ â¦†) âŸ©
-- --   --   --     (Ïƒ _ x â‹¯ wk) â‹¯ (idâ‚– ,â‚– (t â‹¯ Ïƒ))   âˆ
