open import Kitty.Term.Modes
open import Kitty.Term.Traversal using (Traversal)
open import Kitty.Term.KitHomotopy using (KitHomotopy)
import Kitty.Term.Sub
import Kitty.Term.SubCompose

module Kitty.Term.ComposeTraversal {ğ•„ : Modes} (ğ•‹ : Terms ğ•„) (ğ•Š : Kitty.Term.Sub.SubWithLaws ğ•‹) (T : Traversal ğ•‹ ğ•Š)
                                   (H : KitHomotopy ğ•‹ ğ•Š T) (ğ•ŠC : Kitty.Term.SubCompose.SubCompose ğ•‹ ğ•Š T H) where

open import Data.List using (List; []; _âˆ·_)
open import Data.List.Membership.Propositional using (_âˆˆ_)
open import Data.List.Relation.Unary.Any using (here; there)
open import Level using (Level; _âŠ”_) renaming (suc to lsuc; zero to lzero)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; sym; trans; cong; congâ‚‚; subst; module â‰¡-Reasoning)
open import Relation.Nullary using (Â¬_)
open â‰¡-Reasoning

open import Kitty.Term.Prelude
open import Kitty.Term.Kit ğ•‹
open import Kitty.Term.KitT ğ•‹ ğ•Š T
open import Kitty.Term.KitOrder ğ•‹
open import Kitty.Term.Sub ğ•‹
open import Kitty.Term.ComposeKit ğ•‹ ğ•Š T H
open import Kitty.Term.SubCompose ğ•‹ ğ•Š T H
open import Kitty.Util.SubstProperties

open Modes ğ•„
open Terms ğ•‹
open Traversal T
open KitHomotopy H
open Kit â¦ƒ â€¦ â¦„
open Sub â¦ƒ â€¦ â¦„
open SubWithLaws ğ•Š
open SubCompose ğ•ŠC
open ~-Reasoning
open _âŠ‘â‚–_ â¦ƒ â€¦ â¦„
open ComposeKit â¦ƒ â€¦ â¦„

private instance
  _ = kitáµ£
  _ = kitâ‚›
  _ = ckitáµ£
  _ = kittáµ£
  _ = kittâ‚›

private variable
  m mâ‚ mâ‚‚ mâ‚ƒ m' mâ‚' mâ‚‚' mâ‚ƒ' : VarMode
  M Mâ‚ Mâ‚‚ Mâ‚ƒ M' Mâ‚' Mâ‚‚' Mâ‚ƒ' : TermMode
  Âµ Âµâ‚ Âµâ‚‚ Âµâ‚ƒ Âµ' Âµâ‚' Âµâ‚‚' Âµâ‚ƒ' : List VarMode

-- ComposeTraversal ------------------------------------------------------------

-- If the client provides a `ComposeTraversal` which works for all `ComposeKit`s,
-- they get `â‹¯-assoc` for `_áµ£âˆ˜áµ£_`, `_â‚›âˆ˜áµ£_`, `_áµ£âˆ˜â‚›_`, and `_â‚›âˆ˜â‚›_`.

record ComposeTraversal : Setâ‚ where
  field
    â‹¯-assoc :
      âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ : Kit â¦„
        â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„
        â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
        â¦ƒ Wâ‚â‚‚ : KitT ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
        â¦ƒ ğ”¸ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
        (t : Âµâ‚ âŠ¢ M) (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
      â†’ (t â‹¯ Ï•â‚) â‹¯ Ï•â‚‚ â‰¡ t â‹¯ (Ï•â‚ Â·â‚– Ï•â‚‚)

  -- Example:
  --
  --   instance kit-assoc : ComposeTraversal {{traversal}}
  --   ComposeTraversal.â‹¯-assoc kit-assoc (` x) f g =
  --     tm' (f _ x) â‹¯ g    â‰¡âŸ¨ tm'-â‹¯-âˆ˜ f g x âŸ©
  --     tm' ((g âˆ˜â‚– f) _ x) âˆ
  --   ComposeTraversal.â‹¯-assoc kit-assoc (Î»â†’ e) f g = cong Î»â†’_
  --     (e â‹¯ f â†‘ _ â‹¯ g â†‘ _        â‰¡âŸ¨ â‹¯-assoc e (f â†‘ _) (g â†‘ _) âŸ©
  --      e â‹¯ ((g â†‘ _) âˆ˜â‚– (f â†‘ _)) â‰¡âŸ¨ cong (e â‹¯_) (sym (dist-â†‘-âˆ˜ _ g f)) âŸ©
  --      e â‹¯ (g âˆ˜â‚– f) â†‘ _         âˆ)
  --   ComposeTraversal.â‹¯-assoc kit-assoc (eâ‚ Â· eâ‚‚) f g = congâ‚‚ _Â·_ (â‹¯-assoc eâ‚ f g) (â‹¯-assoc eâ‚‚ f g)

  dist-â†‘-f :
    âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
      â¦ƒ Câ‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
      â¦ƒ Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„
      â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
      â¦ƒ Wâ‚â‚‚ : KitT ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„
      (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    â†’ t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ _ id â‹¯ (Ï• â†‘ m) â‰¡ t â‹¯ Ï• â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ _ id
  dist-â†‘-f â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ â¦ƒ Câ‚ â¦„ â¦ƒ Câ‚‚ â¦„ t Ï• =
    (t â‹¯ wkâ‚– _ id) â‹¯ (Ï• â†‘ _)       â‰¡âŸ¨ â‹¯-assoc t (wkâ‚– _ id) (Ï• â†‘ _)  âŸ©
    t â‹¯ (wkâ‚– _ id Â·[ Câ‚‚ ] (Ï• â†‘ _)) â‰¡âŸ¨ ~-cong-â‹¯ t (~-sym (â†‘-wk Ï• _)) âŸ©
    t â‹¯ (Ï• Â·[ Câ‚ ] wkâ‚– _ id)       â‰¡âŸ¨ sym (â‹¯-assoc t Ï• (wkâ‚– _ id)) âŸ©
    (t â‹¯ Ï•) â‹¯ wkâ‚– _ id             âˆ

  -- &/â‹¯-assoc' :
  --   âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚â‚‚ ğ•‚â‚‚â‚ƒ ğ•‚â‚â‚‚,â‚ƒ ğ•‚â‚,â‚‚â‚ƒ â¦„
  --     â¦ƒ Câ‚â‚‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚â‚‚ â¦„
  --     â¦ƒ Câ‚â‚‚,â‚ƒ : ComposeKit ğ•‚â‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚â‚‚,â‚ƒ â¦„
  --     â¦ƒ Câ‚‚â‚ƒ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚‚â‚ƒ â¦„
  --     â¦ƒ Câ‚,â‚‚â‚ƒ : ComposeKit ğ•‚â‚ ğ•‚â‚‚â‚ƒ ğ•‚â‚,â‚‚â‚ƒ â¦„
  --     {Âµâ‚ Âµâ‚‚ Âµâ‚ƒ} {M} 
  --     (x/t : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] M) (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚ƒ ]â†’ Âµâ‚ƒ) â†’
  --   `/id ((x/t &/â‹¯[ Câ‚â‚‚ ] Ï•â‚) &/â‹¯[ Câ‚â‚‚,â‚ƒ ] Ï•â‚‚) â‰¡ `/id (x/t &/â‹¯[ Câ‚,â‚‚â‚ƒ ] (Ï•â‚ Â·[ Câ‚‚â‚ƒ ] Ï•â‚‚))
  -- &/â‹¯-assoc' = ?

  -- &/â‹¯-assoc :
  --   âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚â‚‚ ğ•‚â‚‚â‚ƒ ğ•‚â‚â‚‚â‚ƒ â¦„
  --     â¦ƒ Câ‚â‚‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚â‚‚ â¦„
  --     â¦ƒ Câ‚â‚‚,â‚ƒ : ComposeKit ğ•‚â‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚â‚‚â‚ƒ â¦„
  --     â¦ƒ Câ‚‚â‚ƒ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚‚â‚ƒ â¦„
  --     â¦ƒ Câ‚,â‚‚â‚ƒ : ComposeKit ğ•‚â‚ ğ•‚â‚‚â‚ƒ ğ•‚â‚â‚‚â‚ƒ â¦„
  --     {Âµâ‚ Âµâ‚‚ Âµâ‚ƒ} {M} 
  --     (x/t : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] M) (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚ƒ ]â†’ Âµâ‚ƒ) â†’
  --   (x/t &/â‹¯[ Câ‚â‚‚ ] Ï•â‚) &/â‹¯[ Câ‚â‚‚,â‚ƒ ] Ï•â‚‚ â‰¡ x/t &/â‹¯[ Câ‚,â‚‚â‚ƒ ] (Ï•â‚ Â·[ Câ‚‚â‚ƒ ] Ï•â‚‚)
  -- &/â‹¯-assoc = ?

  Â·-assoc :
    âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚â‚‚ ğ•‚â‚‚â‚ƒ ğ•‚â‚â‚‚,â‚ƒ ğ•‚â‚,â‚‚â‚ƒ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„
      â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
      â¦ƒ Wâ‚ƒ : KitT ğ•‚â‚ƒ â¦„
      â¦ƒ Wâ‚â‚‚ : KitT ğ•‚â‚â‚‚ â¦„
      â¦ƒ Wâ‚‚â‚ƒ : KitT ğ•‚â‚‚â‚ƒ â¦„
      â¦ƒ Wâ‚â‚‚,â‚ƒ : KitT ğ•‚â‚â‚‚,â‚ƒ â¦„
      â¦ƒ Wâ‚,â‚‚â‚ƒ : KitT ğ•‚â‚,â‚‚â‚ƒ â¦„
      â¦ƒ Câ‚â‚‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚â‚‚ â¦„
      â¦ƒ Câ‚â‚‚,â‚ƒ : ComposeKit ğ•‚â‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚â‚‚,â‚ƒ â¦„
      â¦ƒ Câ‚‚â‚ƒ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ƒ ğ•‚â‚‚â‚ƒ â¦„
      â¦ƒ Câ‚,â‚‚â‚ƒ : ComposeKit ğ•‚â‚ ğ•‚â‚‚â‚ƒ ğ•‚â‚,â‚‚â‚ƒ â¦„
      {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {Âµâ‚„}
      (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
      (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
      (Ï•â‚ƒ : Âµâ‚ƒ â€“[ ğ•‚â‚ƒ ]â†’ Âµâ‚„)
    â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) Â·â‚– Ï•â‚ƒ) ~ (Ï•â‚ Â·â‚– (Ï•â‚‚ Â·â‚– Ï•â‚ƒ))
  Â·-assoc â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚â‚ƒ â¦„ â¦ƒ ğ•‚â‚â‚‚ â¦„ â¦ƒ ğ•‚â‚‚â‚ƒ â¦„ â¦ƒ ğ•‚â‚â‚‚,â‚ƒ â¦„ â¦ƒ ğ•‚â‚,â‚‚â‚ƒ â¦„ â¦ƒ Câ‚â‚‚ â¦„ â¦ƒ Câ‚â‚‚,â‚ƒ â¦„ â¦ƒ Câ‚‚â‚ƒ â¦„ â¦ƒ Câ‚,â‚‚â‚ƒ â¦„
          {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {Âµâ‚„} Ï•â‚ Ï•â‚‚ Ï•â‚ƒ m x =
    `/id (x & ((Ï•â‚ Â·â‚– Ï•â‚‚) Â·â‚– Ï•â‚ƒ))                     â‰¡âŸ¨ sym (â‹¯-var x ((Ï•â‚ Â·â‚– Ï•â‚‚) Â·â‚– Ï•â‚ƒ)) âŸ©
    ` x â‹¯ ((Ï•â‚ Â·â‚– Ï•â‚‚) Â·â‚– Ï•â‚ƒ)                          â‰¡âŸ¨ sym (â‹¯-assoc (` x) (Ï•â‚ Â·â‚– Ï•â‚‚) Ï•â‚ƒ) âŸ©
    ` x â‹¯ (Ï•â‚ Â·â‚– Ï•â‚‚) â‹¯ Ï•â‚ƒ                             â‰¡âŸ¨ sym (cong (_â‹¯ Ï•â‚ƒ) (â‹¯-assoc (` x) Ï•â‚ Ï•â‚‚)) âŸ©
    ` x â‹¯ Ï•â‚ â‹¯ Ï•â‚‚ â‹¯ Ï•â‚ƒ                                â‰¡âŸ¨ â‹¯-assoc (` x â‹¯ Ï•â‚) Ï•â‚‚ Ï•â‚ƒ âŸ©
    ` x â‹¯ Ï•â‚ â‹¯ (Ï•â‚‚ Â·â‚– Ï•â‚ƒ)                             â‰¡âŸ¨ â‹¯-assoc (` x) Ï•â‚ (Ï•â‚‚ Â·â‚– Ï•â‚ƒ) âŸ©
    ` x â‹¯ (Ï•â‚ Â·â‚– (Ï•â‚‚ Â·â‚– Ï•â‚ƒ))                          â‰¡âŸ¨ â‹¯-var x (Ï•â‚ Â·â‚– (Ï•â‚‚ Â·â‚– Ï•â‚ƒ)) âŸ©
    `/id (x & (Ï•â‚ Â·â‚– (Ï•â‚‚ Â·â‚– Ï•â‚ƒ)))                     âˆ

  dist-â†‘-â¦…â¦†-Â· :
    âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„
      â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
      â¦ƒ W : KitT ğ•‚ â¦„
      â¦ƒ Câ‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚ ğ•‚ â¦„
      â¦ƒ Câ‚ƒ : ComposeKit ğ•‚â‚‚ ğ•‚â‚‚ ğ•‚â‚‚ â¦„
      {Âµâ‚ Âµâ‚‚ m} (x/t : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] id/mâ†’M m) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) â†’
      let sub = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) in
    (â¦… x/t â¦† Â·[ Câ‚ ] Ï•) ~ ((Ï• â†‘ m) Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†)
  dist-â†‘-â¦…â¦†-Â· â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ Wâ‚ â¦„ â¦ƒ Wâ‚‚ â¦„ â¦ƒ W â¦„ â¦ƒ Câ‚ â¦„ â¦ƒ Câ‚‚ â¦„ â¦ƒ Câ‚ƒ â¦„ {Âµâ‚} {Âµâ‚‚} {m} x/t Ï• mx x@(here refl) =
    let sub = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) in
    let sub' = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) in
    let sub'' = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) in
    let subâ‚ = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (sym (Î¹-id/mâ†’M m)) in
    `/id (x & (â¦… x/t â¦† Â·[ Câ‚ ] Ï•))                              â‰¡âŸ¨ cong `/id (&-Â·â‚–-&/â‹¯ â¦… x/t â¦† Ï• x) âŸ©
    `/id (sub (x & â¦… x/t â¦† &/â‹¯ Ï•))                              â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub (â–  &/â‹¯ Ï•))) (~â†’~' (â¦…â¦†-,â‚– x/t) _ x) âŸ©
    `/id (sub (x & (id ,â‚– x/t) &/â‹¯ Ï•))                          â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub (â–  &/â‹¯ Ï•))) (&-,â‚–-here id x/t) âŸ©
    `/id (sub (x/t &/â‹¯ Ï•))                                      â‰¡âŸ¨ cong `/id (sym (cancel-subst' (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) (sub (x/t &/â‹¯ Ï•)))) âŸ©
    `/id (sub'' (subâ‚ (sub (x/t &/â‹¯ Ï•))))                       â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub'' â– )) (sym (Î¹-âˆ‹/âŠ¢-id refl _)) âŸ©
    `/id (sub'' (Î¹-âˆ‹/âŠ¢ (sub (x/t &/â‹¯ Ï•))))                      â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub'' (Î¹-âˆ‹/âŠ¢ â– )))
                                                                        (sym (&-,â‚–-here id (sub (x/t &/â‹¯[ Câ‚ ] Ï•)))) âŸ©
    `/id (sub'' (Î¹-âˆ‹/âŠ¢ (here refl & (id â¦ƒ ğ•‚ = ğ•‚ â¦„ ,â‚– sub (x/t &/â‹¯[ Câ‚ ] Ï•)))))
                                                                â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub'' (Î¹-âˆ‹/âŠ¢ â– )))
                                                                        (sym (~â†’~' (â¦…â¦†-,â‚– (sub (x/t &/â‹¯[ Câ‚ ] Ï•))) _ (here refl))) âŸ©
    `/id (sub'' (Î¹-âˆ‹/âŠ¢ (here refl & â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))) â‰¡âŸ¨ cong `/id (sym (&/â‹¯-& â¦ƒ Câ‚‚ â¦„ (here refl)
                                                                                                    â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†)) âŸ©
    `/id (sub' (id/` (here refl) &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))  â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub' (â–  &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†)))
                                                                              (sym (&-â†‘-here Ï•)) âŸ© 
    `/id (sub' (x & (Ï• â†‘ m) &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))     â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ (Ï• â†‘ m) â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦† x)) âŸ©
    `/id (x & ((Ï• â†‘ m) Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))       âˆ
  dist-â†‘-â¦…â¦†-Â· â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ Wâ‚ â¦„ â¦ƒ Wâ‚‚ â¦„ â¦ƒ W â¦„ â¦ƒ Câ‚ â¦„ â¦ƒ Câ‚‚ â¦„ â¦ƒ Câ‚ƒ â¦„ {Âµâ‚} {Âµâ‚‚} {m} x/t Ï• mx x@(there y) =
    let sub = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M â¦ƒ ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ Câ‚ â¦„ â¦„ m) in
    let sub' = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M â¦ƒ ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ Câ‚ â¦„ â¦„ mx) in
    let sub'' = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M â¦ƒ ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ Câ‚‚ â¦„ â¦„ mx) in
    let subâ‚‚ = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M â¦ƒ ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ Câ‚ â¦„ â¦„ mx) in
    `/id (x & (â¦… x/t â¦† Â·[ Câ‚ ] Ï•))                              â‰¡âŸ¨ cong `/id (&-Â·â‚–-&/â‹¯ â¦… x/t â¦† Ï• x) âŸ©
    `/id (sub' (x & â¦… x/t â¦† &/â‹¯ Ï•))                             â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub' (â–  &/â‹¯[ Câ‚ ] Ï•))) (~â†’~' (â¦…â¦†-,â‚– x/t) _ x) âŸ©
    `/id (sub' (x & (id ,â‚– x/t) &/â‹¯ Ï•))                         â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub' (â–  &/â‹¯[ Câ‚ ] Ï•))) (&-,â‚–-there id x/t y) âŸ©
    `/id (sub' (y & id &/â‹¯ Ï•))                                  â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub' (â–  &/â‹¯[ Câ‚ ] Ï•))) (&-id y) âŸ©
    `/id (sub' (id/` y &/â‹¯ Ï•))                                  â‰¡âŸ¨ cong (`/id â¦ƒ ğ•‚ â¦„) (&/â‹¯-& y Ï•) âŸ©
    `/id (subâ‚‚ (Î¹-âˆ‹/âŠ¢ â¦ƒ ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ Câ‚ â¦„ â¦„ (y & Ï•)))             â‰¡âŸ¨ cong (`/id â¦ƒ ğ•‚ â¦„) (sym (Î¹-ap-â†’ Ï• y)) âŸ©
    `/id (y & (Î¹-â†’ â¦ƒ ğ•‚â‚âŠ‘ğ•‚â‚‚ = ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ Câ‚ â¦„ â¦„ Ï•))              â‰¡âŸ¨ Î¹-~-â†’ Ï• _ y âŸ©
    `/id (y & Ï•)                                                             â‰¡âŸ¨ sym (Â·-idÊ³ Ï• _ y) âŸ©
    `/id (y & (Ï• Â·[ Câ‚‚ ] id))                                                â‰¡âŸ¨ ~-cong-Â· ~-refl (~-sym (wk-cancels-,â‚–-Â· id (sub (x/t &/â‹¯[ Câ‚ ] Ï•)))) _ y âŸ©
    `/id (y & (Ï• Â·[ Câ‚‚ ] (wkâ‚– _ id Â·[ Câ‚‚ ] (id ,â‚– sub (x/t &/â‹¯[ Câ‚ ] Ï•)))))  â‰¡âŸ¨ ~-cong-Â· ~-refl (~-cong-Â· ~-refl (~-sym (â¦…â¦†-,â‚– (sub (x/t &/â‹¯[ Câ‚ ] Ï•))))) _ y âŸ©
    `/id (y & (Ï• Â·[ Câ‚‚ ] (wkâ‚– _ id Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†)))      â‰¡âŸ¨ sym (Â·-assoc Ï• (wkâ‚– _ id) â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦† _ y) âŸ©
    `/id (y & ((Ï• Â·[ Câ‚ƒ ] wkâ‚– _ id) Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))      â‰¡âŸ¨ ~-cong-Â· (~-sym (wk-Ï•-id Ï•)) ~-refl _ y âŸ©
    `/id (y & (wkâ‚– _ Ï• Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))      â‰¡âŸ¨ cong `/id (&-Â·â‚–-&/â‹¯ â¦ƒ C = Câ‚‚ â¦„ (wkâ‚– _ Ï•) â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦† y) âŸ©
    `/id (sub'' (y & (wkâ‚– _ Ï•) &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))  â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub'' (â–  &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†)))
                                                                              (&-wkâ‚–-wk Ï• y) âŸ©
    `/id (sub'' (wk _ (y & Ï•) &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))   â‰¡âŸ¨ cong (Î» â–  â†’ `/id (sub'' (â–  &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†)))
                                                                              (sym (&-â†‘-there Ï• y)) âŸ© 
    `/id (sub'' (x & (Ï• â†‘ m) &/â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))    â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ â¦ƒ C = Câ‚‚ â¦„ (Ï• â†‘ m) â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦† x)) âŸ©
    `/id (x & ((Ï• â†‘ m) Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†))      âˆ

  -- ComposeKit for Substitutions ------------------------------------------------

  -- &/â‹¯-wk-â†‘â‚› : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx}
  --               (t : Âµâ‚ âŠ¢ mx)
  --               (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚)
  --             â†’ wk _ (t â‹¯ Ï•) â‰¡ wk _ t â‹¯ (Ï• â†‘ m)
  -- &/â‹¯-wk-â†‘â‚› â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx} t Ï• =
  --   wk _ (t â‹¯ Ï•)                                        â‰¡âŸ¨ {!!} âŸ©
  --   t â‹¯ Ï• â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id                       â‰¡âŸ¨ {!!} âŸ©
  --   t â‹¯ (Ï• â†‘* []) â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* [])       â‰¡âŸ¨âŸ©
  --   t â‹¯* (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id âˆ· Ï• âˆ· []) â†‘** []        â‰¡âŸ¨
  --     â‹¯-â†‘ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id âˆ· Ï• âˆ· [])
  --         ((Ï• â†‘ m) âˆ· wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id âˆ· [])
  --         (Î» {Âµ'} x â†’
  --           ` x â‹¯ (Ï• â†‘* Âµ') â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* Âµ')           â‰¡âŸ¨ cong (_â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* Âµ')) (â‹¯-var x (Ï• â†‘* Âµ')) âŸ©
  --           `/id (x & (Ï• â†‘* Âµ')) â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* Âµ')       â‰¡âŸ¨ {!!} âŸ©
  --           `/id (x & (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* Âµ')) â‹¯ ((Ï• â†‘ m) â†‘* Âµ') â‰¡âŸ¨ cong (_â‹¯ Ï• â†‘ m â†‘* Âµ') (sym (â‹¯-var x (wkâ‚– _ id â†‘* Âµ'))) âŸ©
  --           ` x â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* Âµ') â‹¯ ((Ï• â†‘ m) â†‘* Âµ')      âˆ
  --         )
  --         t âŸ©
  --   t â‹¯* ((Ï• â†‘ m) âˆ· wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id âˆ· []) â†‘** []  â‰¡âŸ¨âŸ©
  --   t â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â†‘* []) â‹¯ ((Ï• â†‘ m) â†‘* []) â‰¡âŸ¨ {!!} âŸ©
  --   t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• â†‘ m)                 â‰¡âŸ¨ {!!} âŸ©
  --   wk _ t â‹¯ (Ï• â†‘ m)                                    âˆ

  -- &/â‹¯-wk-â†‘â‚› : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx}
  --               (t : Âµâ‚ âŠ¢ mx)
  --               (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚)
  --             â†’ wk _ (t â‹¯ Ï•) â‰¡ wk _ t â‹¯ (Ï• â†‘ m)
  -- &/â‹¯-wk-â†‘â‚› â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {mx} t Ï• =
  --   wk _ (t â‹¯ Ï•)                                        â‰¡âŸ¨ {!!} âŸ©
  --   t â‹¯ Ï• â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id                       â‰¡âŸ¨ {!!} âŸ©
  --   t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• â†‘ m)                 â‰¡âŸ¨ {!!} âŸ©
  --   wk _ t â‹¯ (Ï• â†‘ m)                                    âˆ

  -- ckitâ‚› : âˆ€ â¦ƒ ğ•‚ â¦„ â†’ ComposeKit kitâ‚› ğ•‚ kitâ‚›
  -- ckitâ‚› â¦ƒ ğ•‚ â¦„ = record
  --   { ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚  = âŠ‘â‚–-refl â¦ƒ kitâ‚› â¦„
  --   ; ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚  = âŠ‘â‚–-âŠ¤ â¦ƒ ğ•Š â¦„ â¦ƒ ğ•‚ â¦„
  --   ; _&/â‹¯_      = _â‹¯_
  --   ; &/â‹¯-â‹¯      = Î» x/t Ï• â†’ refl
  --   ; &/â‹¯-&      = &/â‹¯-&â‚›
  --   ; &/â‹¯-wk-â†‘   = &/â‹¯-wk-â†‘â‚›
  --   ; ~-cong-&/â‹¯ = ~-cong-&/â‹¯â‚›
  --   }

  &/â‹¯-&â‚› : âˆ€ â¦ƒ ğ•‚ â¦„ â¦ƒ W : KitT ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} (x : Âµâ‚ âˆ‹ m) (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) 
           â†’ let subâ‚‚ = subst (Âµâ‚‚ âŠ¢_) (Î¹-id/mâ†’M â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•‚ = ğ•‚ â¦„ â¦„ m) in
             ` x â‹¯ Ï• â‰¡ subâ‚‚ (Î¹-âˆ‹/âŠ¢ â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•‚ = ğ•‚ â¦„ â¦„ (x & Ï•))
  &/â‹¯-&â‚› â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} x Ï• =
    let subâ‚‚ = subst (Âµâ‚‚ âŠ¢_) (Î¹-id/mâ†’M â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•‚ = ğ•‚ â¦„ â¦„ m) in
    ` x â‹¯ Ï•                                 â‰¡âŸ¨ â‹¯-var' x Ï• âŸ©
    subâ‚‚ (`/id' (x & Ï•))                    â‰¡âŸ¨âŸ©
    subâ‚‚ (Î¹-âˆ‹/âŠ¢ â¦ƒ âŠ‘â‚–-âŠ¤ â¦ƒ ğ•‚ = ğ•‚ â¦„ â¦„ (x & Ï•)) âˆ

  ~-cong-&/â‹¯â‚› :
    âˆ€ â¦ƒ ğ•‚ â¦„ â¦ƒ W : KitT ğ•‚ â¦„ {m} {tâ‚ tâ‚‚ : Âµâ‚ âŠ¢ mâ†’M m}
      {Ï•â‚ Ï•â‚‚ : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚}
    â†’ tâ‚ â‰¡ tâ‚‚
    â†’ Ï•â‚ ~ Ï•â‚‚
    â†’ tâ‚ â‹¯ Ï•â‚ â‰¡ tâ‚‚ â‹¯ Ï•â‚‚
  ~-cong-&/â‹¯â‚› refl Ï•â‚~Ï•â‚‚ = ~-cong-â‹¯ _ Ï•â‚~Ï•â‚‚

  &/â‹¯-wk-â†‘â‚›áµ£ : âˆ€ {Âµâ‚} {Âµâ‚‚} {m} {mx}
                 (t : Âµâ‚ âŠ¢ mx)
                 (Ï• : Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚)
               â†’ wk _ (t â‹¯ Ï•) â‰¡ wk _ t â‹¯ (Ï• â†‘ m)
  &/â‹¯-wk-â†‘â‚›áµ£ {Âµâ‚} {Âµâ‚‚} {m} {mx} t Ï• =
    wk _ (t â‹¯ Ï•)                           â‰¡âŸ¨ refl âŸ©
    t â‹¯ Ï• â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id          â‰¡âŸ¨ â‹¯-assoc t Ï• (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id) âŸ©
    t â‹¯ (Ï• Â·â‚– wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id)       â‰¡âŸ¨ ~-cong-â‹¯ t (â†‘-wk Ï• _) âŸ©
    t â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id Â·â‚– (Ï• â†‘ m)) â‰¡âŸ¨ sym (â‹¯-assoc t (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id) (Ï• â†‘ m)) âŸ©
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• â†‘ m)    â‰¡âŸ¨ refl âŸ©
    wk _ t â‹¯ (Ï• â†‘ m)                       âˆ

  ckitâ‚›áµ£ : ComposeKit kitâ‚› kitáµ£ kitâ‚›
  ckitâ‚›áµ£ = record
    { ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚  = âŠ‘â‚–-refl â¦ƒ kitâ‚› â¦„
    ; ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚  = âŠ‘â‚–-âŠ¤ â¦ƒ kitáµ£ â¦„
    ; _&/â‹¯_      = _â‹¯_
    ; &/â‹¯-â‹¯      = Î» x/t Ï• â†’ refl
    ; &/â‹¯-&      = &/â‹¯-&â‚›
    ; &/â‹¯-wk-â†‘   = &/â‹¯-wk-â†‘â‚›áµ£
    ; ~-cong-&/â‹¯ = ~-cong-&/â‹¯â‚›
    }

  private instance _ = ckitâ‚›áµ£

  &/â‹¯-wk-â†‘â‚›â‚› : âˆ€ {Âµâ‚} {Âµâ‚‚} {m} {mx}
                 (t : Âµâ‚ âŠ¢ mx)
                 (Ï• : Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚)
               â†’ wk _ (t â‹¯ Ï•) â‰¡ wk _ t â‹¯ (Ï• â†‘ m)
  &/â‹¯-wk-â†‘â‚›â‚› {Âµâ‚} {Âµâ‚‚} {m} {mx} t Ï• =
    wk _ (t â‹¯ Ï•)                           â‰¡âŸ¨ refl âŸ©
    t â‹¯ Ï• â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id          â‰¡âŸ¨ â‹¯-assoc t Ï• (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id) âŸ©
    t â‹¯ (Ï• Â·â‚– wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id)       â‰¡âŸ¨ ~-cong-â‹¯ t (â†‘-wk Ï• _) âŸ©
    t â‹¯ (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id Â·â‚– (Ï• â†‘ m)) â‰¡âŸ¨ sym (â‹¯-assoc t (wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id) (Ï• â†‘ m)) âŸ©
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• â†‘ m)    â‰¡âŸ¨ refl âŸ©
    wk _ t â‹¯ (Ï• â†‘ m)                       âˆ

  ckitâ‚›â‚› : ComposeKit kitâ‚› kitâ‚› kitâ‚›
  ckitâ‚›â‚› = record
    { ğ•‚â‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚  = âŠ‘â‚–-refl â¦ƒ kitâ‚› â¦„
    ; ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚  = âŠ‘â‚–-âŠ¤ â¦ƒ kitâ‚› â¦„
    ; _&/â‹¯_      = _â‹¯_
    ; &/â‹¯-â‹¯      = Î» x/t Ï• â†’ refl
    ; &/â‹¯-&      = &/â‹¯-&â‚›
    ; &/â‹¯-wk-â†‘   = &/â‹¯-wk-â†‘â‚›â‚›
    ; ~-cong-&/â‹¯ = ~-cong-&/â‹¯â‚›
    }

  private instance _ = ckitâ‚›â‚›

  -- infixl  9  _â‚›Â·_  _â‚›Â·áµ£_  _â‚›Â·â‚›_
  -- infixr  9  _âˆ˜â‚›_  _áµ£âˆ˜â‚›_  _â‚›âˆ˜â‚›_
  infixl  9  _â‚›Â·áµ£_  _â‚›Â·â‚›_
  infixr  9  _áµ£âˆ˜â‚›_  _â‚›âˆ˜â‚›_

  -- _â‚›Â·_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
  --       â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚
  --       â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
  --       â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  -- Ïƒ â‚›Â· Ï• = Ïƒ Â·â‚– Ï•

  -- _âˆ˜â‚›_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  -- Ï•â‚‚ âˆ˜â‚› Ï•â‚ = Ï•â‚ â‚›Â· Ï•â‚‚

  _â‚›Â·áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _â‚›Â·â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _áµ£âˆ˜â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _â‚›âˆ˜â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  _â‚›Â·áµ£_ = _Â·â‚–_
  _â‚›Â·â‚›_ = _Â·â‚–_
  _áµ£âˆ˜â‚›_ = _âˆ˜â‚–_
  _â‚›âˆ˜â‚›_ = _âˆ˜â‚–_

--   âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ : âˆ€ {{ğ•‚â‚ ğ•‚â‚‚ ğ•‚â‚' ğ•‚â‚‚' ğ•‚ : Kit}}
--               {{ğ”¸  : ComposeKit ğ•‚â‚  ğ•‚â‚‚  ğ•‚}}
--               {{ğ”¸' : ComposeKit ğ•‚â‚' ğ•‚â‚‚' ğ•‚}}
--               {Ï•â‚  : Âµâ‚ â€“[ ğ•‚â‚  ]â†’ Âµâ‚‚ } {Ï•â‚‚  : Âµâ‚‚  â€“[ ğ•‚â‚‚  ]â†’ Âµâ‚ƒ}
--               {Ï•â‚' : Âµâ‚ â€“[ ğ•‚â‚' ]â†’ Âµâ‚‚'} {Ï•â‚‚' : Âµâ‚‚' â€“[ ğ•‚â‚‚' ]â†’ Âµâ‚ƒ} â†’
--     (Ï•â‚ Â·[ ğ”¸ ] Ï•â‚‚) ~ (Ï•â‚' Â·[ ğ”¸' ] Ï•â‚‚') â†’
--     âˆ€ {M} (t : Âµâ‚ âŠ¢ M) â†’
--     t â‹¯ Ï•â‚ â‹¯ Ï•â‚‚ â‰¡ t â‹¯ Ï•â‚' â‹¯ Ï•â‚‚'
--   âˆ˜~âˆ˜â†’â‹¯â‰¡â‹¯ â¦ƒ ğ”¸ = ğ”¸ â¦„ â¦ƒ ğ”¸' â¦„ {Ï•â‚ = Ï•â‚} {Ï•â‚‚ = Ï•â‚‚} {Ï•â‚' = Ï•â‚'} {Ï•â‚‚' = Ï•â‚‚'} eq t =
--     t â‹¯ Ï•â‚ â‹¯ Ï•â‚‚         â‰¡âŸ¨ â‹¯-assoc t Ï•â‚ Ï•â‚‚ âŸ©
--     t â‹¯ Ï•â‚  Â·[ ğ”¸  ] Ï•â‚‚  â‰¡âŸ¨ ~-cong-â‹¯ t eq âŸ©
--     t â‹¯ Ï•â‚' Â·[ ğ”¸' ] Ï•â‚‚' â‰¡âŸ¨ sym (â‹¯-assoc t Ï•â‚' Ï•â‚‚') âŸ©
--     t â‹¯ Ï•â‚' â‹¯ Ï•â‚‚'  âˆ

  wk-cancels-,â‚– :
    âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„ â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„ â¦ƒ W : KitT ğ•‚ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m)
    â†’ t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id â‹¯ (Ï• ,â‚– x/t) â‰¡ t â‹¯ Ï•
  wk-cancels-,â‚– â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C = C â¦„ t Ï• x/t =
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id â‹¯ (Ï• ,â‚– x/t)        â‰¡âŸ¨ â‹¯-assoc â¦ƒ ğ”¸ = C â¦„ t (wkâ‚– _ id) (Ï• ,â‚– x/t) âŸ©
    t â‹¯ (wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id Â·[ C ] (Ï• ,â‚– x/t)) â‰¡âŸ¨ ~-cong-â‹¯ _ (wk-cancels-,â‚–-Â· â¦ƒ C = C â¦„ Ï• x/t) âŸ©
    t â‹¯ Ï•                                       âˆ

  wkáµ£-cancels-,â‚– : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
                     (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• ,â‚– x/t) â‰¡ t â‹¯ Ï•
  wkáµ£-cancels-,â‚– = wk-cancels-,â‚– â¦ƒ C = ckitáµ£ â¦„

  wkáµ£-cancels-,áµ£ : âˆ€ (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â†’áµ£ Âµâ‚‚) (x : Âµâ‚‚ âˆ‹ m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• ,â‚– x) â‰¡ t â‹¯ Ï•
  wkáµ£-cancels-,áµ£ = wk-cancels-,â‚– â¦ƒ C = ckitáµ£ â¦„

  wkáµ£-cancels-,â‚› : âˆ€ (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â†’â‚› Âµâ‚‚) (t' : Âµâ‚‚ âŠ¢ mâ†’M m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ (Ï• ,â‚– t') â‰¡ t â‹¯ Ï•
  wkáµ£-cancels-,â‚› = wk-cancels-,â‚– â¦ƒ C = ckitáµ£ â¦„

  wkâ‚›-cancels-,áµ£ : âˆ€ (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â†’áµ£ Âµâ‚‚) (x : Âµâ‚‚ âˆ‹ m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitâ‚› â¦„ _ id â‹¯ (Ï• ,â‚– x) â‰¡ t â‹¯ Ï•
  wkâ‚›-cancels-,áµ£ t Ï• x = wk-cancels-,â‚– â¦ƒ C = ckitâ‚›áµ£ â¦„ t Ï• x

  wkâ‚›-cancels-,â‚› : âˆ€ (t : Âµâ‚ âŠ¢ M) (Ï• : Âµâ‚ â†’â‚› Âµâ‚‚) (t' : Âµâ‚‚ âŠ¢ mâ†’M m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitâ‚› â¦„ _ id â‹¯ (Ï• ,â‚– t') â‰¡ t â‹¯ Ï•
  wkâ‚›-cancels-,â‚› t Ï• t' = wk-cancels-,â‚– â¦ƒ C = ckitâ‚›â‚› â¦„ t Ï• t'

  --------------------------------------------------------------------------------

  dist-áµ£Â·áµ£-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (x : Âµâ‚ âˆ‹ m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
    (â¦… x â¦† áµ£Â·áµ£ Ï) ~ ((Ï â†‘ m) áµ£Â·áµ£ â¦… x & Ï â¦†)
  dist-áµ£Â·áµ£-â¦…â¦† = dist-â†‘-â¦…â¦†-Â·

  dist-â‚›Â·áµ£-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t : Âµâ‚ âŠ¢ mâ†’M m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
    (â¦… t â¦† â‚›Â·áµ£ Ï) ~ ((Ï â†‘ m) áµ£Â·â‚› â¦… t â‹¯ Ï â¦†)
  dist-â‚›Â·áµ£-â¦…â¦† = dist-â†‘-â¦…â¦†-Â·

  dist-áµ£Â·â‚›-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (x : Âµâ‚ âˆ‹ m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
    (â¦… x â¦† áµ£Â·â‚› Ïƒ) ~ ((Ïƒ â†‘ m) â‚›Â·â‚› â¦… x & Ïƒ â¦†)
  dist-áµ£Â·â‚›-â¦…â¦† = dist-â†‘-â¦…â¦†-Â·

  dist-â‚›Â·â‚›-â¦…â¦† : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t : Âµâ‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
    (â¦… t â¦† â‚›Â·â‚› Ïƒ) ~ ((Ïƒ â†‘ m) â‚›Â·â‚› â¦… t â‹¯ Ïƒ â¦†)
  dist-â‚›Â·â‚›-â¦…â¦† = dist-â†‘-â¦…â¦†-Â·

  --------------------------------------------------------------------------------

  dist-â¦…â¦†-â‹¯ :
    âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„ â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„ â¦ƒ W : KitT ğ•‚ â¦„ 
      â¦ƒ Câ‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚ ğ•‚ â¦„
      â¦ƒ Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚â‚‚ ğ•‚â‚‚ â¦„
      {Âµâ‚ Âµâ‚‚ m M}
      (t : (m âˆ· Âµâ‚) âŠ¢ M) (x/t : Âµâ‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] id/mâ†’M m) (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) â†’
    let sub = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) in
    t â‹¯ â¦… x/t â¦† â‹¯ Ï• â‰¡ t â‹¯ (Ï• â†‘ m) â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†
  dist-â¦…â¦†-â‹¯ â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ Wâ‚ â¦„ â¦ƒ Wâ‚‚ â¦„ â¦ƒ W â¦„ â¦ƒ Câ‚ â¦„ â¦ƒ Câ‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} {M} t x/t Ï• =
    let sub = subst (Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ]_) (Î¹-id/mâ†’M m) in
    t â‹¯ â¦… x/t â¦† â‹¯ Ï•                                 â‰¡âŸ¨ â‹¯-assoc t â¦… x/t â¦† Ï• âŸ©
    t â‹¯ (â¦… x/t â¦† Â·[ Câ‚ ] Ï•)                         â‰¡âŸ¨ ~-cong-â‹¯ t (dist-â†‘-â¦…â¦†-Â· x/t Ï•) âŸ©
    t â‹¯ ((Ï• â†‘ m) Â·[ Câ‚‚ ] â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†) â‰¡âŸ¨ sym (â‹¯-assoc t (Ï• â†‘ m) â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†) âŸ©
    t â‹¯ (Ï• â†‘ m) â‹¯ â¦… sub (x/t &/â‹¯[ Câ‚ ] Ï•) â¦†         âˆ

  dist-â¦…â¦†áµ£-â‹¯áµ£ : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (x : Âµâ‚ âˆ‹ m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
    t â‹¯ â¦… x â¦† â‹¯ Ï â‰¡ t â‹¯ (Ï â†‘ m) â‹¯ â¦… x & Ï â¦†
  dist-â¦…â¦†áµ£-â‹¯áµ£ = dist-â¦…â¦†-â‹¯

  dist-â¦…â¦†â‚›-â‹¯áµ£ : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (t' : Âµâ‚ âŠ¢ mâ†’M m) (Ï : Âµâ‚ â†’áµ£ Âµâ‚‚) â†’
    t â‹¯ â¦… t' â¦† â‹¯ Ï â‰¡ t â‹¯ (Ï â†‘ m) â‹¯ â¦… t' â‹¯ Ï â¦†
  dist-â¦…â¦†â‚›-â‹¯áµ£ = dist-â¦…â¦†-â‹¯

  dist-â¦…â¦†áµ£-â‹¯â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (x : Âµâ‚ âˆ‹ m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
    t â‹¯ â¦… x â¦† â‹¯ Ïƒ â‰¡ t â‹¯ (Ïƒ â†‘ m) â‹¯ â¦… x & Ïƒ â¦†
  dist-â¦…â¦†áµ£-â‹¯â‚› = dist-â¦…â¦†-â‹¯

  dist-â¦…â¦†â‚›-â‹¯â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m M} (t : (m âˆ· Âµâ‚) âŠ¢ M) (t' : Âµâ‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
    t â‹¯ â¦… t' â¦† â‹¯ Ïƒ â‰¡ t â‹¯ (Ïƒ â†‘ m) â‹¯ â¦… t' â‹¯ Ïƒ â¦†
  dist-â¦…â¦†â‚›-â‹¯â‚› = dist-â¦…â¦†-â‹¯

--   record ComposeTraversalLemmas : Setâ‚ where

  â‹¯-idâ‚› : âˆ€ {Âµ M} (t : Âµ âŠ¢ M) â†’ t â‹¯ id â¦ƒ ğ•‚ = kitâ‚› â¦„ â‰¡ t
  â‹¯-idáµ£ : âˆ€ {Âµ M} (t : Âµ âŠ¢ M) â†’ t â‹¯ id â¦ƒ ğ•‚ = kitáµ£ â¦„ â‰¡ t
  â‹¯-idâ‚› = â‹¯-id
  â‹¯-idáµ£ = â‹¯-id

  -- -- TODO OLD: We can transfer this from â‹¯-id if we extend ComposeKit with a lemma,
  -- -- that operations on terms determine operations on &/â‹¯
  -- -- We could go even further and say operations on &/â‹¯ and â‹¯ are determined by
  -- -- operations on ap. Note that this is precisely what KitAltSimple does!!!!
  -- &/â‹¯-id :
  --   âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit â¦„
  --     â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
  --     {Âµ} {m/M} (x/t : Âµ âˆ‹/âŠ¢[ ğ•‚â‚ ] m/M)
  --   â†’ x/t &/â‹¯ id â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ â‰¡ Î¹-âˆ‹/âŠ¢ x/t
  -- &/â‹¯-id â¦ƒ ğ•‚ â¦„ {Âµ} {M} x/t = {!!}

  wk-cancels-â¦…â¦† :
    âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ : Kit â¦„
      â¦ƒ KTâ‚ : KitT ğ•‚â‚ â¦„ â¦ƒ KTâ‚‚ : KitT ğ•‚â‚‚ â¦„ â¦ƒ KT : KitT ğ•‚ â¦„
      â¦ƒ Câ‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ ğ•‚ â¦„
      (t : Âµ âŠ¢ M) (x/t : Âµ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id â‹¯ â¦… x/t â¦† â‰¡ t
  wk-cancels-â¦…â¦† â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ Câ‚ â¦„ â¦ƒ Câ‚‚ â¦„ t x/t =
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id â‹¯ â¦… x/t â¦†     â‰¡âŸ¨ ~-cong-â‹¯ (t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id) (â¦…â¦†-,â‚– x/t) âŸ©
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ _ id â‹¯ (id ,â‚– x/t) â‰¡âŸ¨ wk-cancels-,â‚– t id x/t âŸ©
    t â‹¯ id                                â‰¡âŸ¨ â‹¯-id t âŸ©
    t                                     âˆ

  wkáµ£-cancels-â¦…â¦†áµ£ : âˆ€ {Âµ M m} (t : Âµ âŠ¢ M) (x : Âµ âˆ‹ m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ â¦… x â¦†áµ£ â‰¡ t
  wkáµ£-cancels-â¦…â¦†áµ£ = wk-cancels-â¦…â¦†

  wkáµ£-cancels-â¦…â¦†â‚› : âˆ€ {Âµ M m} (t : Âµ âŠ¢ M) (t' : Âµ âŠ¢ mâ†’M m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitáµ£ â¦„ _ id â‹¯ â¦… t' â¦†â‚› â‰¡ t
  wkáµ£-cancels-â¦…â¦†â‚› = wk-cancels-â¦…â¦†

  wkâ‚›-cancels-â¦…â¦†áµ£ : âˆ€ {Âµ M m} (t : Âµ âŠ¢ M) (x : Âµ âˆ‹ m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitâ‚› â¦„ _ id â‹¯ â¦… x â¦†áµ£ â‰¡ t
  wkâ‚›-cancels-â¦…â¦†áµ£ = wk-cancels-â¦…â¦†

  wkâ‚›-cancels-â¦…â¦†â‚› : âˆ€ {Âµ M m} (t : Âµ âŠ¢ M) (t' : Âµ âŠ¢ mâ†’M m) â†’
    t â‹¯ wkâ‚– â¦ƒ ğ•‚ = kitâ‚› â¦„ _ id â‹¯ â¦… t' â¦†â‚› â‰¡ t
  wkâ‚›-cancels-â¦…â¦†â‚› = wk-cancels-â¦…â¦†

  -- -- special case of 
  -- --   dist-,â‚–-Â·Ê³ : âˆ€ {m}
  -- --                  (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
  -- --                  (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
  -- --                  (x/t : Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m)
  -- --                â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚–' x/t) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ ,â‚– x/t))
  -- â†‘âˆ˜â¦…â¦†-is-,â‚– :
  --   âˆ€ â¦ƒ ğ•‚ â¦„ â¦ƒ C : ComposeKit ğ•‚ ğ•‚ ğ•‚ â¦„ {Âµâ‚ Âµâ‚‚ m}
  --     (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m)
  --     (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚)
  --   â†’ ((Ï• â†‘ m) Â·â‚– â¦… x/t â¦†) ~ (Ï• ,â‚– x/t)
  -- â†‘âˆ˜â¦…â¦†-is-,â‚– â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} {m} x/t Ï• =
  --     ((Ï• â†‘ m) Â·â‚– â¦… x/t â¦†)     ~âŸ¨ {!!} âŸ©
  --     ((Ï• â†‘ m) Â·â‚– (id ,â‚– x/t)) ~âŸ¨ {!!} âŸ©
  --     (Ï• ,â‚– x/t)               ~âˆ

  -- -- â†‘âˆ˜â¦…â¦†-is-,â‚› : âˆ€ {Âµâ‚ Âµâ‚‚ m} (t : Âµâ‚‚ âŠ¢ mâ†’M m) (Ïƒ : Âµâ‚ â†’â‚› Âµâ‚‚) â†’
  -- --   â¦… t â¦†â‚› â‚›âˆ˜â‚› (Ïƒ â†‘ m) ~ Ïƒ ,â‚› t
  -- -- â†‘âˆ˜â¦…â¦†-is-,â‚› t Ïƒ _ (here refl) = â‹¯-var (here refl) â¦… t â¦†
  -- -- â†‘âˆ˜â¦…â¦†-is-,â‚› t Ïƒ _ (there x)   = wk-cancels-â¦…â¦†â‚› (Ïƒ _ x) t

  -- â†‘âˆ˜â¦…â¦†-is-,â‚› :
  --   âˆ€ {Âµâ‚ Âµâ‚‚ m}
  --     (t : Âµâ‚‚ âŠ¢ mâ†’M m)
  --     (Ï• : Âµâ‚ â†’â‚› Âµâ‚‚)
  --   â†’ ((Ï• â†‘ m) Â·â‚– â¦… t â¦†) ~ (Ï• ,â‚– t)
  -- â†‘âˆ˜â¦…â¦†-is-,â‚› = â†‘âˆ˜â¦…â¦†-is-,â‚–

  -- â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚– :
  --   âˆ€ â¦ƒ ğ•‚ â¦„ â¦ƒ C : ComposeKit ğ•‚ ğ•‚ ğ•‚ â¦„ {Âµâ‚ Âµâ‚‚ m}
  --     (t : (Âµâ‚ â–· m) âŠ¢ M)
  --     (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m)
  --     (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚)
  --   â†’ t â‹¯ (Ï• â†‘ m) â‹¯ â¦… x/t â¦† â‰¡ t â‹¯ (Ï• ,â‚– x/t)
  -- â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚– {m = m} t x/t Ï• =
  --   t â‹¯ (Ï• â†‘ m) â‹¯ â¦… x/t â¦†    â‰¡âŸ¨ â‹¯-assoc t (Ï• â†‘ m) â¦… x/t â¦† âŸ©
  --   t â‹¯ ((Ï• â†‘ m) Â·â‚– â¦… x/t â¦†) â‰¡âŸ¨ ~-cong-â‹¯ t (â†‘âˆ˜â¦…â¦†-is-,â‚– x/t Ï•) âŸ©
  --   t â‹¯ (Ï• ,â‚– x/t)           âˆ

  -- â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚› :
  --   âˆ€ {Âµâ‚ Âµâ‚‚ m}
  --     (t : (Âµâ‚ â–· m) âŠ¢ M)
  --     (t' : Âµâ‚‚ âŠ¢ mâ†’M m)
  --     (Ï• : Âµâ‚ â†’â‚› Âµâ‚‚)
  --   â†’ t â‹¯ (Ï• â†‘ m) â‹¯ â¦… t' â¦† â‰¡ t â‹¯ (Ï• ,â‚– t')
  -- â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚› = â‹¯â†‘â‹¯â¦…â¦†-is-â‹¯,â‚–
