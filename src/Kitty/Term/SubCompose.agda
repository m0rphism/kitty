open import Kitty.Term.Modes
open import Kitty.Term.Traversal using (Traversal)
open import Kitty.Term.KitHomotopy using (KitHomotopy)
open import Kitty.Term.Sub using (SubWithLaws)

module Kitty.Term.SubCompose
    {ğ•„ : Modes}
    {ğ•‹ : Terms ğ•„}
    {â„“} {ğ•Š : SubWithLaws ğ•‹ â„“}
    {T : Traversal ğ•‹ ğ•Š}
    (H : KitHomotopy T)
  where

open import Data.List.Properties using (++-assoc; ++-identityÊ³)
open import Data.List.Relation.Unary.Any using (here; there)
open import Data.Product using (âˆƒ-syntax; Î£-syntax; _,_; _Ã—_)
open import Level using () renaming (suc to lsuc)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; trans; sym; subst; substâ‚‚; cong; module â‰¡-Reasoning)
open â‰¡-Reasoning

open import Kitty.Term.ComposeKit H
open import Kitty.Term.Kit ğ•‹
open import Kitty.Term.KitOrder ğ•‹
open import Kitty.Term.KitT T
open import Kitty.Term.Prelude
open import Kitty.Term.Sub ğ•‹
open import Kitty.Util.SubstProperties
open ComposeKit â¦ƒ â€¦ â¦„
open Kit â¦ƒ â€¦ â¦„
open Kitty.Term.Sub.SubWithLaws ğ•Š
open Modes ğ•„
open Sub SubWithLaws-Sub
open Terms ğ•‹
open Traversal T
open _âŠ‘â‚–_ â¦ƒ â€¦ â¦„
open ~-Reasoning

record SubCompose : Set (lsuc â„“) where
  infixl  9  _Â·â‚–_
  infixr  9  _âˆ˜â‚–_

  field
    _Â·â‚–_ :
      âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
        {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
        {M}  {_âˆ‹/âŠ¢_ : Scoped M}  â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
        â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚ Âµâ‚‚ Âµâ‚ƒ}
      â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
      â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
      â†’ Âµâ‚ â€“[ ğ•‚  ]â†’ Âµâ‚ƒ

    &-Â·â‚–-&/â‹¯ :
      âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
        {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
        {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
        â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m}
        (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
        (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
        (x : Âµâ‚ âˆ‹ m)
      â†’ x & (Ï•â‚ Â·â‚– Ï•â‚‚) â‰¡ (x & Ï•â‚) &/â‹¯ Ï•â‚‚

  -- TODO: This can be more heterogeneous.
  ~-cong-Â· :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
      {Ï•â‚ Ï•â‚' : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚}
      {Ï•â‚‚ Ï•â‚‚' : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ}
    â†’ Ï•â‚ ~ Ï•â‚'
    â†’ Ï•â‚‚ ~ Ï•â‚‚'
    â†’ (Ï•â‚ Â·â‚– Ï•â‚‚) ~ (Ï•â‚' Â·â‚– Ï•â‚‚')
  ~-cong-Â· â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {Ï•â‚} {Ï•â‚'} {Ï•â‚‚} {Ï•â‚‚'} Ï•â‚~Ï•â‚' Ï•â‚‚~Ï•â‚‚' = mk-~ Î» m x â†’
    `/id (x & (Ï•â‚  Â·â‚– Ï•â‚‚ )) â‰¡âŸ¨ cong `/id (&-Â·â‚–-&/â‹¯ Ï•â‚ Ï•â‚‚ x) âŸ©
    `/id (x & Ï•â‚  &/â‹¯ Ï•â‚‚ )  â‰¡âŸ¨ cong `/id (~-cong-&/â‹¯ (use-~-hom Ï•â‚~Ï•â‚' _ x) Ï•â‚‚~Ï•â‚‚') âŸ©
    `/id (x & Ï•â‚' &/â‹¯ Ï•â‚‚')  â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ Ï•â‚' Ï•â‚‚' x)) âŸ©
    `/id (x & (Ï•â‚' Â·â‚– Ï•â‚‚')) âˆ

  -- This is used to prove the variable case of â‹¯-assoc.
  tm-â‹¯-Â· :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m}
      (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
      (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
      (x : Âµâ‚ âˆ‹ m)
    â†’ `/id (x & Ï•â‚) â‹¯ Ï•â‚‚ â‰¡ `/id (x & (Ï•â‚ Â·â‚– Ï•â‚‚))
  tm-â‹¯-Â· â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} {m} Ï•â‚ Ï•â‚‚ x =
    `/id (x & Ï•â‚) â‹¯ Ï•â‚‚    â‰¡âŸ¨ sym (&/â‹¯-â‹¯ (x & Ï•â‚) Ï•â‚‚) âŸ©
    `/id (x & Ï•â‚ &/â‹¯ Ï•â‚‚)  â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ Ï•â‚ Ï•â‚‚ x)) âŸ©
    `/id (x & (Ï•â‚ Â·â‚– Ï•â‚‚)) âˆ

  dist-â†‘-Â· :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m
      (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
      (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m) ~ ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m))
  dist-â†‘-Â· â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} m Ï•â‚ Ï•â‚‚ = mk-~ Î» where
    mx x@(here refl) â†’
      `/id â¦ƒ ğ•‚ â¦„ (x & ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m))          â‰¡âŸ¨ cong `/id (&-â†‘-here (Ï•â‚ Â·â‚– Ï•â‚‚)) âŸ©
      `/id â¦ƒ ğ•‚ â¦„ (id/` (here refl))              â‰¡âŸ¨ id/`/id â¦ƒ ğ•‚ â¦„ (here refl) âŸ©
      ` here refl                                â‰¡âŸ¨ sym (id/`/id â¦ƒ ğ•‚â‚‚ â¦„ (here refl)) âŸ©
      `/id â¦ƒ ğ•‚â‚‚ â¦„ (id/` (here refl))             â‰¡âŸ¨ Î¹-`/id (id/` (here refl)) âŸ©
      `/id â¦ƒ ğ•‚ â¦„ (Î¹-âˆ‹/âŠ¢ (id/` â¦ƒ ğ•‚â‚‚ â¦„ (here refl)))      â‰¡âŸ¨ cong (Î» â–  â†’ `/id (Î¹-âˆ‹/âŠ¢ â– )) (sym (&-â†‘-here Ï•â‚‚)) âŸ©
      `/id â¦ƒ ğ•‚ â¦„ (Î¹-âˆ‹/âŠ¢ (here refl & (Ï•â‚‚ â†‘ m)))  â‰¡âŸ¨ cong `/id (sym (&/â‹¯-& (here refl) (Ï•â‚‚ â†‘ m))) âŸ©
      `/id â¦ƒ ğ•‚ â¦„ (id/` (here refl) &/â‹¯ (Ï•â‚‚ â†‘ m)) â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯ Ï•â‚‚ â†‘ m)) (sym (&-â†‘-here Ï•â‚)) âŸ©
      `/id â¦ƒ ğ•‚ â¦„ (x & (Ï•â‚ â†‘ m) &/â‹¯ (Ï•â‚‚ â†‘ m))     â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ (Ï•â‚ â†‘ m) (Ï•â‚‚ â†‘ m) x)) âŸ©
      `/id â¦ƒ ğ•‚ â¦„ (x & ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m)))    âˆ
    mx x@(there y) â†’
      `/id (x & ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘ m))          â‰¡âŸ¨ cong `/id (&-â†‘-there (Ï•â‚ Â·â‚– Ï•â‚‚) y) âŸ©
      `/id (wk _ (y & (Ï•â‚ Â·â‚– Ï•â‚‚)))         â‰¡âŸ¨ cong (Î» â–  â†’ `/id (wk _ â– )) (&-Â·â‚–-&/â‹¯ Ï•â‚ Ï•â‚‚ y) âŸ©
      `/id (wk _ (y & Ï•â‚ &/â‹¯ Ï•â‚‚))          â‰¡âŸ¨ cong `/id (&/â‹¯-wk-â†‘ (y & Ï•â‚) Ï•â‚‚) âŸ©
      `/id (wk _ (y & Ï•â‚) &/â‹¯ (Ï•â‚‚ â†‘ m))    â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯ (Ï•â‚‚ â†‘ m))) (sym (&-â†‘-there Ï•â‚ y)) âŸ©
      `/id (x & (Ï•â‚ â†‘ m) &/â‹¯ (Ï•â‚‚ â†‘ m))     â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ (Ï•â‚ â†‘ m) (Ï•â‚‚ â†‘ m) x)) âŸ©
      `/id (x & ((Ï•â‚ â†‘ m) Â·â‚– (Ï•â‚‚ â†‘ m)))    âˆ

  dist-â†‘*-Â· :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚ Âµâ‚‚ Âµâ‚ƒ}
      Âµ (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
    â†’ ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* Âµ) ~ ((Ï•â‚ â†‘* Âµ) Â·â‚– (Ï•â‚‚ â†‘* Âµ))
  dist-â†‘*-Â· []      Ï•â‚ Ï•â‚‚ =
    ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* [])                  ~âŸ¨ â†‘*-[] (Ï•â‚ Â·â‚– Ï•â‚‚) âŸ©
    Ï•â‚ Â·â‚– Ï•â‚‚                            ~âŸ¨ ~-sym (~-cong-Â· (â†‘*-[] Ï•â‚) (â†‘*-[] Ï•â‚‚)) âŸ©
    ((Ï•â‚ â†‘* []) Â·â‚– (Ï•â‚‚ â†‘* []))          ~âˆ
  dist-â†‘*-Â· (Âµ â–· m) Ï•â‚ Ï•â‚‚ =
    (Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* (Âµ â–· m)               ~âŸ¨ â†‘*-â–· Âµ m (Ï•â‚ Â·â‚– Ï•â‚‚) âŸ©
    ((Ï•â‚ Â·â‚– Ï•â‚‚) â†‘* Âµ) â†‘ m               ~âŸ¨ ~-cong-â†‘' (dist-â†‘*-Â· Âµ Ï•â‚ Ï•â‚‚) âŸ©
    ((Ï•â‚ â†‘* Âµ) Â·â‚– (Ï•â‚‚ â†‘* Âµ)) â†‘ m        ~âŸ¨ dist-â†‘-Â· m (Ï•â‚ â†‘* Âµ) (Ï•â‚‚ â†‘* Âµ) âŸ©
    ((Ï•â‚ â†‘* Âµ) â†‘ m) Â·â‚– ((Ï•â‚‚ â†‘* Âµ) â†‘ m)  ~âŸ¨ ~-sym (~-cong-Â· (â†‘*-â–· Âµ m Ï•â‚) (â†‘*-â–· Âµ m Ï•â‚‚)) âŸ©
    (Ï•â‚ â†‘* (Âµ â–· m)) Â·â‚– (Ï•â‚‚ â†‘* (Âµ â–· m))  ~âˆ

  -- dist-,â‚–-Â· : âˆ€ {m}
  --               (Ï•â‚ : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
  --               (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ)
  --               (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚ ] id/mâ†’M m)
  --             â†’ let sub = subst (Âµâ‚ƒ âˆ‹/âŠ¢[ ğ•‚â‚âŠ” ğ•‚â‚‚ ]_) (Î¹-id/mâ†’M m) in
  --               ((Ï•â‚ Â·â‚– Ï•â‚‚) ,â‚– sub (x/t &/â‹¯ Ï•â‚‚)) ~ (Ï•â‚ ,â‚– x/t Â·â‚– Ï•â‚‚)

  _âˆ˜â‚–_ :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
    â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
    â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
    â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚ƒ
  Ï•â‚‚ âˆ˜â‚– Ï•â‚ = Ï•â‚ Â·â‚– Ï•â‚‚

  infixl  9  _Â·[_]_
  infixr  9  _âˆ˜[_]_

  _Â·[_]_ :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
    â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
    â†’ ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚
    â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
    â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚ƒ
  Ï•â‚ Â·[ C ] Ï•â‚‚ = _Â·â‚–_ â¦ƒ C = C â¦„ Ï•â‚ Ï•â‚‚


  _âˆ˜[_]_ :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ}
    â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
    â†’ ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚
    â†’ Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚
    â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚ƒ
  Ï•â‚‚ âˆ˜[ C ] Ï•â‚ = _âˆ˜â‚–_ â¦ƒ C = C â¦„ Ï•â‚‚ Ï•â‚

  Â·-idÊ³ :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      {Âµâ‚} {Âµâ‚‚} (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    â†’ (Ï• Â·â‚– id â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„) ~ Ï•
  Â·-idÊ³ â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} Ï• = mk-~ Î» mx x â†’
    `/id (x & (Ï• Â·â‚– id â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„)) â‰¡âŸ¨ cong (`/id) (&-Â·â‚–-&/â‹¯ Ï• id x) âŸ©
    `/id (x & Ï• &/â‹¯ id â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„)  â‰¡âŸ¨ &/â‹¯-â‹¯ (x & Ï•) id âŸ©
    `/id (x & Ï•) â‹¯ id â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„    â‰¡âŸ¨ â‹¯-id (`/id (x & Ï•)) âŸ©
    `/id (x & Ï•)                    âˆ

  Â·-idË¡ :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚)
    â†’ (id â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ Â·â‚– Ï•) ~ Ï•
  Â·-idË¡ â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} Ï• = mk-~ Î» mx x â†’
    `/id (x & (id â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ Â·â‚– Ï•))   â‰¡âŸ¨ cong (`/id) (&-Â·â‚–-&/â‹¯ id Ï• x) âŸ©
    `/id (x & id â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ &/â‹¯ Ï•)    â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯ Ï•)) (&-id â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ x) âŸ©
    `/id (id/` x &/â‹¯ Ï•)               â‰¡âŸ¨ cong (`/id) (&/â‹¯-& x Ï•) âŸ©
    `/id (Î¹-âˆ‹/âŠ¢ â¦ƒ ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦„ (x & Ï•)) â‰¡âŸ¨ sym (Î¹-`/id (x & Ï•)) âŸ©
    `/id (x & Ï•)                      âˆ

  -- Alternative route:
    -- (wkâ‚– _ id Â·â‚– (Ï• ,â‚– x/t)) ~ (wkâ‚– _ (Ï• ,â‚– x/t)) ~ Ï•
  -- From which then follows:
    -- wkâ‚– _ Ï• Â· â¦… x/t â¦† ~
    -- wkâ‚– _ id Â· Ï• Â· â¦… x/t â¦† ~
    -- Ï• Â· wkâ‚– _ id Â· â¦… x/t â¦† ~
    -- Ï• Â· id ~
    -- Ï•
  wk-cancels-,â‚–-Â· :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m}
      (Ï• : Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) (x/t : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚â‚‚ ] id/mâ†’M m)
    â†’ (wkâ‚– _ id Â·â‚– (Ï• ,â‚– x/t)) ~ Ï•
  wk-cancels-,â‚–-Â· â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} {m} Ï• x/t = mk-~ Î» mx x â†’
    `/id (x & (wkâ‚– _ id Â·â‚– (Ï• ,â‚– x/t)))  â‰¡âŸ¨ cong (`/id) (&-Â·â‚–-&/â‹¯ (wkâ‚– _ id) (Ï• ,â‚– x/t) x) âŸ©
    `/id (x & wkâ‚– _ id &/â‹¯ (Ï• ,â‚– x/t))   â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯[ C ] (Ï• ,â‚– x/t))) (&-wkâ‚–-wk id x) âŸ©
    `/id (wk _ (x & id) &/â‹¯ (Ï• ,â‚– x/t))  â‰¡âŸ¨ cong (Î» â–  â†’ `/id (wk â¦ƒ ğ•‚â‚ â¦„ _ â–  &/â‹¯ (Ï• ,â‚– x/t))) (&-id x) âŸ©
    `/id (wk _ (id/` x) &/â‹¯ (Ï• ,â‚– x/t))  â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯[ C ] (Ï• ,â‚– x/t))) (wk-id/` _ x) âŸ©
    `/id (id/` (there x) &/â‹¯ (Ï• ,â‚– x/t)) â‰¡âŸ¨ cong `/id (&/â‹¯-& (there x) (Ï• ,â‚– x/t)) âŸ©
    `/id (Î¹-âˆ‹/âŠ¢ (there x & (Ï• ,â‚– x/t)))  â‰¡âŸ¨ cong (Î» â–  â†’ `/id (Î¹-âˆ‹/âŠ¢ â– )) (&-,â‚–-there Ï• x/t x) âŸ©
    `/id (Î¹-âˆ‹/âŠ¢ (x & Ï•))                 â‰¡âŸ¨ cong `/id (sym (&-Î¹-â†’ Ï• x)) âŸ©
    `/id (x & (Î¹-â†’ Ï•))                   â‰¡âŸ¨ use-~ (~-Î¹-â†’ Ï•) _ x âŸ©
    `/id (x & Ï•)                         âˆ

  wk-Ï•-id :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„
      â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
      {Âµâ‚} {Âµâ‚‚} {m}
      (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚)
    â†’ wkâ‚– m Ï• ~ (Ï• Â·â‚– wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ m id)
  wk-Ï•-id â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ â¦ƒ W â¦„ {Âµâ‚} {Âµâ‚‚} {m} Ï• = mk-~ Î» mx x â†’
    `/id (x & wkâ‚– m Ï•)                    â‰¡âŸ¨ cong `/id (&-wkâ‚–-wk Ï• x) âŸ©
    `/id (wk m (x & Ï•))                   â‰¡âŸ¨ Î¹-`/id (wk m (x & Ï•)) âŸ©
    `/id (Î¹-âˆ‹/âŠ¢ (wk m (x & Ï•)))           â‰¡âŸ¨ cong `/id (sym (&/â‹¯-wk (x & Ï•))) âŸ©
    `/id (x & Ï• &/â‹¯ wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ m id)  â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯ Ï• (wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ m id) x)) âŸ©
    `/id (x & (Ï• Â·â‚– wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚‚ â¦„ m id)) âˆ

  â†‘-wk :
    âˆ€ {Mâ‚} {_âˆ‹/âŠ¢â‚_ : Scoped Mâ‚} â¦ƒ ğ•‚â‚ : Kit _âˆ‹/âŠ¢â‚_ â¦„
      {Mâ‚‚} {_âˆ‹/âŠ¢â‚‚_ : Scoped Mâ‚‚} â¦ƒ ğ•‚â‚‚ : Kit _âˆ‹/âŠ¢â‚‚_ â¦„
      {M}  {_âˆ‹/âŠ¢_ : Scoped M}   â¦ƒ ğ•‚ : Kit _âˆ‹/âŠ¢_ â¦„
      â¦ƒ Câ‚ : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„
      â¦ƒ Câ‚‚ : ComposeKit ğ•‚â‚‚ ğ•‚â‚ ğ•‚ â¦„
      â¦ƒ Wâ‚ : KitT ğ•‚â‚ â¦„
      â¦ƒ Wâ‚‚ : KitT ğ•‚â‚‚ â¦„
      {Âµâ‚} {Âµâ‚‚} (Ï• : Âµâ‚ â€“[ ğ•‚â‚ ]â†’ Âµâ‚‚) m
    â†’ (Ï• Â·[ Câ‚ ] wkâ‚– m id) ~ (wkâ‚– m id Â·[ Câ‚‚ ] (Ï• â†‘ m))
  â†‘-wk â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ Câ‚ â¦„ â¦ƒ Câ‚‚ â¦„ {Âµâ‚} {Âµâ‚‚} Ï• m =
      (Ï• Â·[ Câ‚ ] wkâ‚– m id)                             ~âŸ¨ ~-sym (wk-Ï•-id Ï•) âŸ©
      wkâ‚– m Ï•                                          ~âŸ¨ ~-sym (wk-cancels-,â‚–-Â· (wkâ‚– m Ï•) (id/` (here refl))) âŸ©
      (wkâ‚– m id Â·[ Câ‚‚ ] (wkâ‚– m Ï• ,â‚– id/` (here refl))) ~âŸ¨ ~-cong-Â· ~-refl (~-sym (â†‘-,â‚– Ï• m)) âŸ©
      (wkâ‚– m id Â·[ Câ‚‚ ] (Ï• â†‘ m))                       ~âˆ

  -- wk-â†“ :
  --   âˆ€ â¦ƒ ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ â¦ƒ C : ComposeKit ğ•‚â‚ ğ•‚â‚‚ ğ•‚ â¦„ {Âµâ‚ Âµâ‚‚ mâ‚} (Ï• : (Âµâ‚ â–· mâ‚) â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚‚) â†’
  --   wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ mâ‚ id Â·â‚– Ï• ~ Ï• â†“
  -- wk-â†“ â¦ƒ ğ•‚â‚ â¦„ â¦ƒ ğ•‚â‚‚ â¦„ â¦ƒ ğ•‚ â¦„ â¦ƒ C â¦„ {Âµâ‚} {Âµâ‚‚} {mâ‚} Ï• m x =
  --   Kit.`/id ğ•‚ (x & (wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ mâ‚ id Â·â‚– Ï•))            â‰¡âŸ¨ cong (Kit.`/id ğ•‚) (&-Â·â‚–-&/â‹¯ (wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ mâ‚ id) Ï• x) âŸ©
  --   Kit.`/id ğ•‚ (x & wkâ‚– â¦ƒ ğ•‚ = ğ•‚â‚ â¦„ mâ‚ id &/â‹¯[ C ] Ï•)        â‰¡âŸ¨ cong (Î» â–  â†’ Kit.`/id ğ•‚ (â–  &/â‹¯[ C ] Ï•))
  --                                                                    (&-wkâ‚–-wk id x) âŸ©
  --   Kit.`/id ğ•‚ (Kit.wk ğ•‚â‚ _ (x & id â¦ƒ ğ•‚ = ğ•‚â‚ â¦„) &/â‹¯[ C ] Ï•) â‰¡âŸ¨ cong (Î» â–  â†’ Kit.`/id ğ•‚ (Kit.wk ğ•‚â‚ _ â–  &/â‹¯[ C ] Ï•))
  --                                                                       (&-id x) âŸ©
  --   Kit.`/id ğ•‚ (Kit.wk ğ•‚â‚ _ (Kit.id/` ğ•‚â‚ x) &/â‹¯[ C ] Ï•)     â‰¡âŸ¨ cong (Î» â–  â†’ Kit.`/id ğ•‚ (â–  &/â‹¯[ C ] Ï•))
  --                                                                      (Kit.wk-id/` ğ•‚â‚ _ x) âŸ©
  --   Kit.`/id ğ•‚ (Kit.id/` ğ•‚â‚ (there x) &/â‹¯[ C ] Ï•)           â‰¡âŸ¨ cong (Kit.`/id ğ•‚) (&/â‹¯-& (there x) Ï•) âŸ©
  --   Kit.`/id ğ•‚ (Î¹-âˆ‹/âŠ¢ â¦ƒ ğ•‚â‚‚âŠ‘ğ•‚â‚âŠ”ğ•‚â‚‚ â¦ƒ C â¦„ â¦„ (there x & Ï•))     â‰¡âŸ¨ sym (Î¹-`/id (there x & Ï•)) âŸ©
  --   Kit.`/id ğ•‚â‚‚ (there x & Ï•)                               â‰¡âŸ¨ sym (cong (Kit.`/id ğ•‚â‚‚) (&-â†“ Ï• x)) âŸ©
  --   Kit.`/id ğ•‚â‚‚ (x & (Ï• â†“))                                 âˆ

  -- -- TODO: Move to different file
  -- module _ where
  --   private instance _ = kitáµ£; _ = ckitáµ£

  --   subst-here : âˆ€ {Âµâ‚ Âµâ‚‚ : List VarMode} {m} (p : Âµâ‚ â–· m â‰¡ Âµâ‚‚ â–· m) â†’
  --     subst (_âˆ‹ m) p (here {x = m} {xs = Âµâ‚} refl) â‰¡ here refl
  --   subst-here refl = refl

  --   dist-subst-sub : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚ Âµâ‚' Âµâ‚‚ Âµâ‚‚' m} â†’
  --     (p : Âµâ‚ â‰¡ Âµâ‚') â†’
  --     (q : Âµâ‚‚ â‰¡ Âµâ‚‚') â†’
  --     (x : Âµâ‚' âˆ‹ m) â†’
  --     (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) â†’
  --     let subâ‚â‚‚ = substâ‚‚ (_â€“[ ğ•‚ ]â†’_) p q in
  --     let subâ‚â»Â¹ = subst (_âˆ‹ m) (sym p) in
  --     let subâ‚‚ = subst (_âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m) q in
  --     x & subâ‚â‚‚ Ï• â‰¡ subâ‚‚ (subâ‚â»Â¹ x & Ï•)
  --   dist-subst-sub refl refl x Ï• = refl

  --   dist-subst-sub' : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚ Âµâ‚' Âµâ‚‚ Âµâ‚‚' M} â†’
  --     (p : Âµâ‚ â‰¡ Âµâ‚') â†’
  --     (q : Âµâ‚‚ â‰¡ Âµâ‚‚') â†’
  --     (t : Âµâ‚' âŠ¢ M) â†’
  --     (Ï• : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚) â†’
  --     let subâ‚â‚‚ = substâ‚‚ (_â€“[ ğ•‚ ]â†’_) p q in
  --     let subâ‚â»Â¹ = subst (_âŠ¢ M) (sym p) in
  --     let subâ‚‚ = subst (_âŠ¢ M) q in
  --     t â‹¯ subâ‚â‚‚ Ï• â‰¡ subâ‚‚ (subâ‚â»Â¹ t â‹¯ Ï•)
  --   dist-subst-sub' refl refl x Ï• = refl

  --   -- NOTE: the &/â‹¯[ C ] can be replaced by &.
  --   wk*-âˆ¥â‚ :
  --     âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚ Âµâ‚‚ Âµ} (Ï•â‚ : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµ) (Ï•â‚‚ : Âµâ‚‚ â€“[ ğ•‚ ]â†’ Âµ) â†’
  --     let sub = substâ‚‚ (_â†’áµ£_) (++-identityÊ³ Âµâ‚‚) (cong (_â–·â–· Âµâ‚‚) (++-identityÊ³ Âµâ‚)) in
  --     sub (wkâ‚–* Âµâ‚ (id {Âµ = []}) â†‘* Âµâ‚‚) Â·[ ckitáµ£ ] (Ï•â‚ âˆ¥ Ï•â‚‚) ~ Ï•â‚‚
  --   wk*-âˆ¥â‚ â¦ƒ ğ•‚ â¦„ {Âµâ‚ = Âµâ‚} {Âµâ‚‚ â–· mâ‚‚} {Âµ} Ï•â‚ Ï•â‚‚ m x@(here refl) =
  --     let C = ckitáµ£ in
  --     let sub = substâ‚‚ _â†’áµ£_ (cong (_â–· mâ‚‚) (++-identityÊ³ Âµâ‚‚)) (cong (_â–·â–· (Âµâ‚‚ â–· mâ‚‚)) (++-identityÊ³ Âµâ‚)) in
  --     let subx = subst (_âˆ‹ mâ‚‚) (cong (_â–·â–· (Âµâ‚‚ â–· mâ‚‚)) (++-identityÊ³ Âµâ‚)) in
  --     let suby = subst (_âˆ‹ mâ‚‚) (sym (cong (_â–· mâ‚‚) (++-identityÊ³ Âµâ‚‚))) in
  --     `/id (x & sub (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚)) Â·[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))             â‰¡âŸ¨ cong `/id (&-Â·â‚–-&/â‹¯ (sub (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚)))
  --                                                                                                  (Ï•â‚ âˆ¥ Ï•â‚‚) x) âŸ©
  --     `/id (x & sub (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))           â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                                   (dist-subst-sub _ _ x
  --                                                                                     (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚))) âŸ©
  --     `/id (subx (suby x & wkâ‚–* Âµâ‚ idáµ£ â†‘* (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))    â‰¡âŸ¨ cong
  --                                                                               (Î» â–  â†’ `/id (subx (â–  & wkâ‚–* Âµâ‚ idáµ£ â†‘* (Âµâ‚‚ â–· mâ‚‚))
  --                                                                                             &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                             (subst-here _) âŸ©
  --     `/id (subx (here refl & wkâ‚–* Âµâ‚ idáµ£ â†‘* (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚)) â‰¡âŸ¨ cong (Î» â–  â†’ `/id (subx â–  &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                                   (~â†’~' (â†‘*-â–· Âµâ‚‚ mâ‚‚ (wkâ‚–* Âµâ‚ id)) _ (here refl)) âŸ©
  --     `/id (subx (here refl & wkâ‚–* Âµâ‚ id â†‘* Âµâ‚‚ â†‘ mâ‚‚) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))    â‰¡âŸ¨ cong (Î» â–  â†’ `/id (subx â–  &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                                   (&-â†‘-here (wkâ‚–* Âµâ‚ id â†‘* Âµâ‚‚)) âŸ©
  --     `/id (subx (id/` (here refl)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))                     â‰¡âŸ¨ refl âŸ©
  --     `/id (subx (here refl) & (Ï•â‚ âˆ¥ Ï•â‚‚))                                   â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  & (Ï•â‚ âˆ¥ Ï•â‚‚))) (subst-here _) âŸ©
  --     `/id (here refl & (Ï•â‚ âˆ¥ Ï•â‚‚))                                          â‰¡âŸ¨ cong (Î» â–  â†’ `/id â– )
  --                                                                                   (~â†’~' (âˆ¥-â–· Ï•â‚ Ï•â‚‚) _ (here refl)) âŸ©
  --     `/id (here refl & ((Ï•â‚ âˆ¥ Ï•â‚‚ â†“) ,â‚– (here refl & Ï•â‚‚)))                  â‰¡âŸ¨ cong (Î» â–  â†’ `/id  â– )
  --                                                                                   (&-,â‚–-here (Ï•â‚ âˆ¥ Ï•â‚‚ â†“) (here refl & Ï•â‚‚)) âŸ©
  --     `/id (here refl & Ï•â‚‚)                                                 â‰¡âŸ¨ refl âŸ©
  --     `/id (x & Ï•â‚‚)                                                         âˆ
  --   wk*-âˆ¥â‚ {Âµâ‚ = Âµâ‚} {Âµâ‚‚ â–· mâ‚‚} {Âµ} Ï•â‚ Ï•â‚‚ m x@(there y) =
  --     let C = ckitáµ£ in
  --     let sub = substâ‚‚ _â†’áµ£_ (cong (_â–· mâ‚‚) (++-identityÊ³ Âµâ‚‚)) (cong (_â–·â–· (Âµâ‚‚ â–· mâ‚‚)) (++-identityÊ³ Âµâ‚)) in
  --     let sub' = substâ‚‚ _â†’áµ£_ (++-identityÊ³ Âµâ‚‚) (cong (_â–·â–· Âµâ‚‚) (++-identityÊ³ Âµâ‚)) in
  --     let subx = subst (_âˆ‹ m) (cong (_â–·â–· (Âµâ‚‚ â–· mâ‚‚)) (++-identityÊ³ Âµâ‚)) in
  --     let subx' = subst (_âˆ‹ m) (cong (_â–·â–· Âµâ‚‚) (++-identityÊ³ Âµâ‚)) in
  --     let suby = subst (_âˆ‹ m) (sym (cong (_â–· mâ‚‚) (++-identityÊ³ Âµâ‚‚))) in
  --     let suby' = subst (_âˆ‹ m) (sym (++-identityÊ³ Âµâ‚‚)) in
  --     `/id (x & sub (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚)) Â·[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))                   â‰¡âŸ¨ cong `/id
  --                                                                                         (&-Â·â‚–-&/â‹¯ (sub (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚)))
  --                                                                                                   (Ï•â‚ âˆ¥ Ï•â‚‚) x) âŸ©
  --     `/id (x & sub (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))                 â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚)))
  --                                                                                         (dist-subst-sub _ _ x
  --                                                                                           (wkâ‚–* Âµâ‚ id â†‘* (Âµâ‚‚ â–· mâ‚‚))) âŸ©
  --     `/id (subx (suby (there y) & wkâ‚–* Âµâ‚ idáµ£ â†‘* (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))  â‰¡âŸ¨ cong
  --                                                                                      (Î» â–  â†’ `/id (subx (â–  & wkâ‚–* Âµâ‚ idáµ£ â†‘*
  --                                                                                                    (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                                      (sym (dist-subst' (Î» Âµ â†’ Âµ â–· mâ‚‚) there
  --                                                                                        (sym (++-identityÊ³ Âµâ‚‚))
  --                                                                                        (sym (cong (_â–· mâ‚‚) (++-identityÊ³ Âµâ‚‚)))
  --                                                                                        y)) âŸ©
  --     `/id (subx (there (suby' y) & wkâ‚–* Âµâ‚ idáµ£ â†‘* (Âµâ‚‚ â–· mâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚)) â‰¡âŸ¨ cong (Î» â–  â†’ `/id (subx â–  &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                                         (~â†’~' (â†‘*-â–· Âµâ‚‚ mâ‚‚ _) _ (there (suby' y))) âŸ©
  --     `/id (subx (there (suby' y) & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚ â†‘ mâ‚‚) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))   â‰¡âŸ¨ cong (Î» â–  â†’ `/id (subx â–  &/â‹¯[ C ] Ï•â‚ âˆ¥ Ï•â‚‚))
  --                                                                                         (&-â†‘-there (wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚) (suby' y)) âŸ©
  --     `/id (subx (wk _ (suby' y & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚)) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚))         â‰¡âŸ¨ cong (Î» â–  â†’ `/id â– )
  --                                                                                    (~â†’~' (âˆ¥-â–· Ï•â‚ Ï•â‚‚) _ _) âŸ©
  --     `/id (subx (wk _ (suby' y & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚)) &/â‹¯[ C ] ((Ï•â‚ âˆ¥ Ï•â‚‚ â†“) ,â‚– (here refl & Ï•â‚‚))) â‰¡âŸ¨ refl âŸ©
  --     `/id (subx (there (suby' y & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚)) &/â‹¯[ C ] ((Ï•â‚ âˆ¥ Ï•â‚‚ â†“) ,â‚– (here refl & Ï•â‚‚))) â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯[ C ] (Ï•â‚ âˆ¥ (Ï•â‚‚ â†“)) ,â‚– (here refl & Ï•â‚‚)))
  --                                                                                    (sym (dist-subst' (Î» Âµ â†’ Âµ â–· mâ‚‚) there
  --                                                                                           (cong (_â–·â–· Âµâ‚‚) (++-identityÊ³ Âµâ‚))
  --                                                                                           (cong (_â–·â–· (Âµâ‚‚ â–· mâ‚‚)) (++-identityÊ³ Âµâ‚))
  --                                                                                           (suby' y & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚))) âŸ©
  --     `/id (there (subx' (suby' y & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚)) &/â‹¯[ C ] ((Ï•â‚ âˆ¥ Ï•â‚‚ â†“) ,â‚– (here refl & Ï•â‚‚))) â‰¡âŸ¨ cong `/id (&-,â‚–-there (Ï•â‚ âˆ¥ Ï•â‚‚ â†“) (here refl & Ï•â‚‚) _) âŸ©
  --     `/id (subx' (suby' y & wkâ‚–* Âµâ‚ idáµ£ â†‘* Âµâ‚‚) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚ â†“))             â‰¡âŸ¨ cong (Î» â–  â†’ `/id (â–  &/â‹¯[ C ] Ï•â‚ âˆ¥ (Ï•â‚‚ â†“)))
  --                                                                                         (sym (dist-subst-sub _ _ y
  --                                                                                           (wkâ‚–* Âµâ‚ id â†‘* Âµâ‚‚))) âŸ©
  --     `/id (y & sub' (wkâ‚–* Âµâ‚ id â†‘* Âµâ‚‚) &/â‹¯[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚ â†“))                     â‰¡âŸ¨ cong `/id (sym (&-Â·â‚–-&/â‹¯
  --                                                                                                     (sub' (wkâ‚–* Âµâ‚ id â†‘* Âµâ‚‚))
  --                                                                                                     (Ï•â‚ âˆ¥ Ï•â‚‚ â†“) y)) âŸ©
  --     `/id (y & sub' (wkâ‚–* Âµâ‚ id â†‘* Âµâ‚‚) Â·[ C ] (Ï•â‚ âˆ¥ Ï•â‚‚ â†“))                       â‰¡âŸ¨ wk*-âˆ¥â‚ Ï•â‚ (Ï•â‚‚ â†“) _ y âŸ©
  --     `/id (y & Ï•â‚‚ â†“)                                                             â‰¡âŸ¨ cong `/id (&-â†“ Ï•â‚‚ y) âŸ©
  --     `/id (x & Ï•â‚‚)                                                               âˆ

  -- -- Specializations for Renamings ------------------------------------------------

  -- infixl  9  _áµ£Â·_  _áµ£Â·áµ£_  _áµ£Â·â‚›_
  -- infixr  9  _âˆ˜áµ£_  _áµ£âˆ˜áµ£_  _â‚›âˆ˜áµ£_

  -- private instance _ = kitáµ£; _ = kitâ‚›; _ = ckitáµ£

  -- _áµ£Â·_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
  -- Ï áµ£Â· Ï• = Ï Â·â‚– Ï•

  -- _âˆ˜áµ£_ : âˆ€ â¦ƒ ğ•‚â‚‚ : Kit â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚â‚‚ ]â†’ Âµâ‚ƒ
  -- Ï•â‚‚ âˆ˜áµ£ Ï•â‚ = Ï•â‚ áµ£Â· Ï•â‚‚

  -- _áµ£Â·áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ
  -- _áµ£Â·â‚›_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  -- _áµ£âˆ˜áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚ƒ
  -- _â‚›âˆ˜áµ£_ : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚ƒ} â†’ Âµâ‚‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ â†’ Âµâ‚ â€“[ kitáµ£ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ kitâ‚› ]â†’ Âµâ‚ƒ
  -- _áµ£Â·áµ£_ = _áµ£Â·_
  -- _áµ£Â·â‚›_ = _áµ£Â·_
  -- _áµ£âˆ˜áµ£_ = _âˆ˜áµ£_
  -- _â‚›âˆ˜áµ£_ = _âˆ˜áµ£_

