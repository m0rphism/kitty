open import Kitty.Term.Modes
import Kitty.Term.Sub

module Kitty.Term.Sub.Solver {ğ•„ : Modes} (ğ•‹ : Terms ğ•„) (S : Kitty.Term.Sub.SubWithLaws ğ•‹) where

open import Data.List using (List; [])
open import Data.List.Properties using (++-assoc; ++-identityÊ³)
open import Level using (Level; _âŠ”_; 0â„“)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; trans; sym; subst; substâ‚‚; cong; module â‰¡-Reasoning)
open â‰¡-Reasoning
open import Data.List.Relation.Unary.Any using (here; there)
open import Kitty.Term.Prelude
open import Data.Product using (âˆƒ-syntax; Î£-syntax; _,_; _Ã—_; projâ‚; projâ‚‚)
open import Data.Sum using (injâ‚; injâ‚‚; _âŠ_)
open import Function using (_$_)

open Modes ğ•„
open Terms ğ•‹

open import Kitty.Term.Kit ğ•‹ hiding (_â€“[_]â†’_)
open import Kitty.Term.Sub ğ•‹

open Kit â¦ƒ â€¦ â¦„ using (VarMode/TermMode; _âˆ‹/âŠ¢_; id/mâ†’M; mâ†’M/id; id/mâ†’M/id; id/`; `/id; `/id'; id/`/id; id/`/id'; wk; wk-id/`; wk*)
open SubWithLaws S
open Sub SubWithLaws-Sub
open ~-Reasoning

data _â€“[_]â†’`_ : List VarMode â†’ Kit â†’ List VarMode â†’ Set where
  emb   : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚
  []â‚–`  : âˆ€ â¦ƒ ğ•‚ â¦„ â†’ [] â€“[ ğ•‚ ]â†’` []
  []*`  : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚‚} â†’ [] â€“[ ğ•‚ ]â†’` Âµâ‚‚
  _,â‚–`_ : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m â†’ (Âµâ‚ â–· m) â€“[ ğ•‚ ]â†’` Âµâ‚‚
  wkâ‚–`  : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} m â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` (Âµâ‚‚ â–· m)
  wkâ‚–*` : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚‚'} Âµ â†’ Âµâ‚‚' â‰¡ Âµâ‚‚ â–·â–· Âµ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚'

-- âˆ¥ is ,â‚–* so wk can be pushed under it
-- wk* (Ï•â‚ ,â‚–* Ï•â‚‚) â‰¡ wk* Ï• ,â‚–* wk* Ï•â‚‚
-- with id-wk* and âˆ¥-assoc we can bring (Ï•â‚ âˆ¥ â€¦ âˆ¥ Ï•â‚™) in the form (fâ‚ id-wk* âˆ¥ â€¦ âˆ¥ fâ‚™ id-wk*)

-- â†“ cancels ,â‚–
-- â†“ may get stuck at emb
-- â†“* can cancel âˆ¥, more precisely:
--   (Ï•â‚ âˆ¥ Ï•â‚‚) â†“ â‰¡ Ï•â‚ âˆ¥ Ï•â‚‚ â†“  if Ï•â‚‚ has Âµâ‚ â‰¢ []
--   (Ï•â‚ âˆ¥ Ï•â‚‚) â†“ â‰¡ Ï•â‚ â†“       otherwise
--   (Ï•â‚ âˆ¥ Ï•â‚‚) â†“* (m + n) â‰¡ Ï•â‚ â†“* m âˆ¥ Ï•â‚‚ â†“* n  if Ï•â‚‚ has length Âµâ‚ â‰¡ n
--     probably best to have solver for Âµ equations if we use â†“*

-- (Ï• â†‘* Âµ) is Ï• âˆ¥ id {Âµ} ?

-- The Normalform
data _â€“[_]â†’N_ : List VarMode â†’ Kit â†’ List VarMode â†’ Set where
  -- All wk, wk*, [], []*, id get pushed in here
  -- TODO: id can also appear in the middle with âˆ¥
  id-wk* : âˆ€ â¦ƒ ğ•‚ â¦„ Âµâ‚ Âµâ‚' Âµâ‚‚ â†’ (Âµâ‚ â–·â–· Âµâ‚') â€“[ ğ•‚ ]â†’N Âµâ‚‚
  -- Embedding of real substitution thats not ~ []*
  emb    : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’N Âµâ‚‚
  -- []â‚–`  : âˆ€ â¦ƒ ğ•‚ â¦„ â†’ [] â€“[ ğ•‚ ]â†’` []
  -- []*`  : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚‚} â†’ [] â€“[ ğ•‚ ]â†’` Âµâ‚‚
  -- _,â‚–`_ : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {m} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m â†’ (Âµâ‚ â–· m) â€“[ ğ•‚ ]â†’` Âµâ‚‚
  -- wkâ‚–`  : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} m â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` (Âµâ‚‚ â–· m)
  -- wkâ‚–*` : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} {Âµâ‚‚'} Âµ â†’ Âµâ‚‚' â‰¡ Âµâ‚‚ â–·â–· Âµ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚'

âŸ¦_âŸ§ : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚
âŸ¦ emb Ï• âŸ§           = Ï•
âŸ¦ []â‚–` âŸ§            = []â‚–
âŸ¦ []*` âŸ§            = []*
âŸ¦ Ï•` ,â‚–` x/t âŸ§      = âŸ¦ Ï•` âŸ§ ,â‚– x/t
âŸ¦ wkâ‚–` m Ï•` âŸ§       = wkâ‚– m âŸ¦ Ï•` âŸ§
âŸ¦ wkâ‚–*` Âµ refl Ï•` âŸ§ = wkâ‚–* Âµ âŸ¦ Ï•` âŸ§

--------------------------------------------------------------------------------

push-wk* : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} Âµ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` (Âµâ‚‚ â–·â–· Âµ)
push-wk* Âµ (emb x)                               = emb (wkâ‚–* Âµ x)
push-wk* â¦ƒ ğ•‚ â¦„ Âµ []â‚–`                            = subst ([] â€“[ ğ•‚ ]â†’`_) (sym (++-identityÊ³ Âµ)) ([]*` {Âµ})
push-wk* Âµ []*`                                  = []*`
push-wk* Âµ (Ï•` ,â‚–` x/t)                          = push-wk* Âµ Ï•` ,â‚–` wk* _ x/t
push-wk* â¦ƒ ğ•‚ â¦„ {Âµâ‚} Âµ (wkâ‚–` {Âµâ‚‚ = Âµâ‚‚} m Ï•`)      = subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) (++-assoc Âµ ([] â–· m) Âµâ‚‚) (push-wk* (([] â–· m) â–·â–· Âµ) Ï•`)
push-wk* â¦ƒ ğ•‚ â¦„ {Âµâ‚} Âµ (wkâ‚–*` {Âµâ‚‚ = Âµâ‚‚} Âµ' eq Ï•`) = subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) (trans (++-assoc Âµ Âµ' Âµâ‚‚) (cong (_â–·â–· Âµ) (sym eq))) (push-wk* (Âµ' â–·â–· Âµ) Ï•`)

trans-redáµ£ : âˆ€ {â„“} {A : Set â„“} {a b : A} (eq : a â‰¡ b) â†’
  trans eq refl â‰¡ eq
trans-redáµ£ refl = refl

open import Kitty.Util.SubstProperties

push-wk*-sem : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} Âµ â†’ (Ï•` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚) â†’
  âŸ¦ wkâ‚–*` Âµ refl Ï•` âŸ§ ~ âŸ¦ push-wk* Âµ Ï•` âŸ§
push-wk*-sem Âµ (emb Ï•)       = ~-refl
push-wk*-sem â¦ƒ ğ•‚ â¦„ Âµ (Ï•` ,â‚–` x/t)  =
  wkâ‚–* Âµ (âŸ¦ Ï•` âŸ§ ,â‚– x/t)                 ~âŸ¨ dist-wk*-,â‚– Âµ âŸ¦ Ï•` âŸ§ x/t âŸ©
  (wkâ‚–* Âµ âŸ¦ Ï•` âŸ§ ,â‚– Kit.wk* ğ•‚ _ x/t)     ~âŸ¨âŸ©
  (âŸ¦ wkâ‚–*` Âµ refl Ï•` âŸ§ ,â‚– Kit.wk* ğ•‚ _ x/t)    ~âŸ¨ ~-cong-,â‚– (push-wk*-sem Âµ Ï•`) refl âŸ©
  (âŸ¦ push-wk* Âµ Ï•` âŸ§ ,â‚– Kit.wk* ğ•‚ _ x/t) ~âˆ
push-wk*-sem â¦ƒ ğ•‚ â¦„ {Âµâ‚} Âµ (wkâ‚–` {Âµâ‚‚ = Âµâ‚‚} m Ï•`) =
  -- TODO: Factor out wkâ‚–*` case in mutual block and call it here
  let Âµ' = [] â–· m in
  let subâ‚` = subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) (++-assoc Âµ Âµ' Âµâ‚‚) in
  let subâ‚‚` = subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) (++-assoc Âµ Âµ' Âµâ‚‚) in
  let subâ‚‚ = subst (Âµâ‚ â€“[ ğ•‚ ]â†’_) (++-assoc Âµ Âµ' Âµâ‚‚) in
  âŸ¦ wkâ‚–*` Âµ refl (wkâ‚–` m Ï•`) âŸ§        ~âŸ¨âŸ©
  wkâ‚–* Âµ (wkâ‚– m âŸ¦ Ï•` âŸ§)               ~âŸ¨ wkâ‚–-â–·â–· Âµ m âŸ¦ Ï•` âŸ§ âŸ©
  subâ‚‚ (wkâ‚–* (Âµ' â–·â–· Âµ) âŸ¦ Ï•` âŸ§)        ~âŸ¨âŸ©
  subâ‚‚ âŸ¦ wkâ‚–*` (Âµ' â–·â–· Âµ) refl Ï•` âŸ§    ~âŸ¨ ~-cong-subst-Âµâ‚‚ _ (push-wk*-sem (Âµ' â–·â–· Âµ) Ï•`) âŸ©
  subâ‚‚ âŸ¦ push-wk* (Âµ' â–·â–· Âµ) Ï•` âŸ§      ~â‰¡âŸ¨ sym (dist-subst âŸ¦_âŸ§ (++-assoc Âµ Âµ' Âµâ‚‚) (push-wk* (Âµ' â–·â–· Âµ) Ï•`) ) âŸ©
  âŸ¦ subâ‚‚` (push-wk* (Âµ' â–·â–· Âµ) Ï•`) âŸ§   ~âŸ¨âŸ©
  âŸ¦ push-wk* Âµ (wkâ‚–` m Ï•`) âŸ§          ~âˆ
push-wk*-sem â¦ƒ ğ•‚ â¦„ {Âµâ‚} Âµ (wkâ‚–*` {Âµâ‚‚ = Âµâ‚‚} Âµ' refl Ï•`) = -- {!!}
  let subâ‚` = subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) (trans (++-assoc Âµ Âµ' Âµâ‚‚) (cong (_â–·â–· Âµ) (sym refl))) in
  let subâ‚‚` = subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) (++-assoc Âµ Âµ' Âµâ‚‚) in
  let subâ‚‚ = subst (Âµâ‚ â€“[ ğ•‚ ]â†’_) (++-assoc Âµ Âµ' Âµâ‚‚) in
  âŸ¦ wkâ‚–*` Âµ refl (wkâ‚–*` Âµ' refl Ï•`) âŸ§ ~âŸ¨âŸ©
  wkâ‚–* Âµ (wkâ‚–* Âµ' âŸ¦ Ï•` âŸ§)             ~âŸ¨ wkâ‚–*-â–·â–· Âµ Âµ' âŸ¦ Ï•` âŸ§ âŸ©
  subâ‚‚ (wkâ‚–* (Âµ' â–·â–· Âµ) âŸ¦ Ï•` âŸ§)        ~âŸ¨âŸ©
  subâ‚‚ âŸ¦ wkâ‚–*` (Âµ' â–·â–· Âµ) refl Ï•` âŸ§    ~âŸ¨ ~-cong-subst-Âµâ‚‚ _ (push-wk*-sem (Âµ' â–·â–· Âµ) Ï•`) âŸ©
  subâ‚‚ âŸ¦ push-wk* (Âµ' â–·â–· Âµ) Ï•` âŸ§      ~â‰¡âŸ¨ sym (dist-subst âŸ¦_âŸ§ (++-assoc Âµ Âµ' Âµâ‚‚) (push-wk* (Âµ' â–·â–· Âµ) Ï•`) ) âŸ©
  âŸ¦ subâ‚‚` (push-wk* (Âµ' â–·â–· Âµ) Ï•`) âŸ§   ~â‰¡âŸ¨ cong (Î» â–  â†’ âŸ¦ subst (Âµâ‚ â€“[ ğ•‚ ]â†’`_) â–  (push-wk* (Âµ' â–·â–· Âµ) Ï•`) âŸ§)
                                               (sym (trans-redáµ£ (++-assoc Âµ Âµ' Âµâ‚‚))) âŸ©
  âŸ¦ subâ‚` (push-wk* (Âµ' â–·â–· Âµ) Ï•`) âŸ§   ~âŸ¨âŸ©
  âŸ¦ push-wk* Âµ (wkâ‚–*` Âµ' refl Ï•`) âŸ§   ~âˆ

push-wk*-sem' : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚) â†’
  âŸ¦ Ï•` âŸ§ ~ âŸ¦ push-wk* [] Ï•` âŸ§
push-wk*-sem' Ï•` =
  âŸ¦ Ï•` âŸ§               ~âŸ¨ ~-sym (wkâ‚–*-[] âŸ¦ Ï•` âŸ§) âŸ©
  âŸ¦ wkâ‚–*` [] refl Ï•` âŸ§ ~âŸ¨ push-wk*-sem [] Ï•` âŸ©
  âŸ¦ push-wk* [] Ï•` âŸ§   ~âˆ

--------------------------------------------------------------------------------

[]-eta : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚
[]-eta {Âµâ‚} (emb x)    with Âµâ‚
...                       | []      = []*`
...                       | Âµâ‚ â–· mâ‚ = emb x
[]-eta []â‚–`            = []â‚–`
[]-eta []*`            = []*`
[]-eta (Ï•` ,â‚–` x/t)    = []-eta Ï•` ,â‚–` x/t
[]-eta (wkâ‚–` m Ï•`)     = wkâ‚–` m ([]-eta Ï•`)
[]-eta (wkâ‚–*` Âµ eq Ï•`) = wkâ‚–*` Âµ eq ([]-eta Ï•`)

[]-eta-sem : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚) â†’
  âŸ¦ Ï•` âŸ§ ~ âŸ¦ []-eta Ï•` âŸ§
[]-eta-sem {Âµâ‚ = []}     (emb x) = Î» m ()
[]-eta-sem {Âµâ‚ = Âµâ‚ â–· m} (emb x) = ~-refl
[]-eta-sem []â‚–`                  = ~-refl
[]-eta-sem []*`                  = ~-refl
[]-eta-sem (Ï•` ,â‚–` x/t)          = ~-cong-,â‚– ([]-eta-sem Ï•`) refl
[]-eta-sem (wkâ‚–` m Ï•`)           = ~-cong-wk ([]-eta-sem Ï•`)
[]-eta-sem (wkâ‚–*` Âµ refl Ï•`)     = ~-cong-wk* ([]-eta-sem Ï•`)

--------------------------------------------------------------------------------

norm : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ â†’ Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚
norm Ï•` = []-eta (push-wk* [] Ï•`)

norm-sem :  âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚) â†’
  âŸ¦ norm Ï•` âŸ§ ~ âŸ¦ Ï•` âŸ§
norm-sem Ï•` =
  âŸ¦ []-eta (push-wk* [] Ï•`) âŸ§ ~âŸ¨ ~-sym ([]-eta-sem (push-wk* [] Ï•`)) âŸ©
  âŸ¦ push-wk* [] Ï•` âŸ§          ~âŸ¨ ~-sym (push-wk*-sem' Ï•`) âŸ©
  âŸ¦ Ï•` âŸ§                      ~âˆ

--------------------------------------------------------------------------------

data _â‰ˆ_ â¦ƒ ğ•‚ â¦„ : âˆ€ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•â‚` Ï•â‚‚` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ ) â†’ Set where
  â‰ˆ-emb : âˆ€ {Âµâ‚ Âµâ‚‚} {Ï•â‚ Ï•â‚‚ : Âµâ‚ â€“[ ğ•‚ ]â†’ Âµâ‚‚} â†’ Ï•â‚ ~ Ï•â‚‚ â†’ emb Ï•â‚ â‰ˆ emb Ï•â‚‚
  â‰ˆ-[]â‚– : []â‚–` â‰ˆ []â‚–`
  â‰ˆ-[]* : âˆ€ {Âµ} â†’ []*` {Âµ} â‰ˆ []*` {Âµ}
  â‰ˆ-,â‚– : âˆ€ {Âµâ‚} {Âµâ‚‚} {m} {Ï•â‚` Ï•â‚‚` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚} {x/tâ‚ x/tâ‚‚ : Âµâ‚‚ âˆ‹/âŠ¢[ ğ•‚ ] id/mâ†’M m} â†’ 
    Ï•â‚` â‰ˆ Ï•â‚‚` â†’
    x/tâ‚ â‰¡ x/tâ‚‚ â†’
    (Ï•â‚` ,â‚–` x/tâ‚) â‰ˆ (Ï•â‚‚` ,â‚–` x/tâ‚‚)
  â‰ˆ-wkâ‚–*` : âˆ€ {Âµâ‚} {Âµâ‚‚} {Âµâ‚‚'} {Âµ} {eqâ‚ eqâ‚‚ : Âµâ‚‚' â‰¡ Âµâ‚‚ â–·â–· Âµ} {Ï•â‚` Ï•â‚‚` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚} â†’
    eqâ‚ â‰¡ eqâ‚‚ â†’
    Ï•â‚` â‰ˆ Ï•â‚‚` â†’
    wkâ‚–*` Âµ eqâ‚ Ï•â‚` â‰ˆ wkâ‚–*` Âµ eqâ‚‚ Ï•â‚‚`

-- _â‰ˆ_ : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•â‚` Ï•â‚‚` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ ) â†’ Set
-- Ï•â‚` â‰ˆ Ï•â‚‚` = norm Ï•â‚` â‰¡ norm Ï•â‚‚`

sound : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•â‚` Ï•â‚‚` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ )
  â†’ norm Ï•â‚` â‰¡ norm Ï•â‚‚`
  â†’ âŸ¦ Ï•â‚` âŸ§ ~ âŸ¦ Ï•â‚‚` âŸ§
sound Ï•â‚` Ï•â‚‚` eq =
  âŸ¦ Ï•â‚` âŸ§      ~âŸ¨ ~-sym (norm-sem Ï•â‚`) âŸ©
  âŸ¦ norm Ï•â‚` âŸ§ ~âŸ¨ (Î» m x â†’ cong (Î» â–  â†’ apâ‚– âŸ¦ â–  âŸ§ m x) eq ) âŸ©
  âŸ¦ norm Ï•â‚‚` âŸ§ ~âŸ¨ norm-sem Ï•â‚‚` âŸ©
  âŸ¦ Ï•â‚‚` âŸ§      ~âˆ

[]â‰¡â–·â–· : âˆ€ {â„“} {A : Set â„“} {xs ys : List A} â†’
  xs â–·â–· ys â‰¡ [] â†’
  xs â‰¡ [] Ã— ys â‰¡ []
[]â‰¡â–·â–· {xs = xs} {ys = []} eq = eq , refl
[]â‰¡â–·â–· {xs = xs} {ys = ys â–· x} ()

[]â‰¡â–·â–·â‚ : âˆ€ {â„“} {A : Set â„“} {xs ys : List A} â†’
  xs â–·â–· ys â‰¡ [] â†’
  xs â‰¡ []
[]â‰¡â–·â–·â‚ eq = projâ‚ ([]â‰¡â–·â–· eq)

[]â‰¡â–·â–·â‚‚ : âˆ€ {â„“} {A : Set â„“} {xs ys : List A} â†’
  xs â–·â–· ys â‰¡ [] â†’
  ys â‰¡ []
[]â‰¡â–·â–·â‚‚ eq = projâ‚‚ ([]â‰¡â–·â–· eq)

complete : âˆ€ â¦ƒ ğ•‚ â¦„ {Âµâ‚} {Âµâ‚‚} â†’ (Ï•â‚` Ï•â‚‚` : Âµâ‚ â€“[ ğ•‚ ]â†’` Âµâ‚‚ )
  â†’ âŸ¦ Ï•â‚` âŸ§ ~ âŸ¦ Ï•â‚‚` âŸ§
  â†’ norm Ï•â‚` â‰ˆ norm Ï•â‚‚`
complete {Âµâ‚ = []}     (emb Ï•â‚) (emb Ï•â‚‚) Ï•â‚~Ï•â‚‚ = â‰ˆ-[]*
complete {Âµâ‚ = Âµâ‚ â–· m} (emb Ï•â‚) (emb Ï•â‚‚) Ï•â‚~Ï•â‚‚ = â‰ˆ-emb (~-cong-wk* Ï•â‚~Ï•â‚‚)
complete (emb Ï•â‚)          []â‚–`              ~ = â‰ˆ-[]*
complete (emb Ï•â‚)          []*`              ~ = â‰ˆ-[]*
complete (emb Ï•â‚)          (Ï•â‚‚` ,â‚–` x/tâ‚‚)    ~ = {!!}
complete (emb Ï•â‚)          (wkâ‚–` m Ï•â‚‚`)      ~ = {!!} -- same as []â‚–
complete (emb Ï•â‚)          (wkâ‚–*` Âµ xâ‚ Ï•â‚‚`)  ~ = {!!}
complete []â‚–`              (emb Ï•â‚‚)          ~ = â‰ˆ-[]*
complete []â‚–`              []â‚–`              ~ = â‰ˆ-[]*
complete []â‚–`              []*`              ~ = â‰ˆ-[]*
-- complete []â‚–`              (wkâ‚–*` Âµ eq Ï•â‚‚`) ~  rewrite []â‰¡â–·â–·â‚ {ys = Âµ} (sym eq) = ?
complete []â‚–`              (wkâ‚–*` Âµ eq Ï•â‚‚`)  ~ with []â‰¡â–·â–· {ys = Âµ} (sym eq) | eq
... | refl , refl | refl = {!!} -- lemma but should be true because Ï•â‚‚` has [] for Âµs
complete []*`              (emb Ï•â‚‚)          ~ = â‰ˆ-[]*
complete []*`              []â‚–`              ~ = â‰ˆ-[]*
complete []*`              []*`              ~ = â‰ˆ-[]*
complete []*`              (wkâ‚–` m Ï•â‚‚`)      ~ = {!!} -- same as []â‚–
complete []*`              (wkâ‚–*` Âµ x Ï•â‚‚`)   ~ = {!!} -- same as []â‚–
complete (Ï•â‚` ,â‚–` x/tâ‚)    (emb Ï•â‚‚)          ~ = {!!}
complete (Ï•â‚` ,â‚–` x/tâ‚)    (Ï•â‚‚` ,â‚–` x/tâ‚‚)    ~ = â‰ˆ-,â‚– (complete Ï•â‚` Ï•â‚‚` {!!}) {!!}
complete (Ï•â‚` ,â‚–` x/tâ‚)    (wkâ‚–` m Ï•â‚‚`)      ~ = {!!}
complete (Ï•â‚` ,â‚–` x/tâ‚)    (wkâ‚–*` Âµ xâ‚ Ï•â‚‚`)  ~ = {!!}
complete (wkâ‚–` m Ï•â‚`)      (emb Ï•â‚‚)          ~ = {!!}
complete (wkâ‚–` m Ï•â‚`)      []*`              ~ = {!!}
complete (wkâ‚–` m Ï•â‚`)      (Ï•â‚‚` ,â‚–` xâ‚)      ~ = {!!}
complete (wkâ‚–` m Ï•â‚`)      (wkâ‚–` mâ‚ Ï•â‚‚`)     ~ = {!!}
complete (wkâ‚–` m Ï•â‚`)      (wkâ‚–*` Âµâ‚ xâ‚ Ï•â‚‚`) ~ = {!!}
complete (wkâ‚–*` Âµ eqâ‚ Ï•â‚`) (emb Ï•â‚‚)          ~ = {!!}
complete (wkâ‚–*` Âµ eqâ‚ Ï•â‚`) []â‚–`              ~ = {!!}
complete (wkâ‚–*` Âµ eqâ‚ Ï•â‚`) []*`              ~ = {!!}
complete (wkâ‚–*` Âµ eqâ‚ Ï•â‚`) (Ï•â‚‚` ,â‚–` xâ‚)      ~ = {!!}
complete (wkâ‚–*` Âµ eqâ‚ Ï•â‚`) (wkâ‚–` mâ‚ Ï•â‚‚`)     ~ = {!!}
complete (wkâ‚–*` Âµ eqâ‚ Ï•â‚`) (wkâ‚–*` Âµâ‚ xâ‚ Ï•â‚‚`) ~ = {!!}
